function SetCookie(a,c){var b=7;var d=new Date();d.setTime(d.getTime()+b*24*60*60*1000);document.cookie=a+"="+escape(c)+";expires="+d.toGMTString()}function GetCookie(b){var a=document.cookie.match(new RegExp("(^| )"+b+"=([^;]*)(;|$)"));if(a!=null){return unescape(a[2])}return null}var g_serverUrl=document.location.href;function OnlogMOver(a){a.style.color="black";a.style.background="url(res/button002.jpg) no-repeat left top"}function OnlogMOut(a){a.style.color="white";a.style.background="url(res/button001.jpg) no-repeat left top"}function useNat(){return bUseNat}function GotoLoginPage(){document.getElementById("div_ocx").style.width="1px";var d=GetCookie("login_name");if(d){document.getElementById("username").value=d}else{document.getElementById("username").value=""}if(useNat()){var b=GetCookie("device_No");if(b){document.getElementById("deviceNo").value=b}else{document.getElementById("deviceNo").value=""}}WebClient.SetVisible(0);if(g_bUseLogo){document.title=g_logoName+" "+html_title}else{document.title=html_title}ApplyXmlLang("login.xml");GenSelectListEx(document.getElementsByName("language_list")[0],g_langList);document.getElementsByName("language_list")[0].value=g_langName;document.getElementById("win7_run_tip").innerHTML=str_run_as_admin_tip;var h=document.all?document.getElementsByTagName("html")[0].offsetHeight:window.innerHeight;var g=document.getElementById("login_table").offsetHeight;var f=((h-g)/2)-60;var i=false;var a=navigator.userAgent.toLowerCase();var c=navigator.platform.toLowerCase();if(a.indexOf("windows nt")!=-1||c.indexOf("win32")!=-1){if(a.indexOf("firefox")!=-1||a.indexOf("chrome")!=-1||a.indexOf("safari")!=-1){i=true}}var e=/msie/i.test(navigator.userAgent);if(e||i){document.getElementById("login_table").style.marginTop=f+"px";document.getElementsByName("btn_login")[0].style.display="";document.getElementsByName("language_list")[0].style.display="";document.getElementById("username").style.display="";document.getElementById("userpwd").style.display="";document.getElementById("login_ok_button").style.display="";document.getElementById("login_language_label").style.display="";document.getElementById("login_pwd_label").style.display="";document.getElementById("login_user_label").style.display="";if(useNat()){document.getElementById("device_no_label").style.display="";document.getElementById("deviceNo").style.display=""}}else{f=f-100;document.getElementById("login_table").style.marginTop=f+"px";document.getElementsByName("btn_login")[0].style.display="";document.getElementsByName("language_list")[0].style.display="";document.getElementById("username").style.display="";document.getElementById("userpwd").style.display="";document.getElementById("login_ok_button").style.display="";document.getElementById("login_language_label").style.display="";document.getElementById("login_pwd_label").style.display="";document.getElementById("login_user_label").style.display="";if(useNat()){document.getElementById("device_no_label").style.display="";document.getElementById("deviceNo").style.display=""}}}function OnChangeLang(){g_langName=document.getElementsByName("language_list")[0].value;var c="<request>\r\n";c+='<command name="'+STR_LM_SET_LANGUAGE+'">\r\n';c+="<language>"+g_langName+"</language>\r\n";c+="</command>\r\n";c+="</request>\r\n";WebClient.ExcuteLocalCmd(c);ApplyXmlLang("login.xml");StartWait();LoadMultiString("string.js",EndLoadLang);var b=/msie/i.test(navigator.userAgent);if(!b){var a=new Array("device_param.js","cfg_main.js");ReLoadMultiJS(a)}}function EndLoadLang(){StopWait();var a=document.getElementById("win7_run_tip");if(g_bUseLogo){document.title=g_logoName+" "+html_title}else{document.title=html_title}var b=/msie/i.test(navigator.userAgent);if(b){a.innerText=str_run_as_admin_tip}else{a.textContent=str_run_as_admin_tip}}function CreateLoginXml(){var c=document.getElementById("username").value;var b=document.getElementById("userpwd").value;var a="<request>\r\n";a+='<command name="'+STR_REQUEST_LOGIN+'">\r\n';a+='<parameter name="'+STR_LOGIN_USER_NAME+'">'+c+"</parameter>\r\n";a+='<parameter name="'+STR_LOGIN_USER_PWD+'">'+b+"</parameter>\r\n";a+='<parameter name="'+STR_CLIENT_MAC+'">'+HostInfo.hostmac+"</parameter>\r\n";a+='<parameter name="'+STR_CLIENT_HOSTNAME+'">'+HostInfo.hostname+"</parameter>\r\n";a+="</command>\r\n";a+="</request>\r\n";return a}function OnLogin(){if(useNat()){WebClient.SetIPAddr(serverAddr);WebClient.SetWebSerAddr(g_serverUrl);WebClient.SetPort(parseInt(serverPort));WebClient.SetDeviceNo(serialNo)}else{WebClient.SetIPAddr(g_serverUrl);WebClient.SetPort(NetPort)}var d=/msie/i.test(navigator.userAgent);var c=navigator.userAgent.toLowerCase();var b=navigator.platform.toLowerCase();if(c.indexOf("windows nt")!=-1||b.indexOf("win32")!=-1){if(d||c.indexOf("firefox")!=-1||c.indexOf("chrome")!=-1||c.indexOf("safari")!=-1){WebClient.ChangeInterface(212,233,254,0)}}if(d){g_xmlhttp.open("get","script/device_param.js",false);StartWait();SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState!=4){return}DynAppendJS("device_param_js",g_xmlhttp.responseText);if(!WebClient.ConnectToServer()){StopWait();window.alert(login_fail_tip);return}var e=CreateLoginXml();SetNofityCallback(Login);var a=WebClient.ExcuteCmdAsyn(e);if(a!=""){Login(a)}}else{StartWait();if(!WebClient.ConnectToServer()){StopWait();window.alert(login_fail_tip);return}var e=CreateLoginXml();SetNofityCallback(Login);g_loginTimer=setInterval(CheckLogin,1000);var a=WebClient.ExcuteCmdAsyn(e);if(a!=""){Login(a)}}}function Login(m){if(m==""){return}var e=/msie/i.test(navigator.userAgent);if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(m);g_xmlDoc.async=false;var d=g_xmlDoc.documentElement.getElementsByTagName("command");var h=document.getElementById("username");if(d[0].attributes.getNamedItem("name").nodeValue=="login_reply_success"){g_loginStatus=1;var f=new Array("device_param.js");ReLoadMultiJS(f);SetCookie("login_name",document.getElementById("username").value);if(useNat()){SetCookie("device_No",document.getElementById("deviceNo").value)}var b=document.getElementById("work_area");b.style.border="solid 1px #767778";var o=document.getElementById("div_ocx");o.style.backgroundColor=bg_color;g_loginUser=h.value;var l=false;var p=false;var j=d[0].getElementsByTagName("parameter");for(var g=0;g<j.length;g++){var c=j[g].attributes.getNamedItem("name").nodeValue;var a="";if(j[g].childNodes.length>0){a=j[g].childNodes[0].nodeValue}if(c==STR_LOCAL_VIDEO_INPUT_NUM){g_local_ch_num=parseInt(a);l=true;if(l&&p){g_channelList=new Array();for(k=1;k<=g_local_ch_num+g_net_ch_num;k++){g_channelList[k-1]=new CSelectOptionInfo(channel_string+k,k-1)}}}else{if(c==STR_NET_VIDEO_INPUT_NUM){g_net_ch_num=parseInt(a);p=true;if(l&&p){g_channelList=new Array();for(k=1;k<=g_local_ch_num+g_net_ch_num;k++){g_channelList[k-1]=new CSelectOptionInfo(channel_string+k,k-1)}}}else{if(c==STR_NET_OUTPUT_VIDEO_NUM){g_output_channel_num=parseInt(a,10)}else{if(c==STR_AUDIO_INPUT_NUM){const_audio_num=a;g_audioList=new Array();for(k=1;k<=const_audio_num;k++){g_audioList[k-1]=new CSelectOptionInfo(channel_string+k,k-1)}}else{if(c==STR_SENSOR_IN_NUM){const_sensor_num=parseInt(a);g_sensorList=new Array();for(k=1;k<=const_sensor_num;k++){g_sensorList[k-1]=new CSelectOptionInfo(sensor_string+k,k-1)}}else{if(c==STR_ALARM_OUT_NUM){const_alarmout_num=a;g_alarmoutList=new Array();for(k=1;k<=const_alarmout_num;k++){g_alarmoutList[k-1]=new CSelectOptionInfo(alarmout_string+k,k-1)}}else{if(c==STR_PRESET_NUM){g_preset_num=a;g_presetList=new Array();for(k=1;k<=g_preset_num;k++){g_presetList[k-1]=new CSelectOptionInfo(preset_string+k,k-1)}}else{if(c==STR_CRUISE_NUM){g_cruise_num=a;g_cruiseList=new Array();for(k=1;k<=g_cruise_num;k++){g_cruiseList[k-1]=new CSelectOptionInfo(cruise_string+k,k-1)}}else{if(c==STR_MAX_PRESET_PER_CRUISE){g_max_preset_per_cruise=a}else{if(c==STR_TRACK_NUM){g_track_num=1;g_trackList=new Array();for(k=1;k<=g_track_num;k++){g_trackList[k-1]=new CSelectOptionInfo("1",k-1)}}else{if(c==STR_PRESET_NAME_MAX_LEN){const_preset_name_max_len=a}else{if(c==STR_CRUISE_NAME_MAX_LEN){const_cruise_name_max_len=a}else{if(c==STR_SUPPORT_DUAL_STREAM){const_support_dual_stream=a}else{if(c==STR_SUPPORT_AUDIO_STREAM){const_support_audio_stream=a}else{if(c==STR_SUPPORT_TALK_BACK){const_support_talkback=parseInt(a,10)}else{if(c==STR_USER_RIGHT){g_authority.authority=parseInt(a,10)}else{if(c==STR_AUTH_REMOTE_VIEW){g_authority.authRemoteView=parseInt(a,10)}else{if(c==STR_AUTH_PLAYBACK){g_authority.authPlayback=parseInt(a,10)}else{if(c==STR_AUTH_BACKUP){g_authority.authBackup=parseInt(a,10)}else{if(c==STR_AUTH_PTZ_CTRL){g_authority.authPtzCtrl=parseInt(a,10)}else{if(c==STR_OPER_PWD_OPEN){const_oper_pwd_open=a}else{if(c==STR_MAX_CLIENT_COUNT){const_max_client_count=a}else{if(c==STR_HARD_VER){const_hardware_ver=a}else{if(c==STR_MCU_VER){const_mcu_ver=a}else{if(c==STR_KERNEL_VER){const_kernel_ver=a}else{if(c==STR_FIRMWARE_VER){const_software_ver=a}else{if(c==STR_BUILD_DATE){const_build_date=a}else{if(c==STR_DEVICE_NAME){const_device_name=a}else{if(c==STR_DEVICE_ID){const_device_id=a}else{if(c==STR_POE_NUM){const_poe_num=a}else{if(c==STR_VIDEO_FORMAT){g_videoFormat=a}else{if(c==STR_BRIGHT){g_colorInfo.bright=a}else{if(c==STR_CONTRAST){g_colorInfo.contrast=a}else{if(c==STR_SATURATION){g_colorInfo.saturation=a}else{if(c==STR_HUE){g_colorInfo.hue=a}else{if(c==STR_FUNCTION_MASK){g_supportFunctions.functionMask=a}else{if(c==STR_DEVICE_MAC){g_deviceMac=a}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}g_ch_num=g_local_ch_num+g_net_ch_num;g_TotalChannelList=new Array();g_bigViewList=new Array();for(k=1;k<=g_ch_num;k++){g_TotalChannelList[k-1]=new CSelectOptionInfo(channel_string+k,k-1);g_bigViewList[k-1]=new CSelectOptionInfo(channel_string+k,k-1)}g_bigViewList[k-1]=new CSelectOptionInfo(str_none,-1);StopWait();if(e){g_xmlhttp.open("get","script/main_menu.js",false);SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState!=4){return}DynAppendJS("main_menu_js",g_xmlhttp.responseText);GotoMainPage()}else{GotoMainPage()}}else{StopWait();g_loginErrorTip=d[0].getElementsByTagName("parameter")[0].childNodes[0].nodeValue;if(e){var n=d[0].getElementsByTagName("parameter")[0];window.alert(n.childNodes[0].nodeValue)}g_loginStatus=2}if(g_supportFunctions.IsSupportLiveMultiText()){channel_config_array.push(STR_LIVE_TEXT);sys_const_array.push(STR_LIVE_TEXT1234_MAX_LEN,STR_LIVE_TEXT5_MAX_LEN,STR_LIVE_TEXT6_MAX_LEN)}}function CheckLogin(){if(g_loginStatus==1){g_loginTimer=clearInterval(g_loginTimer)}else{if(g_loginStatus==2){alert(g_loginErrorTip);g_loginTimer=clearInterval(g_loginTimer)}}};