var g_calendarRecData=new CalendarCtrl(false);var g_calendarEventData=new CalendarCtrl(false);var g_calendarLogData=new CalendarCtrl(false);function getOffset(b){var d=b.target;if(d.offsetLeft==undefined){d=d.parentNode}var c=getPageCoord(d);var a={x:window.pageXOffset+b.clientX,y:window.pageYOffset+b.clientY};var e={offsetX:a.x-c.x,offsetY:a.y-c.y};return e}function getPageCoord(a){var b={x:0,y:0};while(a){b.x+=a.offsetLeft;b.y+=a.offsetTop;a=a.offsetParent}return b}function HideElement(a){a.style.display="none";document.onmousedown=new Function()}function DateStruct(b,c,a){this.year=b;this.month=c;this.day=a}function CalendarCtrl(a){this.bPop=a;this.months=calendar_month;this.daysInMonth=new Array(31,28,31,30,31,30,31,31,30,31,30,31);this.days=new Array(calendar_week[0],calendar_week[1],calendar_week[2],calendar_week[3],calendar_week[4],calendar_week[5],calendar_week[6]);this.Create=CreateCalendar;this.GetMonthDays=GetMonthDays;this.GetDate=GetDateSel;this.SetDate=SetDateSel;this.SetDayState=SetDayState;this.dayStates=0;this.OnSelDate=function(c){};this.OnChangeMonth=function(c,d){};this.id="";this.bBottomAlign=false;this.bottomPosition=0;var b=new Date();this.date=new DateStruct(b.getFullYear(),b.getMonth(),b.getDate())}CalendarCtrl.all={};function CreateCalendar(f){var g,i,k,c,h;var d;var e=new Date().getFullYear();this.id=f.id;CalendarCtrl.all[this.id]=this;if(this.bPop){d="<table border='0' cellspacing='0' class = 'calendar_bgcolor_pop'>"}else{d="<table border='0' cellspacing='0' class = 'calendar_bgcolor'>"}d+="<tr>";d+="<td class='Calendar_Div'>";d+="<select id='"+this.id+"Year' onChange='UpdateCalendar(this.calendar);' style='font-family:Verdana; font-size:12px'>";for(g=2008;g<2026;g++){d+="<option value= "+g+" "+(this.date.year==g?"Selected":"")+">"+g+"</option>"}d+="</select>";d+="<select id='"+this.id+"Month' onChange='UpdateCalendar(this.calendar);' style='font-family:Verdana; font-size:12px'>";for(i=0;i<this.months.length;i++){d+="<option value= "+i+" "+(this.date.month==i?"Selected":"")+">"+this.months[i]+"</option>"}d+="</select>";d+="</td>";var a=/msie/i.test(navigator.userAgent);if(this.bPop){if(!a){d+="<td class = 'calendar_close_bgcolor'>";d+="<img id='img_close' src='res/close.png' onmousemove =\"this.style.cursor = 'pointer'\" onClick='HideElement(document.getElementById(\""+f.id+"\"))'></img>";d+="</td>"}else{d+="<td class = 'calendar_close_bgcolor' style='cursor:pointer;text_align:center; font-weight:bold; font-family:Wingdings 2,Wingdings,Webdings; font-size:14px; color:#4477FF' align='center' title='关闭' onClick='HideElement("+f.id+")'>S</td>"}}d+="</tr>";d+="<tr><td border='0' align='center' colspan='2'>";d+="<table id='"+this.id+"calendar' border='0' width='100%'>";d+="<tr>";for(k=0;k<this.days.length;k++){d+="<td align='center' style='font-size:12px;border:none;color:"+cal_week_color+"'>"+this.days[k]+"</td>"}d+="</tr>";for(c=0;c<6;c++){d+="<tr>";for(h=0;h<this.days.length;h++){d+="<td id='ggg' onClick='OnClickDate(event, this)'  style='border:none;' align='center' class = 'cal_day_border'></td>"}d+="</tr>"}d+="</table></td></tr></table><iframe id='"+this.id+"Frame' style='width:200px; position:absolute;z-index:-1;left:0;top:0;'></iframe>";f.innerHTML=d;var j=f.getElementsByTagName("td");for(var b=0;b<j.length;b++){j[b].calendar=this}document.getElementById(this.id+"Year").calendar=this;document.getElementById(this.id+"Month").calendar=this;UpdateCalendar(this)}function GetMonthDays(a,b){if(1==b){return((0==a%4)&&(0!=(a%100)))||(0==a%400)?29:28}else{return this.daysInMonth[b]}}function GetDateSel(a){if(a){return this.date.year+"-"+(((this.date.month+1)>9)?"":"0")+(this.date.month+1)+"-"+((this.date.day>9)?"":"0")+this.date.day}else{return this.date}}function SetDateSel(d,c){if(c){if(!IsDate(d)){return}var e=d.split("-");this.date.year=parseFloat(e[0]);this.date.month=parseFloat(e[1])-1;this.date.day=parseFloat(e[2])}else{this.date=d}var b=document.getElementById(this.id+"Year");var a=document.getElementById(this.id+"Month");b.value=this.date.year;a.value=this.date.month;UpdateCalendar(this)}function SetDayState(a){this.dayStates=a}function ShowCalendar(){this.parentElem.style.display=""}function UpdateCalendar(c){var n=document.getElementById(c.id+"Year");var h=/msie/i.test(navigator.userAgent);if(n==null){return}var f=document.getElementById(c.id+"Month");if(f==null){return}var d=parseInt(n.options[n.selectedIndex].value,10);var a=new Date(d,f.selectedIndex,1);var k=-1;var i=a.getDay();var m=0;c.OnChangeMonth(d,f.selectedIndex+1);if((c.date.year==a.getFullYear())&&(c.date.month==a.getMonth())){k=c.date.day}var b=document.getElementById(c.id+"calendar");var e=c.GetMonthDays(a.getFullYear(),a.getMonth());var o=0;for(o=1;o<b.rows.length;o++){for(var g=0;g<b.rows[o].cells.length;g++){var l=b.rows[o].cells[g];if((g==i)&&(0==m)){m=1}if(k==m){l.style.background=cal_today_bgcolor;l.style.color="#FFFFFF"}else{l.style.background=cal_day_bgcolor;l.style.color=cal_day_color}if((g==6)||(g===0)){l.style.color="#215DC6"}if((1<<(m-1))&c.dayStates){l.style.color=cal_havedata_color}else{l.style.color=cal_day_color}if((m>0)&&(m<=e)){if(h){l.innerText=m}else{l.textContent=m}m++;b.rows[o].style.display=""}else{if(h){l.innerText=""}else{l.textContent=""}if(m>e){break}}}if(g<b.rows[o].cells.length){if(g>0){for(;g<b.rows[o].cells.length;g++){if(h){b.rows[o].cells[g].innerText=""}else{b.rows[o].cells[g].textContent=""}}o+=1}break}}for(;o<b.rows.length;o++){b.rows[o].style.display="none"}var j=document.getElementById(c.id+"Frame");j.style.height=document.getElementById(c.id).offsetHeight;if(c.bBottomAlign){document.getElementById(c.id).style.top=c.bottomPosition-document.getElementById(c.id).offsetHeight}}function OnClickDate(b,f){var b=b?b:(window.event?window.event:null);var a=b.srcElement?b.srcElement:b.target;var h=/msie/i.test(navigator.userAgent);if(a.tagName.toUpperCase()=="TD"){if(h){var g=a.innerText}else{var g=a.textContent}if(g!==""){var e=document.getElementById(f.calendar.id+"Year");if(e==null){return}var d=document.getElementById(f.calendar.id+"Month");if(d==null){return}var c=f.calendar.date;c.year=parseInt(e.value,10);c.month=parseInt(d.value,10);if(h){c.day=parseInt(a.innerText,10)}else{c.day=parseInt(a.textContent,10)}f.calendar.date=c;UpdateCalendar(f.calendar);f.calendar.OnSelDate(f.calendar.date);g_bChange=true}}}function IsDate(b){var f=/^(\d{4})(\-)(\d{1,2})(\-)(\d{1,2})$/;var e=b.match(f);if(e===null){return false}var g=e[3];var a=e[5];var c=e[1];if(g<1||g>12){return false}if(a<1||a>31){return false}if((g==4||g==6||g==9||g==11)&&a==31){return false}if(g==2){var d=(c%4===0&&(c%100!==0||c%400===0));if(a>29||(a==29&&!d)){return false}}return true}function PopCalendar(a,g,h){var i=a;if(g.innerHTML==""){g.calendar=new CalendarCtrl(true);g.calendar.Create(g);var d=a.offsetLeft;var c=a.offsetTop;while((a=a.offsetParent)&&(a!=g.offsetParent)){d+=a.offsetLeft;c+=a.offsetTop}g.style.left=d+2;g.style.zIndex=10;if(h!=null){g.style.top=c-g.offsetHeight;g.calendar.bBottomAlign=true;g.calendar.bottomPosition=c}else{g.style.top=c+20}var f=g.parentNode;var b=0;while(f!=null){if(f.offsetLeft){b+=f.offsetLeft}f=f.parentNode}if(g.offsetWidth+b>document.body.clientWidth){var e=g.offsetWidth+b-document.body.clientWidth;g.style.left=g.offsetLeft-e-2}}g.style.display="";g.calendar.SetDate(i.value,true);g.calendar.OnSelDate=function(j){i.value=this.GetDate(true);g.style.display="none";document.onmousedown=new Function();if(h!=null){h.focus()}};document.onmousedown=function(r){var r=r?r:(window.event?window.event:null);var o=r.srcElement?r.srcElement:r.target;var n=/msie/i.test(navigator.userAgent);if(!n){var j=getOffset(r)}var p=0;var m=0;var k=g;while(k!=null){p+=k.offsetLeft;m+=k.offsetTop;k=k.offsetParent}if(n){var q={x:r.offsetX,y:r.offsetY}}else{var q={x:j.offsetX,y:j.offsetY}}k=o;while(k!=null){q.x+=k.offsetLeft;q.y+=k.offsetTop;k=k.offsetParent}if((q.x<p)||(q.x>(p+g.offsetWidth))||(q.y<m)||(q.y>(m+g.offsetHeight))){if(o.tagName.toLowerCase()=="select"||o.tagName.toLowerCase()=="option"){var l=o.parentNode;while(l.tagName.toLowerCase()!="div"){l=l.parentNode}if((l!=null)&&(l.id==g.id)){return true}}g.style.display="none";document.onmousedown=new Function()}}};