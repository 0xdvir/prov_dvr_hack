var g_curMotionSetChannel=-1;var cfg_motion_header=new Array(str_ch,str_enabel,str_holdtimes,str_trigger,str_area);if(g_US02){cfg_motion_header=new Array(str_ch,str_enabel,str_trigger,str_area)}var cfg_motion_ptz_header=new Array(str_ch,str_type,str_no);function OnLoadCfgMotionAlarm(){ApplyXmlLang("cfg_motion_alarm.xml");g_curConfigIndex=52;var a=document.getElementById("id_motion_alarm");var q=document.getElementById("all_motion_hold_time");var c=document.getElementById("motion_trigger_out");var e=document.getElementById("motion_trigger_record");var f=document.getElementById("motion_snap");var g=document.getElementById("id_motion_ptz");var m=document.getElementById("id_motion_ftp");var o=document.getElementById("motion_snap_label");var s=document.getElementById("motion_trigger_ptz_label");var b=document.getElementById("motion_trigger_ftp_label");if(!g_US02){CreateListMotion(a,5,cfg_motion_header,g_ch_num)}else{CreateListMotion(a,4,cfg_motion_header,g_ch_num)}GenSelectListEx(q,g_alarmOutHoldTime);GenCheckGroup(c,true,g_alarmoutList,STR_MOTION_TO_ALARM_OUT+"_ctrl",4,Btrigger);if(g_alarmoutList.length>1){c.className+=" user_gen_table"}else{c.style.border="0";if(c.rows[0]){c.rows[0].cells[0].style.border="0"}}if(g_supportFunctions.IsNotSupportAlarm()){document.getElementById("motion_alarmout_label").style.display="none";document.getElementById("motion_alarmout_label").parentNode.style.display="none";c.style.display="none";c.parentNode.parentNode.style.display="none"}GenCheckGroup(e,true,g_TotalChannelList,STR_MOTION_TO_RECORD+"_ctrl",4,Btrigger);GenCheckGroup(f,true,g_TotalChannelList,STR_MOTION_TO_SNAP+"_ctrl",4,Btrigger);GenCheckGroup(m,true,g_channelList,STR_MOTION_TO_FTP+"_ctrl",4,Btrigger);MotionTriggerPTZ(g,3,cfg_motion_ptz_header,g_local_ch_num+g_net_ch_num);if(g_local_ch_num==0&&!g_supportFunctions.IsSupportSetIpPtzConfig()){s.parentNode.style.display="none";var g=document.getElementById("id_motion_ptz");g.parentNode.parentNode.style.display="none";m.parentNode.parentNode.style.display="none"}if(!g_supportFunctions.IsSupportPTZ()){s.parentNode.style.display="none";var g=document.getElementById("id_motion_ptz");g.parentNode.parentNode.style.display="none"}if(!g_supportFunctions.IsSupportFTP()){b.parentNode.style.display="none";var m=document.getElementById("id_motion_ftp");m.parentNode.parentNode.style.display="none"}var p=CreateConfigReqXml(motion_alarm_config_array);var h=WebClient.ExcuteCmd(p);if(h==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(h);g_xmlDoc.async=false;var l=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdateValues(l,true);var d=document.getElementById("motion_all_cfg");var a=document.getElementById("id_motion_alarm");var j=document.getElementById("id_motion_all");cfgCopy2All(d,a,j);var r=document.getElementById("motion_area_button");r.disabled=true;AlarmGetCruiseList(l);var n=document.getElementById("all_motion_enable");n.checked=true;q.value=10;if(g_US02){document.getElementById("id_motion_all").style.display="none";document.getElementById("motion_all_label").style.display="none"}Align()}function LoadDefaultCfgMotion(){if(GetDefaultCfg(motion_alarm_config_array)){onMotionPTZCancel();var e=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");var a=document.getElementById("motion_all_cfg");var f=document.getElementById("id_motion_alarm");var c=document.getElementById("id_motion_all");var b=document.getElementById("motion_area_button");UpdateValues(e,true);cfgCopy2All(a,f,c);b.disabled=true;var d=/msie/i.test(navigator.userAgent);for(i=0;i<e.length;i++){if(e[i].parentNode&&STR_PTZ_CRUISE_INFO==e[i].attributes.getNamedItem("name").nodeValue){e[i].parentNode.removeChild(e[i]);i=0}}g_bChange=true;bTrigger=true}}function CreateListMotion(g,a,b,j){var d=/msie/i.test(navigator.userAgent);var h=g.outerHTML.toLowerCase();var c=h.indexOf("</tbody>");h=h.substr(0,c);h+="<tr class = 'table_head_bgcolor'>";for(var e=0;e<a;e++){h+='<td style = "text-align:center">'+b[e]+"</td>"}h+="</tr>";for(var e=0;e<j;e++){if(d){h+="<tr>";h+='<td style = "text-align:center;width:50px;">'+(e+1)+"</td>";h+='<td><input type = "checkbox" name = "motion_enable" onchange = "g_bChange = true;" /></td>';if(!g_US02){h+='<td><select style = "width:130px" name = "motion_hold_time" onchange = "g_bChange = true;"></select></td>';h+='<td align = "center" style = "width:225px"><input style = "width:145px; height:25px; border:0; background:url(res/145x25_btn.jpg);cursor:pointer;" type = "button" value = '+set_button+' onclick = "OnDisOrHidMotion('+e+')"/></td>';h+='<td align = "center" style = "width:225px"><input style = "width:145px; height:25px; border:0; background:url(res/145x25_btn.jpg);cursor:pointer;" type = "button" value = '+set_button+" onclick='GotoMotionAreaSet("+e+")'/></td>"}else{h+='<td align = "center" style = "width:295px"><input style = "width:145px; height:25px; border:0; background:url(res/145x25_btn.jpg);cursor:pointer;" type = "button" value = '+set_button+' onclick = "OnDisOrHidMotion('+e+')"/></td>';h+='<td align = "center" style = "width:295px"><input style = "width:145px; height:25px; border:0; background:url(res/145x25_btn.jpg);cursor:pointer;" type = "button" value = '+set_button+" onclick='GotoMotionAreaSet("+e+")'/></td>"}h+="</tr>"}else{h+="<tr>";h+='<td style = "text-align:center;width:50px;">'+(e+1)+"</td>";h+='<td style = "text-align:center;width:68px;"><input type = "checkbox" name = "motion_enable" style = "width:30px;" onchange = "g_bChange = true;" /></td>';if(!g_US02){h+='<td><select style = "width:130px" name = "motion_hold_time" onchange = "g_bChange = true;"></select></td>';h+='<td align = "center" style = "width:225px"><input style = "width:145px; height:25px; border:0; background:url(res/145x25_btn.jpg);cursor:pointer;" type = "button" value = '+set_button+' onclick = "OnDisOrHidMotion('+e+')"/></td>';h+='<td align = "center" style = "width:225px"><input style = "width:145px; height:25px; border:0; background:url(res/145x25_btn.jpg);cursor:pointer;" type = "button" value = '+set_button+" onclick='GotoMotionAreaSet("+e+")'/></td>"}else{h+='<td align = "center" style = "width:290px"><input style = "width:145px; height:25px; border:0; background:url(res/145x25_btn.jpg);cursor:pointer;" type = "button" value = '+set_button+' onclick = "OnDisOrHidMotion('+e+')"/></td>';h+='<td align = "center" style = "width:290px"><input style = "width:145px; height:25px; border:0; background:url(res/145x25_btn.jpg);cursor:pointer;" type = "button" value = '+set_button+" onclick='GotoMotionAreaSet("+e+")'/></td>"}h+="</tr>"}}h+="</tbody></table>";if(d){var f=g.parentElement}else{var f=g.parentNode}f.innerHTML=h;for(var e=0;e<j;e++){if(!g_US02){GenSelectListEx(document.getElementsByName("motion_hold_time")[e],g_alarmOutHoldTime)}}g=f.childNodes[0]}function MotionTriggerPTZ(g,a,b,j){var d=/msie/i.test(navigator.userAgent);var h=g.outerHTML.toLowerCase();var c=h.indexOf("</tbody>");h=h.substr(0,c);h+="<tr class = 'table_head_bgcolor'>";for(var e=0;e<a;e++){h+='<td style = "text-align:center">'+b[e]+"</td>"}h+="</tr>";for(var e=1;e<j+1;e++){h+="<tr>";h+='<td style = "width:180px;text-align:center">'+e+"</td>";h+='<td><select style = "width:260px" name = "ptz_type" onchange = "onMotionChangePtzType(this,'+e+');bTrigger = true"></select></td>';h+='<td><select style = "width:260px" name = "ptz_number" disabled = "disabled" onchange = "bTrigger = true;"></select></td>';h+="</tr>"}h+="</tbody></table>";if(d){var f=g.parentElement}else{var f=g.parentNode}f.innerHTML=h;g_motionPTZTypeCopy=g_motionPTZType.slice(0);g_motionPTZTypeCopy.splice(g_motionPTZType.length-1,1);for(var e=1;e<j+1;e++){if(e>g_local_ch_num){GenSelectListEx(document.getElementsByName("ptz_type")[e-1],g_motionPTZTypeCopy)}else{GenSelectListEx(document.getElementsByName("ptz_type")[e-1],g_motionPTZType)}}g=f.childNodes[0]}function OnEnterMotinoArea(l){var f=document.getElementsByName("motion_oper");f[0].checked="checked";WebClient.SetVisible(3|(l<<8));l=parseInt(l,10);g_curMotionSetChannel=l;var a=g_xmlDoc.documentElement.getElementsByTagName("command");if(a.length>0){var h=a[0].getElementsByTagName("parameter");for(var g=0;g<h.length;g++){var b=h[g].attributes.getNamedItem("name").nodeValue;if(b==STR_MOTION_AREA){break}}if(g==a.length){window.alert(no_motion_info_tip);return}var j=h[g+l].childNodes[0].nodeValue;var d=j.split("+");var e=document.getElementById("sensi_bk");var c=document.getElementById("sensi_thumb");SetSliderPos(e,c,parseInt(d[2],10)+1);WebClient.SetMotionAreaInfo(j)}SetAreaEditMode(0)}function SaveMotionArea(){var f=WebClient.GetMotionAreaInfo();var h=document.getElementById("sensi_bk");var c=document.getElementById("sensi_thumb");var g=g_xmlDoc.documentElement.getElementsByTagName("command");if(g.length>0){var e=g[0].getElementsByTagName("parameter");for(var d=0;d<e.length;d++){var b=e[d].attributes.getNamedItem("name").nodeValue;if(b==STR_MOTION_AREA){break}}if(d==g.length){window.alert(no_motion_info_tip)}var a=f.split("+");a[2]=GetSliderPos(h,c)-1;f=a.join("+");if(e[d+g_curMotionSetChannel].childNodes[0].nodeValue!=f){e[d+g_curMotionSetChannel].childNodes[0].nodeValue=f;g_bChange=true}}}function SetAreaEditMode(a){WebClient.SetMotionEditMode(a)}function MotionMarkAll(){WebClient.SetMotionEditMode(2)}function MotionInvertMark(){WebClient.SetMotionEditMode(3)}function GotoMotionAreaSet(j){var n=document.getElementById("div_main_menu");var o=document.getElementById("div_config");var l=document.getElementById("div_ocx");var b=document.getElementById("div_live");o.style.display="none";l.style.display="";WebClient.style.display="";b.style.display="";l.style.left=n.offsetLeft+5;l.style.top=n.offsetTop+n.offsetHeight;l.style.width=770;WebClient.style.width="";WebClient.style.width="770px";var a=/msie/i.test(navigator.userAgent);if(a){ocx_alt_label.style.display=""}g_xmlhttp.open("get","body_html/body_motion_area.html",false);SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState==4){b.innerHTML=g_xmlhttp.responseText;var e=document.getElementById("motion_area_channel_list");var m=document.getElementById("div_motion_sensi");var d=document.getElementById("sensi_bk");var c=document.getElementById("sensi_thumb");var h=document.getElementById("sensi_tip");CreateSlider(m,d,c,h,1,8);SetSliderPos(d,c,4);GenSelectListEx(e,g_TotalChannelList);e.value=j;EdgeCtrl(l,32);ApplyXmlLang("cfg_motion_area.xml");OnEnterMotinoArea(j)}if(document.getElementById("div_ocx").offsetHeight>document.getElementById("div_live").offsetHeight){var p=document.getElementById("div_ocx").offsetHeight+5;document.getElementById("div_live").style.height="";document.getElementById("div_live").style.height=p+"px";if(a){document.getElementById("div_ocx").style.height="";document.getElementById("div_ocx").style.height=p+"px"}WebClient.style.height=p+"px";if(!a){var g=p+40;document.getElementById("work_area").style.height=g+"px"}}else{var f=document.getElementById("div_live").offsetHeight-5;document.getElementById("div_ocx").style.height="";document.getElementById("div_ocx").style.height=f+"px";WebClient.style.height=f+"px";if(!a){var g=f+40;document.getElementById("work_area").style.height=g+"px"}}}function ExitMotionAreaSet(){var d=document.getElementById("div_config_index");var a=document.getElementById("div_ocx");var c=document.getElementById("div_live");var b=document.getElementById("div_config");WebClient.SetVisible(0);a.style.width="0px";a.style.height="0px";WebClient.style.width="0px";WebClient.style.height="0px";c.style.display="none";c.innerHTML="";b.style.display="";ocx_alt_label.style.display="none";Align();EdgeCtrl(d,72)}function OnDisOrHidMotion(h){var m=document.getElementById("div_motion_trigger");var l=document.getElementById("motion_index_num");var f=document.getElementById("motion_to_bigview_ctrl");var b=document.getElementById("motion_trigger_out");var c=document.getElementById("motion_trigger_record");var d=document.getElementById("motion_snap");var e=document.getElementById("id_motion_ptz");var j=document.getElementById("id_motion_ftp");var a=document.getElementById("div_config_index");var g=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdateBooleanTrigger(g,STR_MOTION_TO_BUZZ,STR_MOTION_TO_BUZZ+"_ctrl",false);UpdateBooleanTrigger(g,STR_MOTION_TO_EMAIL,STR_MOTION_TO_EMAIL+"_ctrl",false);UpdateAlarmTrigger(g,STR_MOTION_TO_ALARM_OUT,STR_MOTION_TO_ALARM_OUT+"_ctrl",false);UpdateAlarmTrigger(g,STR_MOTION_TO_RECORD,STR_MOTION_TO_RECORD+"_ctrl",false);UpdateAlarmTrigger(g,STR_MOTION_TO_SNAP,STR_MOTION_TO_SNAP+"_ctrl",false);UpdateAlarmTrigger(g,STR_MOTION_TO_FTP,STR_MOTION_TO_FTP+"_ctrl",false);UpdateBigView(g,STR_MOTION_TO_BIGVIEW,STR_MOTION_TO_BIGVIEW+"_ctrl",false);UpdateAlarmToPtz(g,false,g_curchannel_motion);m.style.display="";l.innerHTML="<b>"+channel_string+(h+1)+"</b>";g_curchannel_motion=h;for(i=0;i<g_local_ch_num+g_net_ch_num;i++){document.getElementsByName("ptz_type")[i].disabled=false;document.getElementsByName("ptz_number")[i].disabled=false}for(k=0;k<g_bUpdataChannel.length;k++){if(k!=h){g_bUpdataChannel[k]=0}else{g_bUpdataChannel[k]=1}}GenSelectListEx(f,g_bigViewList);var g=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdateBooleanTrigger(g,STR_MOTION_TO_BUZZ,STR_MOTION_TO_BUZZ+"_ctrl",true);UpdateBooleanTrigger(g,STR_MOTION_TO_EMAIL,STR_MOTION_TO_EMAIL+"_ctrl",true);UpdateAlarmTrigger(g,STR_MOTION_TO_ALARM_OUT,STR_MOTION_TO_ALARM_OUT+"_ctrl",true);UpdateAlarmTrigger(g,STR_MOTION_TO_RECORD,STR_MOTION_TO_RECORD+"_ctrl",true);UpdateAlarmTrigger(g,STR_MOTION_TO_SNAP,STR_MOTION_TO_SNAP+"_ctrl",true);UpdateAlarmTrigger(g,STR_MOTION_TO_FTP,STR_MOTION_TO_FTP+"_ctrl",true);UpdateBigView(g,STR_MOTION_TO_BIGVIEW,STR_MOTION_TO_BIGVIEW+"_ctrl",true);UpdateAlarmToPtz(g,true);if(h<g_local_ch_num+g_net_ch_num){document.getElementsByName("ptz_type")[h].disabled="disabled";document.getElementsByName("ptz_number")[h].disabled="disabled"}UpdateCheckItems(b);UpdateCheckItems(c);UpdateCheckItems(d);UpdateCheckItems(j);Align();EdgeCtrl(a,72);location.href="#motion_all_label"}function onMotionPTZSave(){if(!bTrigger){window.alert(cfg_nochange_tip)}else{var c=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdateBooleanTrigger(c,STR_MOTION_TO_BUZZ,STR_MOTION_TO_BUZZ+"_ctrl",false);UpdateBooleanTrigger(c,STR_MOTION_TO_EMAIL,STR_MOTION_TO_EMAIL+"_ctrl",false);UpdateAlarmTrigger(c,STR_MOTION_TO_ALARM_OUT,STR_MOTION_TO_ALARM_OUT+"_ctrl",false);UpdateAlarmTrigger(c,STR_MOTION_TO_RECORD,STR_MOTION_TO_RECORD+"_ctrl",false);UpdateAlarmTrigger(c,STR_MOTION_TO_SNAP,STR_MOTION_TO_SNAP+"_ctrl",false);UpdateAlarmTrigger(c,STR_MOTION_TO_FTP,STR_MOTION_TO_FTP+"_ctrl",false);UpdateBigView(c,STR_MOTION_TO_BIGVIEW,STR_MOTION_TO_BIGVIEW+"_ctrl",false);UpdateAlarmToPtz(c,false,g_curchannel_motion);var a=document.getElementById("div_motion_trigger");var b=document.getElementById("div_config_index");a.style.display="none";Align();EdgeCtrl(b,72)}for(k=0;k<g_bUpdataChannel.length;k++){g_bUpdataChannel[k]=0}}function onMotionPTZCancel(){var b=document.getElementById("div_config_index");var a=document.getElementById("div_motion_trigger");a.style.display="none";bTrigger=false;Align();EdgeCtrl(b,72);for(k=0;k<g_bUpdataChannel.length;k++){g_bUpdataChannel[k]=0}}function onMotionChangePtzType(b,a){var c=document.getElementsByName("ptz_number");if(b.value==-1){c[a-1].disabled=true;c[a-1].innerHTML=""}if(b.value==6){c[a-1].disabled=false;c[a-1].innerHTML="";if(g_cruiseList[a-1].length==0){GenSelectListEx(c[a-1],new Array(new CSelectOptionInfo("- - -",-1)));return}GenSelectListEx(c[a-1],g_cruiseList[a-1])}if(b.value==3){c[a-1].disabled=false;c[a-1].innerHTML="";GenSelectListEx(c[a-1],g_presetList)}if(b.value==7){c[a-1].disabled=false;c[a-1].innerHTML="";GenSelectListEx(c[a-1],g_trackList)}}function disAllMotion(){var e=document.getElementById("div_config_index");var a=document.getElementById("div_motion_trigger");var f=document.getElementById("motion_trigger_out");var c=document.getElementById("motion_trigger_record");var g=document.getElementById("motion_snap");var d=document.getElementById("id_motion_ftp");var b=document.getElementById("motion_index_num");a.style.display="";b.innerHTML="<b>"+str_all_channel+"</b>";UpdateCheckItems(f);UpdateCheckItems(c);UpdateCheckItems(g);UpdateCheckItems(d);Align();EdgeCtrl(e,72);location.href="#motion_all_label"};