var g_userList=new Array();var g_userGroup=new Array(new CSelectOptionInfo(admin_string,1),new CSelectOptionInfo(advance_string,2),new CSelectOptionInfo(normal_string,4));var g_userGroupShow=new Array(new CSelectOptionInfo(advance_string,2),new CSelectOptionInfo(normal_string,4));var cfg_user_header=new Array(str_username,str_usertype,str_mac);function UserInfo(c,n,m,j,f,g,d,l,b,a,e,h){this.name=c;this.password=n;this.group=m;this.bindMac=f;this.bBindMac=j;this.operAuth=g;this.authRecordCH=d;this.authPlaybackCH=l;this.authBackupCH=b;this.authPTZCtrlCH=a;this.authRemoteViewCH=e;this.authLocalViewCH=h}function OnLoadCfgUser(){var m=document.getElementById("table_user");ApplyXmlLang("cfg_user.xml");g_userListCtrl=CreateListCtrl(m,3,cfg_user_header,16);var l=document.getElementById("user_record_auth");var t=document.getElementById("user_playback_auth");var e=document.getElementById("user_backup_auth");var c=document.getElementById("user_ptzctrl_auth");var s=document.getElementById("user_remoteview_auth");var u=document.getElementById("user_localview_auth");var v=document.getElementById("talk_auth");var d=document.getElementById("user_audiotalk_label");var o=document.getElementById("user_mac");var r=document.getElementById("user_add_label");var b=document.getElementById("user_del_button");var h=document.getElementById("user_modify_button");GenCheckGroup(l,true,g_TotalChannelList,"channel_index");GenCheckGroup(t,true,g_TotalChannelList,"channel_index");GenCheckGroup(e,true,g_TotalChannelList,"backup_auth");GenCheckGroup(c,true,g_TotalChannelList,"ptzctrl_auth");GenCheckGroup(s,true,g_TotalChannelList,"remoteview_auth");GenCheckGroup(u,true,g_TotalChannelList,"localview_auth");var f=document.getElementsByName("user_group")[0];GenSelectListEx(f,g_userGroupShow);var g=document.getElementById("net_device_auth");var j=document.getElementById("net_device_man_label");if(g_net_ch_num==0){g.style.display="none";j.style.display="none"}if(!const_support_talkback){v.style.display="none";d.style.display="none"}var a=new MultiEdit("mac_ctrl",0);o.innerHTML=a;o.macCtrl=a;if(!(g_authority.authority&16384)){r.style.display="none";b.style.display="none";h.style.display="none";g_userListCtrl.bEnable=false}var p=CreateConfigReqXml(user_config_array);var q=WebClient.ExcuteCmd(p);if(q==""){return false}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(q);g_xmlDoc.async=false;var n=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");ParseUserInfo(n);Align()}function OnSaveUserConfig(){var e="0000000000000000";var d=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");for(var h=0;h<d.length;h++){var c=g_userList[h].group+"+";c+=g_userList[h].name.size()+":"+g_userList[h].name+"+";c+=g_userList[h].password.size()+":"+g_userList[h].password+"+";c+=g_userList[h].bindMac+"+";c+=g_userList[h].bBindMac+"+";if(g_channelList.length==32){g_userList[h].authRecordCH=g_userList[h].authRecordCH>>>0;g_userList[h].authPlaybackCH=g_userList[h].authPlaybackCH>>>0;g_userList[h].authBackupCH=g_userList[h].authBackupCH>>>0;g_userList[h].authPTZCtrlCH=g_userList[h].authPTZCtrlCH>>>0;g_userList[h].authRemoteViewCH=g_userList[h].authRemoteViewCH>>>0;g_userList[h].authLocalViewCH=g_userList[h].authLocalViewCH>>>0}var j=g_userList[h].operAuth.toString(16);j=e.substr(0,8-j.length)+j;c+=j+"+";var f=g_userList[h].authRecordCH.toString(16);f=e.substr(0,16-f.length)+f;c+=f+"+";var m=g_userList[h].authPlaybackCH.toString(16);m=e.substr(0,16-m.length)+m;c+=m+"+";var b=g_userList[h].authBackupCH.toString(16);b=e.substr(0,16-b.length)+b;c+=b+"+";var a=g_userList[h].authPTZCtrlCH.toString(16);a=e.substr(0,16-a.length)+a;c+=a+"+";var g=g_userList[h].authRemoteViewCH.toString(16);g=e.substr(0,16-g.length)+g;c+=g+"+";var l=g_userList[h].authLocalViewCH.toString(16);l=e.substr(0,16-l.length)+l;c+=l;d[h].childNodes[0].nodeValue=c}}function ParseUserInfo(s){g_userList=new Array(s.length);g_userListCtrl.Clear();for(var t=0;t<s.length;t++){var p=s[t].childNodes[0].nodeValue;var j=0;var n=parseInt(p,10);j=p.indexOf("+")+1;p=p.substr(j);var l=parseInt(p,10);j=p.indexOf(":")+1;var u=p.SubStringOfBytes(j,l);p=p.substr(j+u.length+1);var m=parseInt(p,10);j=p.indexOf(":")+1;var a=p.SubStringOfBytes(j,m);p=p.substr(j+a.length+1);var g=p.substr(0,17);p=p.substr(18);var q=parseInt(p,10);j=p.indexOf("+")+1;p=p.substr(j);var c=parseInt(p,16);j=p.indexOf("+")+1;p=p.substr(j);var e=parseInt(p,16);j=p.indexOf("+")+1;p=p.substr(j);var f=parseInt(p,16);j=p.indexOf("+")+1;p=p.substr(j);var o=parseInt(p,16);j=p.indexOf("+")+1;p=p.substr(j);var h=parseInt(p,16);j=p.indexOf("+")+1;p=p.substr(j);var b=parseInt(p,16);j=p.indexOf("+")+1;p=p.substr(j);var d=parseInt(p,16);j=p.indexOf("+")+1;p=p.substr(j);g_userList[t]=new UserInfo(u,a,n,q,g,c,e,f,o,h,b,d);if(n!=0){for(var r=0;r<g_userGroup.length;r++){if(g_userGroup[r].optionValue==n){g_userListCtrl.AddOneItem(new Array(u,g_userGroup[r].optionName,g));break}}}}UserList.Instance().userCount=0;for(t=0;t<g_userList.length;t++){if(g_userList[t].group!=0){UserList.Instance().userCount++}}DisplayUser()}function DisplayUser(){var a=document.getElementById("user_list_page");var e=/msie/i.test(navigator.userAgent);g_userListCtrl.Clear();var d=UserList.Instance().curPage;if(e){a.innerText=(d+1)+" / "+Math.ceil(UserList.Instance().userCount/16)}else{a.textContent=(d+1)+" / "+Math.ceil(UserList.Instance().userCount/16)}for(var c=d*16;c<(d+1)*16;c++){if(c>=UserList.Instance().userCount){break}var b=ConvertToListItem(g_userList[c]);g_userListCtrl.AddOneItem(b)}}function OnAddUser(){var j=document.getElementById("div_config_index");var y=document.getElementById("user_info_pane");var e=document.getElementById("btn_group_add");var t=document.getElementById("id_ptz");var b=document.getElementById("userconfig_errortips");var f=document.getElementById("btn_group_modify");var v=document.getElementById("modify_password");var e=document.getElementById("btn_group_add");var u=document.getElementById("user_mac");var a=document.getElementById("user_config_label");var q=document.getElementById("user_authority");var s=document.getElementById("user_auth_group");var r=document.getElementById("user_record_auth");var x=document.getElementById("user_playback_auth");var g=document.getElementById("user_backup_auth");var d=document.getElementById("user_ptzctrl_auth");var w=document.getElementById("user_remoteview_auth");var z=document.getElementById("user_localview_auth");if(g_loginUser!="admin"){window.alert(user_no_authority_add);return}if((y.style.display=="")&&(e.style.display=="")){return}if(!g_supportFunctions.IsSupportPTZ()){t.style.display="none"}b.innerHTML="";y.style.display="";f.style.display="none";v.style.display="none";e.style.display="";document.getElementsByName("new_password")[0].parentNode.parentNode.style.display="";document.getElementsByName("confirm_password")[0].parentNode.parentNode.style.display="";document.getElementsByName("user_name")[0].readOnly=false;document.getElementsByName("user_name")[0].style.backgroundColor="";document.getElementsByName("user_name")[0].value="";document.getElementsByName("new_password")[0].value="";document.getElementsByName("confirm_password")[0].value="";document.getElementsByName("user_group")[0].value=4;document.getElementsByName("enable_mac")[0].checked=false;u.macCtrl.setValue("00-00-00-00-00-00");var c=document.getElementsByName("chk_oper_auth");for(i=0;i<c.length;i++){c[i].checked=true}var p=r.getElementsByTagName("input");var o=x.getElementsByTagName("input");var n=g.getElementsByTagName("input");var m=d.getElementsByTagName("input");var l=w.getElementsByTagName("input");var h=z.getElementsByTagName("input");for(i=0;i<p.length;i++){p[i].checked=true;o[i].checked=true;n[i].checked=true;if(m[i]){m[i].checked=true}l[i].checked=true;h[i].checked=true}if(g_supportSimpleUserMan){a.style.display="none";q.style.display="none";s.style.display="none"}OnChangeUserType(document.getElementsByName("user_group")[0]);OnCheckBindMac();Align();EdgeCtrl(j,72);location.href="#user_add_label"}function OnDelUser(){var h=document.getElementById("div_config_index");var g=document.getElementById("userconfig_errortips");var a=document.getElementById("table_user");var f=document.getElementById("modify_password");g.innerHTML="";if(g_loginUser!="admin"){window.alert(user_no_authority_del);return}var d=g_userListCtrl.GetCurSel();if(d==-1){window.alert(user_select);OnUserCancel();return}var c=d+1;d=d+UserList.Instance().curPage*16;if(g_userList[d].group==g_userGroup[0].optionValue){window.alert(user_admin_del_tip);return}if(confirm(delete_user_confirm)){OnUserCancel();f.style.display="none";g_userList[d].group=0;var b=g_userList[d];for(var e=d;e<g_userList.length-1;e++){g_userList[e]=g_userList[e+1]}g_userList[e]=b;UserList.Instance().userCount--;if(UserList.Instance().userCount<=UserList.Instance().curPage*16){UserList.Instance().curPage--}OnSaveConfig();DisplayUser();if(a){a.rows[c].style.background=ptz_pincruise_unsel_bg;a.rows[c].style.color=ptz_pincruise_unsel_color}Align()}}function OnModifyUser(){var q=document.getElementById("div_config_index");var b=document.getElementById("userconfig_errortips");var B=document.getElementById("user_info_pane");var h=document.getElementById("btn_group_add");var y=document.getElementById("modify_password");var m=document.getElementById("btn_group_modify");var v=document.getElementById("user_mac");var h=document.getElementById("btn_group_add");var a=document.getElementById("user_config_label");var r=document.getElementById("user_authority");var t=document.getElementById("user_auth_group");var s=document.getElementById("user_record_auth");var A=document.getElementById("user_playback_auth");var n=document.getElementById("user_backup_auth");var g=document.getElementById("user_ptzctrl_auth");var z=document.getElementById("user_remoteview_auth");var C=document.getElementById("user_localview_auth");b.innerHTML="";if(g_loginUser!="admin"){window.alert(user_no_authority_mod);return}var l=g_userListCtrl.GetCurSel();if(l==-1){window.alert(user_select);return}l=l+UserList.Instance().curPage*16;if(g_userGroup[0].optionValue==g_userList[l].group){window.alert(user_admin_mod_tip);B.style.display="none";Align();EdgeCtrl(q,72);return}B.style.display="";h.style.display="none";y.style.display="none";m.style.display="";document.getElementsByName("user_name")[0].readOnly=true;document.getElementsByName("user_name")[0].style.backgroundColor="#D4E8FE";document.getElementsByName("new_password")[0].parentNode.parentNode.style.display="none";document.getElementsByName("confirm_password")[0].parentNode.parentNode.style.display="none";Align();EdgeCtrl(q,72);location.href="#user_add_label";document.getElementsByName("user_name")[0].value=g_userList[l].name;document.getElementsByName("user_group")[0].value=g_userList[l].group;document.getElementsByName("enable_mac")[0].checked=g_userList[l].bBindMac;v.macCtrl.setValue(g_userList[l].bindMac);OnCheckBindMac();var f=document.getElementsByName("chk_oper_auth");for(i=0;i<f.length;i++){if(g_userList[l].operAuth&parseInt(f[i].value,10)){f[i].checked=true}else{f[i].checked=false}}var e=0;for(var p=0;p<s.rows.length;p++){var u=s.rows[p].getElementsByTagName("input");var d=A.rows[p].getElementsByTagName("input");var D=n.rows[p].getElementsByTagName("input");var c=g.rows[p].getElementsByTagName("input");var x=z.rows[p].getElementsByTagName("input");var w=C.rows[p].getElementsByTagName("input");var o=(u.length-1);if(p==0){e=u.length-1}for(var j=0;j<o;j++){if((p>0)&&(p==(s.rows.length-1))){u[j+1].checked=!!(g_userList[l].authRecordCH&(1<<(p*e)+j));d[j+1].checked=!!(g_userList[l].authPlaybackCH&(1<<(p*e)+j));D[j+1].checked=!!(g_userList[l].authBackupCH&(1<<(p*e)+j));c[j+1].checked=!!(g_userList[l].authPTZCtrlCH&(1<<(p*e)+j));x[j+1].checked=!!(g_userList[l].authRemoteViewCH&(1<<(p*e)+j));w[j+1].checked=!!(g_userList[l].authLocalViewCH&(1<<(p*e)+j))}else{u[j+1].checked=!!(g_userList[l].authRecordCH&(1<<(p*o)+j));d[j+1].checked=!!(g_userList[l].authPlaybackCH&(1<<(p*o)+j));D[j+1].checked=!!(g_userList[l].authBackupCH&(1<<(p*o)+j));c[j+1].checked=!!(g_userList[l].authPTZCtrlCH&(1<<(p*o)+j));x[j+1].checked=!!(g_userList[l].authRemoteViewCH&(1<<(p*o)+j));w[j+1].checked=!!(g_userList[l].authLocalViewCH&(1<<(p*o)+j))}}}if(g_supportSimpleUserMan){a.style.display="none";r.style.display="none";t.style.display="none"}UpdateCheckItems(s);UpdateCheckItems(A);UpdateCheckItems(n);UpdateCheckItems(g);UpdateCheckItems(z);UpdateCheckItems(C)}function OnModPwd(){var b=document.getElementById("div_config_index");var a=document.getElementById("userconfig_errortips");var h=document.getElementById("user_info_pane");var d=document.getElementById("btn_group_modify");var c=document.getElementById("modify_password");var j=document.getElementById("mod_pwd_username");var g=document.getElementById("mod_old_pwd");var e=document.getElementById("mod_new_pwd");var f=document.getElementById("mod_confirm_pwd");a.innerHTML="";h.style.display="none";d.style.display="none";c.style.display="";j.value=g_loginUser;g.value="";e.value="";f.value="";Align();EdgeCtrl(b,72);location.href="#user_add_label"}function OnModPwdOK(){var c=document.getElementById("div_config_index");var a=document.getElementById("userconfig_errortips");var h=document.getElementById("mod_old_pwd");var f=document.getElementById("mod_new_pwd");var g=document.getElementById("mod_confirm_pwd");var e=document.getElementById("modify_password");if(f.value!=g.value){SaveError(a,user_pwd_not_coherent_tip);location.href="#userconfig_errortips";return}if(f.value.length>const_password_max_len){SaveError(a,user_pwd_max_num_tip);location.href="#userconfig_errortips";return}var m=parseInt(const_software_ver.split("-")[2])==3;if(m){alert(str_remember_password)}var d="<request>\r\n";d+='<command name="'+STR_MODIFY_PASSWORD+'">\r\n';d+="<"+STR_OLD_PASSWORD+">"+h.value+"</"+STR_OLD_PASSWORD+">\r\n";d+="<"+STR_NEW_PASSWORD+">"+f.value+"</"+STR_NEW_PASSWORD+">\r\n";d+="</command>\r\n";d+="</request>\r\n";var b=WebClient.ExcuteCmd(d);if(b==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(b);g_xmlDoc.async=false;var l=g_xmlDoc.documentElement.getElementsByTagName("command")[0];if(l.getAttribute("name")==STR_MODIFY_PASSWORD_SUCC){e.style.display="none";a.innerHTML="";g_bChange=false}else{var j=l.getElementsByTagName("errorno")[0].childNodes[0].nodeValue;if(j==STR_PASSWORD_ERROR){SaveError(a,user_pwd_error_tip)}else{SaveError(a,j)}location.href="#userconfig_errortips";return}Align();EdgeCtrl(c,72)}function OnModPwdCancel(){var d=/msie/i.test(navigator.userAgent);var c=document.getElementById("userconfig_errortips");var a=document.getElementById("modify_password");var b=document.getElementById("div_config_index");if(d){c.innerText=""}else{c.innerText=""}a.style.display="none";Align();EdgeCtrl(b,72)}function OnAddUserOK(){var l=document.getElementById("div_config_index");var a=document.getElementById("userconfig_errortips");var p=document.getElementById("user_mac");var v=document.getElementById("user_info_pane");var m=document.getElementById("user_record_auth");var u=document.getElementById("user_playback_auth");var g=document.getElementById("user_backup_auth");var e=document.getElementById("user_ptzctrl_auth");var t=document.getElementById("user_remoteview_auth");var w=document.getElementById("user_localview_auth");var v=document.getElementById("user_info_pane");if(document.getElementsByName("user_name")[0].value==""){SaveError(a,user_name_empty_tip);location.href="#userconfig_errortips";return}if(document.getElementsByName("user_name")[0].value.sizeUTF8()>const_username_max_len){var n=user_name_constraint_tip+const_username_max_len+"!";SaveError(a,n);location.href="#userconfig_errortips";return}if(document.getElementsByName("new_password")[0].value.sizeUTF8()>const_password_max_len){SaveError(a,user_pwd_max_num_tip);location.href="#userconfig_errortips";return}if(document.getElementsByName("new_password")[0].value!=document.getElementsByName("confirm_password")[0].value){SaveError(a,user_pwd_not_coherent_tip);location.href="#userconfig_errortips";return}for(i=0;i<g_userList.length;i++){if(g_userList[i].group==0){g_userList[i].group=document.getElementsByName("user_group")[0].value;g_userList[i].name=document.getElementsByName("user_name")[0].value;g_userList[i].password=document.getElementsByName("new_password")[0].value;if(document.getElementsByName("enable_mac")[0].checked){g_userList[i].bBindMac=1;var s=p.macCtrl.getValue();s=s.toUpperCase();if(!IsValidMac(s)){SaveError(a,user_mac_invalid_tip);location.href="#userconfig_errortips";g_userList[i].bBindMac=0;g_userList[i].bindMac="00-00-00-00-00-00"}else{g_userList[i].bindMac=s}}else{g_userList[i].bBindMac=0;g_userList[i].bindMac="00-00-00-00-00-00"}g_userList[i].operAuth=1;var d=document.getElementsByName("chk_oper_auth");for(k=0;k<d.length;k++){if(d[k].checked){g_userList[i].operAuth|=parseInt(d[k].value,10)}}g_userList[i].authRecordCH=0;g_userList[i].authPlaybackCH=0;g_userList[i].authBackupCH=0;g_userList[i].authPTZCtrlCH=0;g_userList[i].authRemoteViewCH=0;g_userList[i].authLocalViewCH=0;for(var j=0;j<m.rows.length;j++){var o=m.rows[j].getElementsByTagName("input");var c=u.rows[j].getElementsByTagName("input");var x=g.rows[j].getElementsByTagName("input");var b=e.rows[j].getElementsByTagName("input");var r=t.rows[j].getElementsByTagName("input");var q=w.rows[j].getElementsByTagName("input");var h=(o.length-1);if(j==0){chPerRowLast=o.length-1}for(var f=0;f<h;f++){if((j>0)&&(j==m.rows.length-1)){if(o[f+1].checked){g_userList[i].authRecordCH|=(1<<(j*chPerRowLast)+f)}if(c[f+1].checked){g_userList[i].authPlaybackCH|=(1<<(j*chPerRowLast)+f)}if(x[f+1].checked){g_userList[i].authBackupCH|=(1<<(j*chPerRowLast)+f)}if(b[f+1].checked){g_userList[i].authPTZCtrlCH|=(1<<(j*chPerRowLast)+f)}if(r[f+1].checked){g_userList[i].authRemoteViewCH|=(1<<(j*chPerRowLast)+f)}if(q[f+1].checked){g_userList[i].authLocalViewCH|=(1<<(j*chPerRowLast)+f)}}else{if(o[f+1].checked){g_userList[i].authRecordCH|=(1<<(j*h)+f)}if(c[f+1].checked){g_userList[i].authPlaybackCH|=(1<<(j*h)+f)}if(x[f+1].checked){g_userList[i].authBackupCH|=(1<<(j*h)+f)}if(b[f+1].checked){g_userList[i].authPTZCtrlCH|=(1<<(j*h)+f)}if(r[f+1].checked){g_userList[i].authRemoteViewCH|=(1<<(j*h)+f)}if(q[f+1].checked){g_userList[i].authLocalViewCH|=(1<<(j*h)+f)}}}}UserList.Instance().userCount++;break}if(g_userList[i].name==document.getElementsByName("user_name")[0].value){SaveError(a,user_name_exist_tip);location.href="#userconfig_errortips";return}}a.innerHTML="";v.style.display="none";Align();EdgeCtrl(l,72);if(i==g_userList.length){window.alert(user_num_max_tip);return}UserList.Instance().curPage=Math.ceil(UserList.Instance().userCount/16)-1;DisplayUser();OnSaveConfig()}function OnModifyUserOK(){var r=document.getElementById("user_record_auth");var x=document.getElementById("user_playback_auth");var l=document.getElementById("user_backup_auth");var h=document.getElementById("user_ptzctrl_auth");var w=document.getElementById("user_remoteview_auth");var z=document.getElementById("user_localview_auth");var y=document.getElementById("user_info_pane");var d=document.getElementById("userconfig_errortips");var t=document.getElementById("user_mac");var q=document.getElementById("div_config_index");var p=g_userListCtrl.GetCurSel();p=UserList.Instance().curPage*16+p;g_userList[p].group=document.getElementsByName("user_group")[0].value;if(document.getElementsByName("enable_mac")[0].checked){g_userList[p].bBindMac=1;var v=t.macCtrl.getValue();v=v.toUpperCase();if(!IsValidMac(v)){SaveError(d,user_mac_invalid_tip);location.href="#userconfig_errortips";g_userList[p].bBindMac=0;g_userList[p].bindMac="00-00-00-00-00-00"}else{g_userList[p].bindMac=v}}else{g_userList[p].bBindMac=0;g_userList[p].bindMac="00-00-00-00-00-00"}g_userList[p].operAuth=1;var g=document.getElementsByName("chk_oper_auth");for(i=0;i<g.length;i++){if(g[i].checked){g_userList[p].operAuth|=parseInt(g[i].value,10)}}g_userList[p].authRecordCH=0;g_userList[p].authPlaybackCH=0;g_userList[p].authBackupCH=0;g_userList[p].authPTZCtrlCH=0;g_userList[p].authRemoteViewCH=0;g_userList[p].authLocalViewCH=0;var b=0;for(var o=0;o<r.rows.length;o++){var s=r.rows[o].getElementsByTagName("input");var f=x.rows[o].getElementsByTagName("input");var A=l.rows[o].getElementsByTagName("input");var e=h.rows[o].getElementsByTagName("input");var u=w.rows[o].getElementsByTagName("input");var c=z.rows[o].getElementsByTagName("input");var n=(s.length-1);if(o==0){b=s.length-1}for(var j=0;j<n;j++){if((o>0)&&(o==r.rows.length-1)){if(s[j+1].checked){g_userList[p].authRecordCH|=(1<<(o*b)+j)}if(f[j+1].checked){g_userList[p].authPlaybackCH|=(1<<(o*b)+j)}if(A[j+1].checked){g_userList[p].authBackupCH|=(1<<(o*b)+j)}if(e[j+1].checked){g_userList[p].authPTZCtrlCH|=(1<<(o*b)+j)}if(u[j+1].checked){g_userList[p].authRemoteViewCH|=(1<<(o*b)+j)}if(c[j+1].checked){g_userList[p].authLocalViewCH|=(1<<(o*b)+j)}}else{if(s[j+1].checked){g_userList[p].authRecordCH|=(1<<(o*n)+j)}if(f[j+1].checked){g_userList[p].authPlaybackCH|=(1<<(o*n)+j)}if(A[j+1].checked){g_userList[p].authBackupCH|=(1<<(o*n)+j)}if(e[j+1].checked){g_userList[p].authPTZCtrlCH|=(1<<(o*n)+j)}if(u[j+1].checked){g_userList[p].authRemoteViewCH|=(1<<(o*n)+j)}if(c[j+1].checked){g_userList[p].authLocalViewCH|=(1<<(o*n)+j)}}}}var a=r.getElementsByTagName("input");for(i=0;i<a.length;i++){if(a[i].checked){g_userList[p].channelAuth|=(1<<i)}}var m=ConvertToListItem(g_userList[p]);p=p-UserList.Instance().curPage*16;g_userListCtrl.ChangeItem(p,m);y.style.display="none";d.innerHTML="";Align();EdgeCtrl(q,72);OnSaveConfig()}function OnUserCancel(){var d=/msie/i.test(navigator.userAgent);var c=document.getElementById("userconfig_errortips");var b=document.getElementById("user_info_pane");var a=document.getElementById("div_config_index");if(d){c.innerText=""}else{c.textContent=""}b.style.display="none";Align();EdgeCtrl(a,72)}function OnCheckBindMac(){var a=document.getElementById("user_mac");if(document.getElementsByName("enable_mac")[0].checked){a.macCtrl.setEnable(true)}else{a.macCtrl.setEnable(false)}}function ConvertToListItem(c){var b=new Array(3);b[0]=c.name;for(var a=0;a<g_userGroup.length;a++){if(g_userGroup[a].optionValue==c.group){b[1]=g_userGroup[a].optionName;break}}if(c.bBindMac){b[2]=c.bindMac}else{b[2]="00-00-00-00-00-00"}return b}function IsValidMac(a){if(a.search(/^[0-9a-f]{2}(-[0-9a-f]{2}){5}$/i)!=-1){return true}else{return false}}function OnChangeUserType(f){var d=document.getElementById("logview_auth");var a=document.getElementById("cfg_auth");var g=document.getElementById("shutdown_auth");var c=document.getElementById("talk_auth");var e=document.getElementById("data_auth");var l=document.getElementById("disk_auth");var h=document.getElementById("rlogin_auth");var b=document.getElementById("rview_auth");var j=document.getElementById("net_device_auth");if(f.value==g_userGroup[2].optionValue){d.checked=false;a.checked=false;g.checked=false;c.checked=true;e.checked=false;l.checked=false;h.checked=true;b.checked=true;j.checked=false}if(f.value==g_userGroup[1].optionValue){d.checked=true;a.checked=true;g.checked=false;c.checked=true;e.checked=true;l.checked=true;h.checked=true;b.checked=true;j.checked=true}}function UserList(){this.curPage=0;this.userCount=0}UserList.prototype={FirstPage:function(){if(this.curPage==0){return}this.curPage=0;DisplayUser()},NextPage:function(){if((this.curPage+1)*16>=this.userCount){return}this.curPage++;DisplayUser()},PrevPage:function(){if(this.curPage>0){this.curPage--;DisplayUser()}},LastPage:function(){var a=Math.ceil(this.userCount/16)-1;if(a==this.curPage){return}this.curPage=a;DisplayUser()}};UserList.instance=null;UserList.Instance=function(){if(UserList.instance==null){UserList.instance=new UserList}return UserList.instance};