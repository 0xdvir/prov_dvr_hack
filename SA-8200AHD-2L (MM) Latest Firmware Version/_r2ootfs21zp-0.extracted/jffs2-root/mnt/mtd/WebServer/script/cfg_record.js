var cfg_record_time_header=new Array(str_ch,str_record,str_audio,str_redundancy_rec,str_pre_alarmtime,str_post_alarmtime,str_holdtimed);var cfg_record_stream_header=new Array(str_ch,str_resolution,str_rate,str_encodetype,str_quality,str_maxbitrate);var g_curRecType=0;var g_ipc_surportRes=new Object();var g_BitRatexmlDoc=createXMLDoc();var g_bBitRatedef=false;var LOW_CLOSEST=0;var LOW_OR_HIGH_CLOSEST=1;var HIGH_CLOSEST=2;var MAX_BITRATE_ON_VGA=2048;var MAX_BITRATE_ON_HD720=6144;var MAX_BITRATE_ON_HD1080=12288;var MAX_SUGGEST_BITRATE_ON_HD1080=6144;var MAX_SUGGEST_BITRATE_ON_960P=4096;var MAX_SUGGEST_BITRATE_ON_1D3M=5120;var MAX_SUGGEST_BITRATE_ON_3M=9216;var g_GetIPCChannelResolutionRate=30;var g_GetIPCChannelResolutionBitstream=4096;var g_bUseStaticVideoBitRate=false;function g_vsBitRateInfo(b,a){this.videoSize=b;this.bitRate=a}g_vsBitRateInfo=new Array(new g_vsBitRateInfo(8,1024),new g_vsBitRateInfo(16,6144),new g_vsBitRateInfo(32,4096),new g_vsBitRateInfo(512,4096),new g_vsBitRateInfo(2048,6144),new g_vsBitRateInfo(4096,6144));function GetIPCRes(){var c=CreateConfigReqXml(ipc_support_encode_array);var a=WebClient.ExcuteCmd(c);if(a==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(a);g_xmlDoc.async=false;var d=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");var b=d[0].childNodes[0].nodeValue.split("+");if(g_videoFormat=="NTSC"){g_ipc_surportRes.maxChnnRate=parseInt(b[1],10);g_ipc_surportRes.maxTotalRateOnVGA=parseInt(b[3],10);g_ipc_surportRes.maxTotalBitRate=b[4];g_ipc_surportRes.defaResolution=b[5];g_ipc_surportRes.defaChnnRate=b[6];g_ipc_surportRes.defaBitRate=b[7];g_ipc_surportRes.limitByBitRate=b[8]}else{g_ipc_surportRes.maxChnnRate=parseInt(b[1],10);g_ipc_surportRes.maxTotalRateOnVGA=b[3];g_ipc_surportRes.maxTotalBitRate=b[4];g_ipc_surportRes.defaResolution=b[5];g_ipc_surportRes.defaChnnRate=b[6];g_ipc_surportRes.defaBitRate=b[7];g_ipc_surportRes.limitByBitRate=b[8]}}function ShowResource(g,a){var b=(g-a);var d=parseInt(const_hardware_ver.split(".")[0],10);var c=document.getElementById("remain_source");var f=/msie/i.test(navigator.userAgent);var e=false;for(i=0;i<g_majorEncodeProperty.length;i++){for(j=0;j<g_majorEncodeProperty[i].length;j++){if(g_majorEncodeProperty[i][j].optionName.toLowerCase()=="hd1"){e=true;break}}}if((TD_2324SE_S==d)||(TD_2316SE_S==d)||(TD_2316CDS==d)){if(f){c.innerText=str_source_remain+": "+b+"(CIF)."}else{c.textContent=str_source_remain+": "+b+"(CIF)."}}else{if(!e){if(f){c.innerText=str_source_remain+": "+b+"(CIF) , "+Math.floor(b/4)+"(D1)."}else{c.textContent=str_source_remain+": "+b+"(CIF) , "+Math.floor(b/4)+"(D1)."}}else{if(f){c.innerText=str_source_remain+": "+b+"(CIF) , "+Math.floor(b/2)+"(HD1) , "+Math.floor(b/4)+"(D1)."}else{c.textContent=str_source_remain+": "+b+"(CIF) , "+Math.floor(b/2)+"(HD1) , "+Math.floor(b/4)+"(D1)."}}}}function OnLoadCfgRecBasic(){ApplyXmlLang("cfg_record.xml");var c=document.getElementById("id_record_channel_cfg");var a=document.getElementById("all_pre_alarm_rec_time");var f=document.getElementById("all_post_alarm_rec_time");var m=document.getElementById("all_rec_hold_time");var b=document.getElementById("all_rec_enable");var q=document.getElementById("all_rec_has_audio");var n=document.getElementById("all_rec_redundant");CreateListRecBasic(c,7,cfg_record_time_header,g_ch_num);c=document.getElementById("id_record_channel_cfg");GenSelectListEx(a,g_preAlarmRecTime);GenSelectListEx(f,g_postAlarmRecTime);GenSelectListEx(m,g_recDataHoldTime);b.checked=true;q.checked=true;a.value=g_maxAlarmRecTime;f.value=30;m.value=0*86400;if(!g_supportRecRedundancy){n.parentNode.style.display="none";var s=c.rows;for(var k=0;k<s.length;k++){s[k].cells[3].style.display="none"}}g_bRecycle=false;var r=CreateConfigReqXml(rec_basic_config_array);var h=WebClient.ExcuteCmd(r);if(h==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(h);g_xmlDoc.async=false;var l=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdateValues(l,true);if(g_local_ch_num>0&&g_net_ch_num>0){var p=/msie/i.test(navigator.userAgent);var e=document.getElementsByName("rec_has_audio");for(var k=0;k<l.length;k++){if(l[k].getAttribute("name")==STR_REC_HAS_AUDIO){var g=false;for(var d=0;d<g_audioList.length;d++){if(l[k].getAttribute("index")==g_audioList[d].optionValue){g=true;break}}if(g){continue}var o=l[k].getAttribute("index")-g_audioList.length+g_local_ch_num;if(o>=g_local_ch_num&&o<g_local_ch_num+g_net_ch_num){if(p){if(l[k].text=="1"){e[o].checked=true}}else{if(l[k].childNodes[0].nodeValue=="1"){e[o].checked=true}}}}}}OnRecBasicCheckAll();Align()}function LoadDefaultCfgRecBasic(){if(GetDefaultCfg(rec_basic_config_array)){var a=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdateValues(a,true);OnRecBasicCheckAll();g_bChange=true;Align()}}function NeedLimitedResoltion(c,a){if(c==TD_2308SS_C||c==TD_2308SL_C||c==TD_2316SS_C||c==TD_2308SE_C||c==TD_2316SE_C||c==TD_2308ME_C||c==TD_2316ME_C){for(var b=0;b<a.length;b++){if(a[b].optionName=="WD1"||a[b].optionName=="960H"){return true}if(g_US02&&a[b].optionName=="Best(960H)"){return true}}}return false}function NeedLimitedFrameRate(d,b,a){if(d==TD_2716XD_M&&b==16){return true}if(d==TD_2708XD_M&&b==16){return true}if(d==TD_2708XE_MH&&b==16){return true}if(d==TD_2708TS_PL||TD_2704TS_PL==d||TD_2716TS_PL==d){if(b==16||b==32){return true}}if(d==TD_2516HS_BL){for(var c=0;c<a.length;c++){if(a[c].optionName=="WD1"||a[c].optionName=="960H"){if(b==8||b==64){return true}}}}return false}function NeedLimitedIPCFrameRate(b,a){return false;if(DVRVIDEO_SIZE_HD720==g_ipc_surportRes.defaResolution){return true}else{if(g_ipc_surportRes.defaChnnRate<20){return true}}return false}function UpdateMainStreamNetChnnelStatus(){if(g_net_ch_num>0){var a=document.getElementsByName("rec_resolution");for(var b=g_local_ch_num;b<g_local_ch_num+g_net_ch_num;b++){if(g_majorNetChannelEncodeProperty[b-g_local_ch_num].online!=1){var c=a[b].parentNode;c.parentNode.style.display="none";c.parentNode.style.border=0}}}}function OnLoadCfgRecStream(){var h=/msie/i.test(navigator.userAgent);var z=document.getElementById("id_record_stream_cfg");var C=document.getElementById("all_rec_resolution");var a=document.getElementById("all_rec_encode_type");var l=document.getElementById("all_rec_maxbit_stream");var e=document.getElementById("all_rec_video_quality");var w=document.getElementById("all_rec_frame_rate");var c=document.getElementById("remain_source");if(g_net_ch_num){c.style.display="none"}else{if(g_majorEncodeProperty.length==1){for(i=0;i<g_majorEncodeProperty[0].length;i++){if(g_majorEncodeProperty[0][i].resolution>8){c.style.display="none";break}}}else{for(i=0;i<g_majorEncodeProperty.length;i++){for(j=0;j<g_majorEncodeProperty[i].length;j++){if(g_majorEncodeProperty[i][j].resolution>8){c.style.display="none";break}}}}}ApplyXmlLang("cfg_record_stream.xml");if(g_net_ch_num>0){GetNetChannelEncodeInfo(0)}CreateListRecord(z,g_local_ch_num+g_net_ch_num);if(g_majorEncodeProperty.length==1){GenSelectListEx(C,g_majorEncodeProperty[0]);GenSelectListEx(a,g_avStreamInfo.supportEncodeMode);GenSelectListEx(l,GetsuitableBiteRate(g_avStreamInfo.defaultResolution,true,true));GenSelectListEx(e,g_avStreamInfo.supportQuarlity);C.value=g_avStreamInfo.defaultResolution[0];a.value=g_avStreamInfo.defaultEncodeMode;l.value=g_avStreamInfo.defaultBitrate;e.value=g_avStreamInfo.defaultQuarlity}else{var q=document.getElementById("id_rec_stream_all");var g=document.getElementById("record_stream_all_label");q.style.display="none";g.style.display="none"}var o=parseInt(const_hardware_ver.split(".")[0],10);if(o==TD_2308SS_SDI||o==TD_2304SS_SDI||o==TD_2508HE_SDI){var q=document.getElementById("id_rec_stream_all");var g=document.getElementById("record_stream_all_label");q.style.display="none";g.style.display="none"}GetIPCRes();if(g_supportFunctions.IsUseStaticVideoBitRate()){var s=CreateBitrateReqXml();var n=WebClient.ExcuteCmd(s);if(n==""){g_bBitRatedef=false}else{if(g_BitRatexmlDoc!=null){delete g_BitRatexmlDoc;g_BitRatexmlDoc=null}g_BitRatexmlDoc=FormatToXmlDOM(n);g_BitRatexmlDoc.async=false;g_bBitRatedef=true;var r=g_BitRatexmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");for(i=0;i<r.length;i++){var b=r[i].firstChild.nodeValue.split("+");var x=b[0];if(g_ipc_surportRes.defaResolution==x){g_ipc_surportRes.defaBitRate=b[1];break}}}}var t=CreateConfigReqXml(rec_stream_config_array);var v=WebClient.ExcuteCmd(t);if(v==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(v);g_xmlDoc.async=false;var A=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdateValues(A,true);UpdateRecStreamCfg(true);var d=document.getElementsByName("rec_resolution");var B=document.getElementsByName("rec_frame_rate");for(var u=0;u<g_local_ch_num+g_net_ch_num;u++){OnRecChangeResolution(d[u],u,true)}if(g_majorEncodeProperty.length==1){OnAllRecChangeResolution(C,true);var y=(g_videoFormat=="PAL")?g_avStreamInfo.defaultChnnRateNumPal:g_avStreamInfo.defaultChnnRateNumNtsc;w.value=y}UpdateRecStreamCfg(true);OnRecStreamCheckAll();var k=(g_videoFormat=="PAL")?g_avStreamInfo.totalRatePalOnCif[0]:g_avStreamInfo.totalRateNtscOnCif[0];var f=0;var o=parseInt(const_hardware_ver.split(".")[0],10);for(var p=0;p<B.length;p++){if(p>=g_local_ch_num){continue}if(NeedLimitedResoltion(o,g_majorEncodeProperty[0])){if(o==TD_2316SS_C||o==TD_2316ME_C){f+=ConvertCifRateFor2316SS_C(parseInt(B[p].value,10),parseInt(d[p].value,10))}else{f+=ConvertCifRateEx(parseInt(B[p].value,10),parseInt(d[p].value,10))}}else{f+=ConvertCifRate(parseInt(B[p].value,10),parseInt(d[p].value,10))}}ShowResource(k,f);var o=parseInt(const_hardware_ver.split(".")[0],10);var d=document.getElementsByName("rec_resolution");if(TD_2704TS_PL==o||TD_2708TS_PL==o||TD_2716TS_PL==o||TD_2704AS_S==o||TD_2708AS_S==o||TD_2704TD_PL==o||TD_2708TD_PL==o||TD_2716TD_PL==o||TD_2732TD_PL==o||TD_2704TD_P==o||TD_2708TD_P==o||TD_2716TD_P==o||TD_2704AS_SL==o||TD_2708AS_SL==o||TD_2716AS_SL==o||TD_2704TE_M==o||TD_2708TE_M==o||TD_2716TE_M==o||TD_2704AE_SL==o||TD_2708AE_SL==o||TD_2008AS==o||TD_2704AS_SL_A==o||TD_2708AS_SL_A==o||TD_2716AS_SL_A==o||TD_2716AE_SL==o||TD_2004AL==o||TD_2704AS_PL==o||TD_2708AS_PL==o||TD_2716AS_PL==o||TD_2704AC_PL==o||TD_2708AC_PL==o||TD_2716AC_PL==o||TD_2704AE_PL==o||TD_2708AE_PL==o||TD_2716AE_PL==o||TD_2704AS_S_A==o||TD_2708AS_S_A==o||TD_2716AS_S_A==o){C.disabled=true;for(var u=0;u<Math.min(d.length,g_local_ch_num);u++){d[u].disabled=true}document.getElementById("default_btn").disabled=true;document.getElementById("default_btn1").disabled=true;document.getElementById("id_rec_stream_all").style.display="none";document.getElementById("rec_stream_all_cfg").style.display="none";document.getElementById("all_rec_resolution").style.display="none";document.getElementById("all_rec_frame_rate").style.display="none";document.getElementById("all_rec_encode_type").style.display="none";document.getElementById("all_rec_video_quality").style.display="none";document.getElementById("all_rec_maxbit_stream").style.display="none";document.getElementById("record_stream_all_label").style.display="none"}if(g_net_ch_num>0){document.getElementById("id_rec_stream_all").style.display="none";document.getElementById("rec_stream_all_cfg").style.display="none";document.getElementById("all_rec_resolution").style.display="none";document.getElementById("all_rec_frame_rate").style.display="none";document.getElementById("all_rec_encode_type").style.display="none";document.getElementById("all_rec_video_quality").style.display="none";document.getElementById("all_rec_maxbit_stream").style.display="none";document.getElementById("record_stream_all_label").style.display="none";document.getElementById("default_btn").style.display="none";document.getElementById("default_btn1").style.display="none"}UpdateMainStreamNetChnnelStatus();Align()}function CreateRequestFirstCheckEncInfo(c){var a=document.getElementsByName("rec_resolution");var h=document.getElementsByName("rec_frame_rate");var d=document.getElementsByName("rec_maxbit_stream");var k=document.getElementById("all_rec_resolution");var g=document.getElementById("all_rec_frame_rate");var f=document.getElementById("all_rec_maxbit_stream");var e="<request>\r\n";e+='<command name="'+STR_REQUEST_FIRST_CHECK_ENC_INFO+'" channel="'+c+'">\r\n';if(c==255){for(var b=0;b<a.length;b++){e+="<parameter>"+parseInt(k.value,10)+"+"+parseInt(g.value,10)+"+"+parseInt(f.value,10)+"</parameter>\r\n"}}else{for(var b=0;b<a.length;b++){e+="<parameter>"+a[b].value+"+"+h[b].value+"+"+d[b].value+"</parameter>\r\n"}}e+="</command>\r\n";e+="</request>\r\n";return e}function CreateRequestFirstSupportInfo(e){var a=document.getElementsByName("rec_resolution");var b=document.getElementsByName("rec_frame_rate");var c=document.getElementsByName("rec_maxbit_stream");var d="<request>\r\n";d+='<command name="'+STR_REQUEST_FIRST_SUPPORT_INFO+'" channel="'+e+'">\r\n';d+="</command>\r\n";d+="</request>\r\n";return d}function CheckConfigParams(e){var a=document.getElementsByName("rec_resolution");var m=document.getElementsByName("rec_frame_rate");var f=document.getElementsByName("rec_maxbit_stream");var n=document.getElementById("all_rec_resolution");var l=document.getElementById("all_rec_frame_rate");var h=document.getElementById("all_rec_maxbit_stream");var b=CreateRequestFirstCheckEncInfo(e);var g=WebClient.ExcuteCmd(b);if(g==""){return}if(g_xmlCheckConfigDoc!=null){delete g_xmlCheckConfigDoc;g_xmlCheckConfigDoc=null}g_xmlCheckConfigDoc=FormatToXmlDOM(g);g_xmlCheckConfigDoc.async=false;var d=g_xmlCheckConfigDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");if(e==255){var k=d[0].childNodes[0].nodeValue.split("+");if(l.value>parseInt(k[1],10)){window.alert(str_total_frame_rate_exceed)}n.value=k[0];l.value=k[1];h.value=k[2]}else{for(var c=0;c<d.length;c++){var k=d[c].childNodes[0].nodeValue.split("+");if(c==e&&(m[c].value>parseInt(k[1],10))){window.alert(str_total_frame_rate_exceed)}a[c].value=k[0];m[c].value=k[1];f[c].value=k[2]}}}function LoadDefaultCfgRecStream(){if(GetDefaultCfg(rec_stream_config_array)){var k=/msie/i.test(navigator.userAgent);var h=document.getElementById("remain_source");var g=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdateValues(g,true);UpdateRecStreamCfg(true);var c=document.getElementsByName("rec_resolution");var l=document.getElementsByName("rec_frame_rate");var d=parseInt(const_hardware_ver.split(".")[0],10);for(var e=0;e<g_local_ch_num;e++){OnRecChangeResolution(c[e],e,true)}UpdateRecStreamCfg(true);OnRecStreamCheckAll();g_bChange=true;var f=(g_videoFormat=="PAL")?g_avStreamInfo.totalRatePalOnCif[0]:g_avStreamInfo.totalRateNtscOnCif[0];var b=0;for(var a=0;a<l.length;a++){if(a>=g_local_ch_num){continue}if(NeedLimitedResoltion(d,g_majorEncodeProperty[0])){if(d==TD_2316SS_C||d==TD_2316ME_C){b+=ConvertCifRateFor2316SS_C(parseInt(l[a].value,10),parseInt(c[a].value,10))}else{b+=ConvertCifRateEx(parseInt(l[a].value,10),parseInt(c[a].value,10))}}else{b+=ConvertCifRate(parseInt(l[a].value,10),parseInt(c[a].value,10))}}ShowResource(f,b);UpdateMainStreamNetChnnelStatus();Align()}}function OnLoadCfgRecSnap(){var e=document.getElementById("jpeg_period");var b=document.getElementById("snap_rec_num");var f=document.getElementById("snap_rec_quality");var c=document.getElementById("snap_rec_resolution");ApplyXmlLang("cfg_rec_snap.xml");GenSelectListEx(e,g_recSnapArray);GenSelectListEx(b,g_recSnapNumArray);GenSelectListEx(f,g_recSnapLevelNum);GenSelectListEx(c,g_recSnapSizeRange);var d=CreateConfigReqXml(rec_snap_array);var a=WebClient.ExcuteCmd(d);if(a==""){return false}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(a);g_xmlDoc.async=false;UpdateSnap(g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter"),true);Align()}function UpdateSnap(c,d){for(i=0;i<c.length;i++){var e=document.getElementById("jpeg_period");var a=document.getElementById("snap_rec_num");var f=document.getElementById("snap_rec_quality");var b=document.getElementById("snap_rec_resolution");if(d){if(STR_JPEG_PERIOD==c[i].attributes.getNamedItem("name").nodeValue){e.value=c[i].childNodes[0].nodeValue}if(STR_REC_SNAP_NUM==c[i].attributes.getNamedItem("name").nodeValue){a.value=c[i].childNodes[0].nodeValue}if(STR_REC_SNAP_QUALITY==c[i].attributes.getNamedItem("name").nodeValue){f.value=c[i].childNodes[0].nodeValue}if(STR_REC_SNAP_RESOLUTION==c[i].attributes.getNamedItem("name").nodeValue){b.value=c[i].childNodes[0].nodeValue}}else{if(STR_JPEG_PERIOD==c[i].attributes.getNamedItem("name").nodeValue){c[i].childNodes[0].nodeValue=e.value}if(STR_REC_SNAP_NUM==c[i].attributes.getNamedItem("name").nodeValue){c[i].childNodes[0].nodeValue=a.value}if(STR_REC_SNAP_QUALITY==c[i].attributes.getNamedItem("name").nodeValue){c[i].childNodes[0].nodeValue=f.value}if(STR_REC_SNAP_RESOLUTION==c[i].attributes.getNamedItem("name").nodeValue){c[i].childNodes[0].nodeValue=b.value}}}}function LoadDefaultCfgSnap(){if(GetDefaultCfg(rec_snap_array)){UpdateSnap(g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter"),true);g_bChange=true;Align()}}function OnRecBasicCheckAll(){var f=document.getElementById("rec_all_cfg");var d=document.getElementById("id_record_channel_cfg");var h=document.getElementById("id_rec_all");var k=document.getElementById("all_rec_redundant");var g=document.getElementById("all_rec_hold_time");cfgCopy2All(f,d,h);var b=parseInt(const_software_ver.split("-")[2])==4;if(b){g.disabled=true;var c=document.getElementsByName("rec_hold_time");for(var e=0;e<c.length;e++){c[e].disabled=true}}if(!g_supportRecRedundancy){k.disabled=true;var a=document.getElementsByName("rec_redundant")[0];for(var e=0;e<a.length;e++){a[e].disabled=true}}}function OnRecStreamCheckAll(){var c=document.getElementById("rec_stream_all_cfg");var d=document.getElementById("id_record_stream_cfg");var g=document.getElementById("id_rec_stream_all");var k=document.getElementById("all_rec_encode_type");var a=document.getElementById("all_rec_video_quality");cfgCopy2All(c,d,g);var b=document.getElementsByName("rec_resolution");var l=document.getElementsByName("rec_encode_type");var n=document.getElementsByName("rec_video_quality");if(g_majorEncodeSizeAllCh){for(var h=0;h<b.length;h++){b[h].disabled=true}}if(c.checked){OnRecChangeEncodeType(k,a)}else{for(var f=0;f<g_local_ch_num+g_net_ch_num;f++){OnRecChangeEncodeType(l[f],n[f])}}var e=parseInt(const_hardware_ver.split(".")[0],10);var b=document.getElementsByName("rec_resolution");if(TD_2704TS_PL==e||TD_2708TS_PL==e||TD_2716TS_PL==e||TD_2704AS_S==e||TD_2708AS_S==e||TD_2704TD_PL==e||TD_2708TD_PL==e||TD_2716TD_PL==e||TD_2732TD_PL==e||TD_2704TD_P==e||TD_2708TD_P==e||TD_2716TD_P==e||TD_2704AS_SL==e||TD_2708AS_SL==e||TD_2716AS_SL==e||TD_2704TE_M==e||TD_2708TE_M==e||TD_2716TE_M==e||TD_2704AE_SL==e||TD_2708AE_SL==e||TD_2008AS==e||TD_2704AS_SL_A==e||TD_2708AS_SL_A==e||TD_2716AS_SL_A==e||TD_2716AE_SL==e||TD_2004AL==e||TD_2704AS_PL==e||TD_2708AS_PL==e||TD_2716AS_PL==e||TD_2704AC_PL==e||TD_2708AC_PL==e||TD_2716AC_PL==e||TD_2704AE_PL==e||TD_2708AE_PL==e||TD_2716AE_PL==e||TD_2704AS_S_A==e||TD_2708AS_S_A==e||TD_2716AS_S_A==e){all_rec_resolution.disabled=true;for(var f=0;f<Math.min(b.length,g_local_ch_num);f++){b[f].disabled=true}document.getElementById("default_btn").disabled=true;document.getElementById("default_btn1").disabled=true}UpdateMainStreamNetChnnelStatus()}function OnRecChangeResolution(x,m,o){if(m<g_local_ch_num&&!o&&g_supportFunctions.IsSupportServerEncodeCheck()){CheckConfigParams(m);return}var w=document.getElementsByName("rec_frame_rate");var g=document.getElementsByName("rec_maxbit_stream");var e=document.getElementsByName("rec_resolution");var p=0;if((g_net_ch_num>0)&&((m-g_local_ch_num)>=0)){var y=g_majorNetChannelEncodeProperty[m-g_local_ch_num].encInfo;if(!y){return}for(var r=0;r<y.length;r++){var q=y[r].maxBitRate;if((y[r].channel==m)&&(y[r].videoSize==e[m].value)){var c=[];p=y[r].Rate;for(var t=0;t<g_avStreamInfo.supportBitrate.length;t++){if(g_avStreamInfo.supportBitrate[t].optionValue>q){break}c.push(new CSelectOptionInfo(g_avStreamInfo.supportBitrate[t].optionName,g_avStreamInfo.supportBitrate[t].optionValue))}GenSelectListEx(g[m],c);g[m].value=GetDefaultBiteRate(y[x.selectedIndex].videoSize,true);break}}}var d=w[m].options.length;var a=parseInt(w[m].value,10);var h=m;if(g_majorEncodeProperty.length==1){h=0}var b=0;for(var u=0;u<g_majorEncodeProperty[h].length;u++){if(g_majorEncodeProperty[h][u].resolution==e[m].value){b=u;break}}if(g_majorSpe.bVideoSizeSpecial&&(g_majorSpe.videoSizeD1ChnnBits.charAt(m)=="1")){if((g_net_ch_num>0)&&((m+1)>g_local_ch_num)){if((DVRVIDEO_SIZE_HD1080==e[m].value||DVRVIDEO_SIZE_SXGA==e[m].value||DVRVIDEO_SIZE_3M==e[m].value)&&!g_ipc_surportRes.limitByBitRate&&(p>g_ipc_surportRes.maxChnnRate/2)){var z=new Array(0);var z=g_majorEncodeProperty[h][0].frameRate.slice(0);var f=g_majorEncodeProperty[h][0].frameRate.length;z.splice(parseInt(f/2),f-parseInt(f/2));GenSelectListEx(w[m],z);var v=z.length}else{GenSelectListEx(w[m],g_majorEncodeProperty[h][0].frameRate);var v=g_majorEncodeProperty[h][0].frameRate.length}}else{GenSelectListEx(w[m],g_majorEncodeProperty[h][0].frameRate);var v=g_majorEncodeProperty[h][0].frameRate.length}}else{if((g_net_ch_num>0)&&((m+1)>g_local_ch_num)){if((DVRVIDEO_SIZE_HD1080==e[m].value||DVRVIDEO_SIZE_SXGA==e[m].value||DVRVIDEO_SIZE_3M==e[m].value)&&
/*!g_ipc_surportRes.limitByBitRate*/
(g_ipc_surportRes.limitByBitRate==0)&&(p>g_ipc_surportRes.maxChnnRate/2)){var z=g_majorEncodeProperty[h][b].frameRate.slice(0);var f=g_majorEncodeProperty[h][b].frameRate.length;z.splice(parseInt(f/2),f-parseInt(f/2));GenSelectListEx(w[m],z);var v=z.length}else{GenSelectListEx(w[m],g_majorEncodeProperty[h][b].frameRate);var v=g_majorEncodeProperty[h][b].frameRate.length}}else{GenSelectListEx(w[m],g_majorEncodeProperty[h][b].frameRate);var v=g_majorEncodeProperty[h][b].frameRate.length}}w[m].value=Math.round(a*v/d);var n=parseInt(const_hardware_ver.split(".")[0],10);if(n==TD_2308SS_SDI||n==TD_2304SS_SDI||n==TD_2508HE_SDI){if(g_majorEncodeProperty[h][b].resolution==64){var s=new Array(new CSelectOptionInfo("768kbps",768),new CSelectOptionInfo("1024kbps",1024),new CSelectOptionInfo("1536kbps",1536),new CSelectOptionInfo("2048kbps",2048),new CSelectOptionInfo("2560kbps",2560))}else{if(g_majorEncodeProperty[h][b].resolution==32){var s=new Array(new CSelectOptionInfo("1024kbps",1024),new CSelectOptionInfo("1536kbps",1536),new CSelectOptionInfo("2048kbps",2048),new CSelectOptionInfo("2560kbps",2560),new CSelectOptionInfo("3072kbps",3072),new CSelectOptionInfo("4096kbps",4096),new CSelectOptionInfo("5120kbps",5120),new CSelectOptionInfo("6144kpbs",6144))}else{if(g_majorEncodeProperty[h][b].resolution==8){var s=new Array(new CSelectOptionInfo("768kbps",768),new CSelectOptionInfo("1024kbps",1024),new CSelectOptionInfo("1536kbps",1536),new CSelectOptionInfo("2048kbps",2048))}else{if(g_majorEncodeProperty[h][b].resolution==2||g_majorEncodeProperty[h][b].resolution==4){var s=new Array(new CSelectOptionInfo("768kbps",768),new CSelectOptionInfo("1024kbps",1024),new CSelectOptionInfo("1536kbps",1536))}else{var s=new Array(new CSelectOptionInfo("768kbps",768),new CSelectOptionInfo("1024kbps",1024),new CSelectOptionInfo("1536kbps",1536),new CSelectOptionInfo("2048kbps",2048),new CSelectOptionInfo("2560kbps",2560),new CSelectOptionInfo("3072kbps",3072),new CSelectOptionInfo("4096kbps",4096),new CSelectOptionInfo("5120kbps",5120),new CSelectOptionInfo("6144kpbs",6144))}}}}GenSelectListEx(g[m],s)}if(NeedLimitedResoltion(n,g_majorEncodeProperty[0])&&((n==TD_2316SS_C)||(n==TD_2316ME_C))){if(a>g_majorEncodeProperty[h][b].frameRate.length){a=g_majorEncodeProperty[h][b].frameRate.length}w[m].value=a}TryFrameRate(m,o);if(CheckIsNetChannel(m)){return}if(n==TD_2704HD){return}if(g_majorEncodeProperty[h][b].resolution==64){g[m].value=2048}if(g_majorEncodeProperty[h][b].resolution==32){g[m].value=4096}if(g_majorEncodeProperty[h][b].resolution==16){if(n==TD_2708XE_MH){g[m].value=8192}else{g[m].value=10240}}if(g_majorEncodeProperty[h][b].resolution==8){g[m].value=1536}if(g_majorEncodeProperty[h][b].resolution==4){g[m].value=1024}if(g_majorEncodeProperty[h][b].resolution==2){g[m].value=768}}function OnAllRecChangeResolution(c,e){if(!e&&g_supportFunctions.IsSupportServerEncodeCheck()){CheckConfigParams(255);return}var g=document.getElementById("all_rec_frame_rate");var f=document.getElementById("all_rec_maxbit_stream");var d=document.getElementById("resolutionObj");var a=g.options.length;GenSelectListEx(g,g_majorEncodeProperty[0][c.selectedIndex].frameRate);var h=parseInt(g.value,10);var k=g_majorEncodeProperty[0][c.selectedIndex].frameRate.length;if(g.length<=h){g.value=g.length}else{g.value=h}TryAllFrame(e);var b=parseInt(const_hardware_ver.split(".")[0],10);if(b==TD_2704HD){return}if(g_majorEncodeProperty[0][c.selectedIndex].resolution==64){f.value=2048}if(g_majorEncodeProperty[0][c.selectedIndex].resolution==32){f.value=4096}if(g_majorEncodeProperty[0][c.selectedIndex].resolution==16){if(b==TD_2708XE_MH||b==TD_2708TS_PL){f.value=8192}else{f.value=10240}}if(g_majorEncodeProperty[0][c.selectedIndex].resolution==8){f.value=1536}if(g_majorEncodeProperty[0][c.selectedIndex].resolution==4){f.value=1024}if(g_majorEncodeProperty[0][c.selectedIndex].resolution==4){f.value=1024}if(g_majorEncodeProperty[0][c.selectedIndex].resolution==2){f.value=768}}function OnAllRecMaxBitStream(b,a){if(!a&&g_supportFunctions.IsSupportServerEncodeCheck()){CheckConfigParams(255);return}}function OnRecChangeEncodeType_2(b,a,c){var d=document.getElementsByName(c);if(b.value==1){d[a].disabled=false}else{if(b.value==2){d[a].disabled=true}}}function OnRecChangeEncodeType(a,b){if(a.value==1){b.disabled=false}else{if(a.value==2){b.disabled=true}}}function TryFrameRate(b,a){if(b>=g_local_ch_num){TryIPCFrameRate(b,a)}else{if(!a&&g_supportFunctions.IsSupportServerEncodeCheck()){CheckConfigParams(b);return}TryLocalFrameRate(b,a)}}function TryLocalFrameRate(e,l){if(e>=g_local_ch_num){return}var k=/msie/i.test(navigator.userAgent);var g=document.getElementById("remain_source");var h=e;if(g_majorEncodeProperty.length==1){h=0}var f=(g_videoFormat=="PAL")?g_avStreamInfo.totalRatePalOnCif[h]:g_avStreamInfo.totalRateNtscOnCif[h];var c=0;var m=document.getElementsByName("rec_frame_rate");var b=document.getElementsByName("rec_resolution");var d=parseInt(const_hardware_ver.split(".")[0],10);if(g_majorSpe.bVideoSizeSpecial&&(g_majorSpe.videoSizeD1ChnnBits.charAt(e)=="1")){}else{if(NeedLimitedFrameRate(d,parseInt(b[e].value,10),g_majorEncodeProperty[0])){if(d==TD_2708TS_PL||TD_2704TS_PL==d||TD_2716TS_PL==d){if(g_videoFormat=="PAL"){if(parseInt(b[e].value,10)==16){if(parseInt(m[e].value,10)>12){if(!l){window.alert(str_total_frame_rate_exceed)}m[e].value=12}}else{if(parseInt(b[e].value,10)==32){if(parseInt(m[e].value,10)>25){if(!l){window.alert(str_total_frame_rate_exceed)}m[e].value=25}}}}else{if(parseInt(b[e].value,10)==16){if(parseInt(m[e].value,10)>15){if(!l){window.alert(str_total_frame_rate_exceed)}m[e].value=15}}else{if(parseInt(b[e].value,10)==32){if(parseInt(m[e].value,10)>30){if(!l){window.alert(str_total_frame_rate_exceed)}m[e].value=30}}}}}else{if(parseInt(m[e].value,10)>Math.floor(f/m.length/MultiCifEx(all_rec_resolution.value))){window.alert(str_total_frame_rate_exceed);m[e].value=Math.floor(f/m.length/MultiCifEx(all_rec_resolution.value))}}}for(var a=0;a<m.length;a++){if(a>=g_local_ch_num){continue}if(NeedLimitedResoltion(d,g_majorEncodeProperty[0])){if(d==TD_2316SS_C||d==TD_2316ME_C){c+=ConvertCifRateFor2316SS_C(parseInt(m[a].value,10),parseInt(b[a].value,10))}else{c+=ConvertCifRateEx(parseInt(m[a].value,10),parseInt(b[a].value,10))}}else{c+=ConvertCifRate(parseInt(m[a].value,10),parseInt(b[a].value,10))}}if(c>f){window.alert(str_total_frame_rate_exceed);while(c>f){m[e].value=parseInt(m[e].value,10)-1;if(NeedLimitedResoltion(d,g_majorEncodeProperty[0])){if(d==TD_2316SS_C||d==TD_2316ME_C){c-=MultiCifFor2316SS_C(b[e].value)}else{c-=MultiCifEx(b[e].value)}}else{c-=MultiCif(b[e].value)}}}}c=0;for(var a=0;a<m.length;a++){if(a>=g_local_ch_num){continue}if(NeedLimitedResoltion(d,g_majorEncodeProperty[0])){if(d==TD_2316SS_C||d==TD_2316ME_C){c+=ConvertCifRateFor2316SS_C(parseInt(m[a].value,10),parseInt(b[a].value,10))}else{c+=ConvertCifRateEx(parseInt(m[a].value,10),parseInt(b[a].value,10))}}else{c+=ConvertCifRate(parseInt(m[a].value,10),parseInt(b[a].value,10))}}ShowResource(f,c)}function TryAllFrame(f){if(!f&&g_supportFunctions.IsSupportServerEncodeCheck()){CheckConfigParams(255);return}if(g_net_ch_num!=0){return}var e=/msie/i.test(navigator.userAgent);var g=document.getElementById("all_rec_frame_rate");var k=document.getElementById("all_rec_resolution");var h=document.getElementById("rec_frame_rate");var d=document.getElementById("remain_source");var b=parseInt(const_hardware_ver.split(".")[0],10);var h=document.getElementsByName("rec_frame_rate");var c=(g_videoFormat=="PAL")?g_avStreamInfo.totalRatePalOnCif[0]:g_avStreamInfo.totalRateNtscOnCif[0];var a=0;if(NeedLimitedFrameRate(b,parseInt(k.value,10),g_majorEncodeProperty[0])){if(parseInt(g.value,10)>Math.floor(c/h.length/MultiCifEx(k.value))){window.alert(str_total_frame_rate_exceed);g.value=Math.floor(c/h.length/MultiCifEx(k.value))}}if(NeedLimitedResoltion(b,g_majorEncodeProperty[0])){if(b==TD_2316SS_C||b==TD_2316ME_C){a=h.length*ConvertCifRateFor2316SS_C(parseInt(g.value,10),parseInt(k.value,10))}else{a=h.length*ConvertCifRateEx(parseInt(g.value,10),parseInt(k.value,10))}}else{a=h.length*ConvertCifRate(parseInt(g.value,10),parseInt(k.value,10))}if(a>c){window.alert(str_total_frame_rate_exceed);if(NeedLimitedResoltion(b,g_majorEncodeProperty[0])){if(b==TD_2316SS_C||b==TD_2316ME_C){g.value=Math.floor(c/h.length/MultiCifFor2316SS_C(k.value))}else{g.value=Math.floor(c/h.length/MultiCifEx(k.value))}}else{g.value=Math.floor(c/h.length/MultiCif(k.value))}}if(NeedLimitedResoltion(b,g_majorEncodeProperty[0])){if(b==TD_2316SS_C||b==TD_2316ME_C){a=h.length*ConvertCifRateFor2316SS_C(parseInt(g.value,10),parseInt(k.value,10))}else{a=h.length*ConvertCifRateEx(parseInt(g.value,10),parseInt(k.value,10))}}else{a=h.length*ConvertCifRate(parseInt(g.value,10),parseInt(k.value,10))}ShowResource(c,a)}function UpdateRecStreamCfg(d){var r=document.getElementById("all_rec_resolution");var o=document.getElementById("all_rec_frame_rate");var k=document.getElementById("all_rec_encode_type");var a=document.getElementById("all_rec_video_quality");var m=document.getElementById("all_rec_maxbit_stream");var c=document.getElementById("rec_stream_all_cfg");var b=document.getElementsByName("rec_resolution");var q=document.getElementsByName("rec_frame_rate");var h=document.getElementsByName("rec_maxbit_stream");var l=document.getElementsByName("rec_encode_type");var p=document.getElementsByName("rec_video_quality");var g=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");if(!(g_local_ch_num+g_net_ch_num)){return}for(var f=0;f<g.length;f++){if(g[f].getAttribute("name")==STR_ENCODE_MAJOR_EX){if(d){for(var e=0;e<g_local_ch_num+g_net_ch_num;e++){var n=g[f].childNodes[0].nodeValue.split("+");b[e].value=n[0];if(q[e].options.length>0){q[e].value=Math.min(parseInt(n[1]),parseInt((q[e][q[e].options.length-1].value),10))}l[e].value=n[2];p[e].value=n[3];h[e].value=n[5];f++}f--}else{var n=g[f].childNodes[0].nodeValue.split("+");for(var e=0;e<g_local_ch_num+g_net_ch_num;e++){if(c.checked){n[0]=r.value;n[1]=o.value;n[2]=k.value;n[3]=a.value;n[5]=m.value}else{if((e>=g_local_ch_num)&&(g_majorNetChannelEncodeProperty[e-g_local_ch_num].online!=1)){f++;continue}n[0]=b[e].value;n[1]=q[e].value;n[2]=l[e].value;n[3]=p[e].value;n[5]=h[e].value}g[f].childNodes[0].nodeValue=n.join("+");f++}f--}}}}function CreateListRecBasic(g,a,b,k){var d=/msie/i.test(navigator.userAgent);var h=g.outerHTML.toLowerCase();var c=h.indexOf("</tbody>");h=h.substr(0,c);h+="<tr class = 'table_head_bgcolor'>";for(var e=0;e<a;e++){h+='<td style = "text-align:center">'+b[e]+"</td>"}h+="</tr>";for(var e=1;e<k+1;e++){if(d){h+="<tr>";h+='<td style = "width:8%;text-align:center">'+e+"</td>";h+='<td style = "width:9%;"><input type = "checkbox" name = "rec_enable" style = "width:100%;" onchange = "g_bChange = true;" /></td>';h+='<td style = "width:9%;"><input type = "checkbox" name = "rec_has_audio" style = "width:100%;" onchange = "g_bChange = true;"/></td>';h+='<td style = "width:9%;"><input type = "checkbox" name = "rec_redundant" style = "width:100%;" onchange = "g_bChange = true;" /></td>';h+='<td style = "width:21%;"><select name = "pre_alarm_rec_time" style = "width:100%;" onchange = "g_bChange = true;"></select></td>';h+='<td style = "width:21%;"><select name = "post_alarm_rec_time" style = "width:100%;" onchange = "g_bChange = true;"></select></td>';h+='<td style = "width:21%;"><select name = "rec_hold_time" style = "width:100%;" onchange = "g_bChange = true;"></select></td>';h+="</tr>"}else{h+="<tr>";h+='<td style = "width:8%;text-align:center">'+e+"</td>";h+='<td style = "width:9%;;text-align:center"><input type = "checkbox" name = "rec_enable" style = "width:30px;" onchange = "g_bChange = true;" /></td>';h+='<td style = "width:9%;;text-align:center"><input type = "checkbox" name = "rec_has_audio" style = "width:30px;" onchange = "g_bChange = true;"/></td>';h+='<td style = "width:9%;;text-align:center"><input type = "checkbox" name = "rec_redundant" style = "width:30px;" onchange = "g_bChange = true;" /></td>';h+='<td style = "width:21%;"><select name = "pre_alarm_rec_time" style = "width:100%;" onchange = "g_bChange = true;"></select></td>';h+='<td style = "width:21%;"><select name = "post_alarm_rec_time" style = "width:100%;" onchange = "g_bChange = true;"></select></td>';h+='<td style = "width:21%;"><select name = "rec_hold_time" style = "width:100%;" onchange = "g_bChange = true;"></select></td>';h+="</tr>"}}h+="</tbody></table>";if(d){var f=g.parentElement}else{var f=g.parentNode}f.innerHTML=h;for(var e=1;e<k+1;e++){GenSelectListEx(document.getElementsByName("pre_alarm_rec_time")[e-1],g_preAlarmRecTime);GenSelectListEx(document.getElementsByName("post_alarm_rec_time")[e-1],g_postAlarmRecTime);GenSelectListEx(document.getElementsByName("rec_hold_time")[e-1],g_recDataHoldTime)}g=f.childNodes[0];for(j=g_audioList.length;j<g_local_ch_num;j++){document.getElementsByName("rec_has_audio")[j].style.display="none"}}function CreateListRecord(c,m){var q=/msie/i.test(navigator.userAgent);var n=c.outerHTML.toLowerCase();var u=n.indexOf("</tbody>");n=n.substr(0,u);var h=6;var w=Math.round(633/(h-1));if(!g_supportMajorEncTypeAndBitrate){w=Math.round(633/(h-3))}n+="<tr class = 'table_head_bgcolor'>";for(var t=0;t<h;t++){if(!g_supportMajorEncTypeAndBitrate&&((3==t)||(5==t))){n+='<td style = "width:'+w+'px;text-align:center;display:none;">'+cfg_record_stream_header[t]+"</td>"}else{n+='<td style = "width:'+w+'px;text-align:center">'+cfg_record_stream_header[t]+"</td>"}}n+="</tr>";for(var t=1;t<m+1;t++){n+="<tr>";n+='<td style = "width:50px;text-align:center">'+t+"</td>";n+='<td><select name = "rec_resolution" style = "width:'+w+'px;" onchange = "g_bChange = true; OnRecChangeResolution(this, '+(t-1)+', false)"></select></td>';n+='<td><select name = "rec_frame_rate" style = "width:'+w+'px;" onchange = "g_bChange = true; TryFrameRate('+(t-1)+', false)"></select></td>';if(!g_supportMajorEncTypeAndBitrate){n+='<td style="display:none;"><select name = "rec_encode_type"></select></td>'}else{n+='<td><select name = "rec_encode_type" style = "width:'+w+'px;" onchange = "g_bChange = true; OnRecChangeEncodeType_2(this,'+(t-1)+",'rec_video_quality')\"></select></td>"}n+='<td><select name = "rec_video_quality" style = "width:'+w+'px;" onchange = "g_bChange = true;"></select></td>';if(!g_supportMajorEncTypeAndBitrate){n+='<td style="display:none;"><select name = "rec_maxbit_stream"></select></td>'}else{n+='<td><select name = "rec_maxbit_stream" style = "width:'+w+'px;" onchange = "g_bChange = true; OnRecChangeBitRate('+(t-1)+', false)"></select></td>'}n+="</tr>"}n+="</tbody></table>";if(q){var k=c.parentElement}else{var k=c.parentNode}k.innerHTML=n;var o=parseInt(const_hardware_ver.split(".")[0],10);var e=new Array(new CSelectOptionInfo(str_cbr,2));for(var t=0;t<m;t++){if(o==TD_2704HD){if(t<4){var v=new Array(new CSelectOptionInfo("1080P",16),new CSelectOptionInfo("720P",32))}else{var v=new Array(new CSelectOptionInfo("D1",8))}GenSelectListEx(document.getElementsByName("rec_resolution")[t],v);if(t>=0&&t<g_local_ch_num){GenSelectListEx(document.getElementsByName("rec_encode_type")[t],g_avStreamInfo.supportEncodeMode)}else{if(t>=g_local_ch_num&&t<g_local_ch_num+g_net_ch_num){GenSelectListEx(document.getElementsByName("rec_encode_type")[t],e)}}GenSelectListEx(document.getElementsByName("rec_video_quality")[t],g_avStreamInfo.supportQuarlity);GenSelectListEx(document.getElementsByName("rec_maxbit_stream")[t],g_avStreamInfo.supportBitrate)}else{if(o==TD_2308SS_SDI||o==TD_2304SS_SDI||o==TD_2508HE_SDI){var f=t;if(g_majorEncodeProperty.length==1){f=0}if((t<2&&o==TD_2308SS_SDI)||(t<1&&o==TD_2304SS_SDI)||(t<2&&o==TD_2508HE_SDI)){var v=g_majorEncodeProperty[f]}else{var v=new Array(0);for(var s=0;s<g_majorEncodeProperty[f].length;s++){if(g_majorEncodeProperty[f][s].optionName!="720P"){v.push(g_majorEncodeProperty[f][s])}}}GenSelectListEx(document.getElementsByName("rec_resolution")[t],v);if(t>=0&&t<g_local_ch_num){GenSelectListEx(document.getElementsByName("rec_encode_type")[t],g_avStreamInfo.supportEncodeMode)}else{if(t>=g_local_ch_num&&t<g_local_ch_num+g_net_ch_num){GenSelectListEx(document.getElementsByName("rec_encode_type")[t],e)}}GenSelectListEx(document.getElementsByName("rec_video_quality")[t],g_avStreamInfo.supportQuarlity);GenSelectListEx(document.getElementsByName("rec_maxbit_stream")[t],g_avStreamInfo.supportBitrate)}else{var f=t;if(g_majorEncodeProperty.length==1){f=0}if(t>=0&&t<g_local_ch_num){GenSelectListEx(document.getElementsByName("rec_resolution")[t],g_majorEncodeProperty[f]);GenSelectListEx(document.getElementsByName("rec_encode_type")[t],g_avStreamInfo.supportEncodeMode);GenSelectListEx(document.getElementsByName("rec_video_quality")[t],g_avStreamInfo.supportQuarlity);GenSelectListEx(document.getElementsByName("rec_maxbit_stream")[t],GetsuitableBiteRate(g_avStreamInfo.defaultResolution,true,false))}else{if(t>=g_local_ch_num&&t<g_local_ch_num+g_net_ch_num){var v=new Array(0);var b=new Array(0);if(g_majorNetChannelEncodeProperty[t-g_local_ch_num].online==1){var p=g_majorNetChannelEncodeProperty[t-g_local_ch_num].encInfo;for(var s=0;s<p.length;s++){var g=GetSelcetionsString(g_majorNetChannelEncodeProperty[t-g_local_ch_num].encInfo[s].videoSize);v.push(new CSelectOptionInfo(g,g_majorNetChannelEncodeProperty[t-g_local_ch_num].encInfo[s].videoSize))}}else{v.push(new CSelectOptionInfo("",0))}GenSelectListEx(document.getElementsByName("rec_resolution")[t],v);GenSelectListEx(document.getElementsByName("rec_encode_type")[t],e);GenSelectListEx(document.getElementsByName("rec_video_quality")[t],g_avStreamInfo.supportQuarlity);GenSelectListEx(document.getElementsByName("rec_maxbit_stream")[t],g_avStreamInfo.supportBitrate)}}}}}c=k.childNodes[0];var x=document.getElementById("all_rec_resolution");var r=document.getElementById("all_rec_frame_rate");var a=document.getElementById("all_rec_encode_type");var d=document.getElementById("all_rec_video_quality");var l=document.getElementById("all_rec_maxbit_stream");x.style.width=w+"px";r.style.width=w+"px";a.style.width=w+"px";d.style.width=w+"px";l.style.width=w+"px";if(o==TD_2704HD){document.getElementById("record_stream_all_label").parentNode.style.display="none";document.getElementById("id_rec_stream_all").parentNode.style.display="none"}if(!g_supportMajorEncTypeAndBitrate){a.parentNode.style.display="none";l.parentNode.style.display="none"}}function UpdateRecType(e){var l=STR_ENCODE_MAJOR;var h=/msie/i.test(navigator.userAgent);var g=document.getElementById("remain_source");UpdateRecStreamCfg(false,l);rec_type=document.getElementsByName("rec_type");var c=parseInt(const_hardware_ver.split(".")[0],10);for(var k=0;k<rec_type.length;k++){if(rec_type[k].checked){g_curRecType=rec_type[k].value}}var l=STR_ENCODE_MAJOR;UpdateRecStreamCfg(true,l);for(var d=0;d<g_local_ch_num;d++){OnRecChangeResolution(rec_resolution[d],d,true)}UpdateRecStreamCfg(true,l);OnRecStreamCheckAll();var f=(g_videoFormat=="PAL")?g_avStreamInfo.totalRatePalOnCif[0]:g_avStreamInfo.totalRateNtscOnCif[0];var b=0;for(var a=0;a<rec_frame_rate.length;a++){if(NeedLimitedResoltion(c,g_majorEncodeProperty[0])){if(c==TD_2316SS_C||c==TD_2316ME_C){b+=ConvertCifRateFor2316SS_C(parseInt(rec_frame_rate[a].value,10),parseInt(rec_resolution[a].value,10))}else{b+=ConvertCifRateEx(parseInt(rec_frame_rate[a].value,10),parseInt(rec_resolution[a].value,10))}}else{b+=ConvertCifRate(parseInt(rec_frame_rate[a].value,10),parseInt(rec_resolution[a].value,10))}}ShowResource(f,b)}function GetIPCResoluteMaxBsCnt(b,c){var g;var a;var h;var f=30;var k=4096;var e=b-g_local_ch_num;var d;for(d=0;d<g_majorNetChannelEncodeProperty.length;d++){if(g_majorNetChannelEncodeProperty[d].channel==b&&1==g_majorNetChannelEncodeProperty[d].online){a=g_majorNetChannelEncodeProperty[d].encInfo.length;for(g=0;g<a;g++){h=g_majorNetChannelEncodeProperty[d].encInfo[g].videoSize;if(h==c){f=g_majorNetChannelEncodeProperty[d].encInfo[g].Rate;k=g_majorNetChannelEncodeProperty[d].encInfo[g].maxBitRate;break}}break}}g_GetIPCChannelResolutionRate=parseInt(g_ipc_surportRes.defaChnnRate,10);g_GetIPCChannelResolutionBitstream=parseInt(k,10)}function TryIPCBsByFrames(c,f,e){var b=0;var a=g_ipc_surportRes.defaBitRate;var d=g_ipc_surportRes.defaChnnRate;var g=1;switch(f){case 8:case 128:g=1;GetIPCResoluteMaxBsCnt(c,f);a=g_GetIPCChannelResolutionBitstream;d=g_GetIPCChannelResolutionRate;b=a*e/d/g;b=ToValidBitRate(b,HIGH_CLOSEST,c);b=(b>MAX_BITRATE_ON_VGA)?MAX_BITRATE_ON_VGA:b;break;case 32:g=3;GetIPCResoluteMaxBsCnt(c,f);a=g_GetIPCChannelResolutionBitstream;d=g_GetIPCChannelResolutionRate;b=a*e*3/d/g;b=ToValidBitRate(b,HIGH_CLOSEST,c);b=(b>MAX_BITRATE_ON_HD720)?MAX_BITRATE_ON_HD720:b;break;case 16:g=6;GetIPCResoluteMaxBsCnt(c,f);a=g_GetIPCChannelResolutionBitstream;d=g_GetIPCChannelResolutionRate;b=a*e*6/d/g;b=ToValidBitRate(b,HIGH_CLOSEST,c);b=(b>MAX_SUGGEST_BITRATE_ON_HD1080)?MAX_SUGGEST_BITRATE_ON_HD1080:b;break;case 512:g=4;GetIPCResoluteMaxBsCnt(c,f);a=g_GetIPCChannelResolutionBitstream;d=g_GetIPCChannelResolutionRate;b=a*e*4/d/g;b=ToValidBitRate(b,HIGH_CLOSEST,c);b=(b>MAX_SUGGEST_BITRATE_ON_960P)?MAX_SUGGEST_BITRATE_ON_960P:b;break;case 2048:g=8;GetIPCResoluteMaxBsCnt(c,f);a=g_GetIPCChannelResolutionBitstream;d=g_GetIPCChannelResolutionRate;b=a*e*8/d/g;b=ToValidBitRate(b,HIGH_CLOSEST,c);b=(b>MAX_SUGGEST_BITRATE_ON_3M)?MAX_SUGGEST_BITRATE_ON_3M:b;break;case 4096:g=8;GetIPCResoluteMaxBsCnt(c,f);a=g_GetIPCChannelResolutionBitstream;d=g_GetIPCChannelResolutionRate;b=a*e*8/d/g;b=ToValidBitRate(b,HIGH_CLOSEST,c);b=(b>MAX_SUGGEST_BITRATE_ON_3M)?MAX_SUGGEST_BITRATE_ON_3M:b;break;default:g=1;GetIPCResoluteMaxBsCnt(c,8);a=g_GetIPCChannelResolutionBitstream;d=g_GetIPCChannelResolutionRate;b=a*e/d/g;b=ToValidBitRate(b,HIGH_CLOSEST,c);b=(b>MAX_BITRATE_ON_VGA)?MAX_BITRATE_ON_VGA:b;break}g_bUseStaticVideoBitRate=g_supportFunctions.IsUseStaticVideoBitRate();if(g_bUseStaticVideoBitRate){b=UseStaticVideoBitRate(c,f,e)}return b}function TryIPCFrameRate(h,n){if(h<g_local_ch_num){return}var f=h;var l=g_ipc_surportRes.maxTotalRateOnVGA;var r=g_ipc_surportRes.maxTotalBitRate;var g=0;var a=0;var y=document.getElementsByName("rec_frame_rate");var d=document.getElementsByName("rec_resolution");var e=document.getElementsByName("rec_maxbit_stream");var o=parseInt(const_hardware_ver.split(".")[0],10);if(NeedLimitedIPCFrameRate(o,parseInt(d[h].value,10))){if(g_videoFormat=="PAL"){if(parseInt(d[h].value,10)==16){if(parseInt(y[h].value,10)>12){window.alert(str_total_frame_rate_exceed);y[h].value=12}}else{if(parseInt(d[h].value,10)==32){if(parseInt(y[h].value,10)>25){window.alert(str_total_frame_rate_exceed);y[h].value=25}}}}else{if(parseInt(d[h].value,10)==16){if(parseInt(y[h].value,10)>15){window.alert(str_total_frame_rate_exceed);y[h].value=15}}else{if(parseInt(d[h].value,10)==32){if(parseInt(y[h].value,10)>30){window.alert(str_total_frame_rate_exceed);y[h].value=30}}}}}g=0;for(var p=0;p<y.length;p++){if((p<g_local_ch_num)||(g_majorNetChannelEncodeProperty[p-g_local_ch_num].online==0)){continue}if(g_majorNetChannelEncodeProperty[p-g_local_ch_num].online==2){g+=ConvertIPCCifRateEx(parseInt(g_ipc_surportRes.defaChnnRate,10),parseInt(g_ipc_surportRes.defaResolution,10))}else{g+=ConvertIPCCifRateEx(parseInt(y[p].value,10),parseInt(d[p].value,10))}}a=0;for(var p=0;p<e.length;p++){if((p<g_local_ch_num)||(g_majorNetChannelEncodeProperty[p-g_local_ch_num].online==0)){continue}if(g_majorNetChannelEncodeProperty[p-g_local_ch_num].online==2){a+=parseInt(g_ipc_surportRes.defaBitRate,10)}else{a+=parseInt(e[p].value,10)}}var v=e[h].selectedIndex;a-=parseInt(e[h].options[v].value,10);if(h>=g_local_ch_num&&h<g_local_ch_num+g_net_ch_num){var t=g_majorNetChannelEncodeProperty[h-g_local_ch_num].encInfo;var k=parseInt(y[h].value,10);for(var x=0;x<t.length;x++){if(parseInt(d[h].value,10)==parseInt(t[x].videoSize,10)){if(parseInt(t[x].Rate,10)>0&&parseInt(t[x].Rate,10)<k){y[h].value=parseInt(t[x].Rate,10);break}}}}if(y[h].value==""){y[h].value=1;return}var w=parseInt(d[h].value,10);var m=parseInt(y[h].value,10);var c=TryIPCBsByFrames(h,w,m);if(g<=l){if(g_bUseStaticVideoBitRate&&g_bBitRatedef){var q=g_BitRatexmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");for(i=0;i<q.length;i++){var b=q[i].firstChild.nodeValue.split("+");var u=b[0];if(w==u){e[h].value=b[1];c=parseInt(b[1],10);break}}}else{if(c>(r-a)){c=r-a;c=ToValidBitRate(c,LOW_CLOSEST,h)}e[h].value=c}if(c>(r-a)){window.alert(str_total_frame_rate_exceed);var s=0;while(v>0){s=a+parseInt(e[h].options[v-1].value,10);if(s<=r){break}v-=1}e[h].value=e[h].options[v-1].value}}if(g>l){window.alert(str_total_frame_rate_exceed);while(g>l){if(parseInt(y[h].value,10)-1<=0){break}y[h].value=parseInt(y[h].value,10)-1;g-=MultiCifIPCEx(d[h].value)}m=parseInt(y[h].value,10);c=TryIPCBsByFrames(h,w,m);if(c>(r-a)){c=r-a;c=ToValidBitRate(c,LOW_CLOSEST,h)}e[h].value=c}}function OnRecChangeBitRate(b,a){if(b<g_local_ch_num&&!a&&g_supportFunctions.IsSupportServerEncodeCheck()){CheckConfigParams(b);return}TryIPCBitstream(b)}function TryIPCBitstream(b){if(b<g_local_ch_num){return}var h=g_ipc_surportRes.maxTotalBitRate;var e=document.getElementsByName("rec_maxbit_stream");var a=0;var d;for(var f=0;f<e.length;f++){if((f<g_local_ch_num)||(g_majorNetChannelEncodeProperty[f-g_local_ch_num].online==0)){continue}if(g_majorNetChannelEncodeProperty[f-g_local_ch_num].online==2){a+=parseInt(g_ipc_surportRes.defaBitRate,10)}else{a+=parseInt(e[f].value,10)}}var g=e[b].selectedIndex;var c=0;if(a>h){window.alert(str_total_frame_rate_exceed);a-=parseInt(e[b].options[g].value,10);while(g>0){c=a+parseInt(e[b].options[g-1].value,10);if(c<=h){break}g-=1}e[b].value=e[b].options[g-1].value}}function ToValidBitRate(c,a,d){var h=c;var b=c;var g=document.getElementsByName("rec_maxbit_stream");var k=g[d].options;var f=k.length;if(c<=k[0].value){return k[0].value}else{if(c>=k[f-1].value){return k[f-1].value}else{for(var e=0;e<k.length-1;e++){if(c>k[e].value&&c<=k[e+1].value){return k[e+1].value}}}}return k[0].value}function UseStaticVideoBitRate(c,e,d){if(g_bUseStaticVideoBitRate){var a=1024;var b=1024;for(var f=0;f<g_vsBitRateInfo.length;f++){if(g_vsBitRateInfo[f].videoSize==e){a=parseInt(g_vsBitRateInfo[f].bitRate,10);break}}if(0!=a){b=a*d/g_GetIPCChannelResolutionRate;b=ToValidBitRate(b,HIGH_CLOSEST,c);if((8==e)||(128==e)){b=(b>MAX_BITRATE_ON_VGA)?MAX_BITRATE_ON_VGA:b}else{if(32==e){b=(b>MAX_BITRATE_ON_HD720)?MAX_BITRATE_ON_HD720:b}else{if(16==e){b=(b>MAX_SUGGEST_BITRATE_ON_HD1080)?MAX_SUGGEST_BITRATE_ON_HD1080:b}else{if(512==e){b=(b>MAX_SUGGEST_BITRATE_ON_960P)?MAX_SUGGEST_BITRATE_ON_960P:b}else{if((2048==e)||(4096==e)){b=(b>MAX_SUGGEST_BITRATE_ON_3M)?MAX_SUGGEST_BITRATE_ON_3M:b}else{b=(b>MAX_BITRATE_ON_VGA)?MAX_BITRATE_ON_VGA:b}}}}}}return b}};