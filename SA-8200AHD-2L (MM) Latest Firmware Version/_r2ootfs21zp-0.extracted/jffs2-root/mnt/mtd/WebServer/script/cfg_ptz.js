var cfg_ptz_header=new Array(str_ch,str_enabel,str_address,str_ptz_rate,str_protocol,str_simulate_cruise);var cfg_ptz_advance_header=new Array(str_ch,str_preset,str_cruise,str_track);var g_tempPresetArr=new Array();var g_tempCruiseArr=new Array();var g_bInPtzCfg=false;var g_bPreviewCruise=false;var g_bDisplayAllCh=false;var g_curSelectRowIndex=-1;function PTZCfg(c){var a=STR_PTZ_START_CFG;if(!c){a=STR_PTZ_STOP_CFG}var b="<request>\r\n";b+='<command name="'+a+'"></command>\r\n';b+="</request>\r\n";WebClient.ExcuteCmd(b)}function OnLoadCfgPtzBasic(){PTZCfg(true);g_bInPtzCfg=true;var c=document.getElementById("ptz_all_cfg");var a=document.getElementById("id_ptz_config");var d=document.getElementById("id_ptz_all");var j=document.getElementById("simulate_cruise_all");var b=document.getElementById("all_protocol");var h=document.getElementById("all_baud_rate");g_curConfigIndex=71;ApplyXmlLang("cfg_ptz.xml");CreateListPTZ(a,6,cfg_ptz_header,g_local_ch_num+g_net_ch_num);GenSelectListEx(b,g_ptzProtocol);GenSelectListEx(h,g_ptzBaudRate);document.getElementsByName("all_pzt_enable")[0].checked=true;var g=CreateConfigReqXml(ptz_config_array);var e=WebClient.ExcuteCmd(g);if(e==""){return false}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(e);g_xmlDoc.async=false;var f=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdatePtzConfig(f,true);cfgCopy2All(c,a,d,j);h.value=6;b.value=14;if(g_net_ch_num>0){document.getElementById("id_ptz_all").style.display="none";document.getElementById("ptz_all_label").style.display="none"}Align()}function LoadDefaultCfgPtzBasic(){if(GetDefaultCfg(ptz_config_array)){var c=document.getElementById("ptz_all_cfg");var b=document.getElementById("id_ptz_config");var d=document.getElementById("id_ptz_all");var l=document.getElementById("simulate_cruise_all");var e=document.getElementsByName("ptz_enable");var k=document.getElementsByName("address");var f=document.getElementsByName("baud_rate");var m=document.getElementsByName("protocol");var a=document.getElementsByName("simulate_cruise");var h=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdatePtzConfig(h,true);cfgCopy2All(c,b,d,l);g_bChange=true;for(var g=g_local_ch_num;g<g_local_ch_num+g_net_ch_num;g++){m[g].disabled=true;k[g].disabled=true;f[g].disabled=true;e[g].disabled=true;a[g].disabled=true}if(g_local_ch_num>0&&g_net_ch_num>0){document.getElementById("id_ptz_all").style.display="none";document.getElementById("ptz_all_label").style.display="none"}Align()}}function OnLoadCfgPtzAdvance(){var l=document.getElementById("id_ptz_advance");var a=document.getElementById("cuise_preset_set");ApplyXmlLang("cfg_ptz_advance.xml");CreateListPtzAdv(l,4,cfg_ptz_advance_header,g_local_ch_num+g_net_ch_num);ClearPresetList(a);var h=CreateConfigReqXml(ptz_advance_array);var e=WebClient.ExcuteCmd(h);if(e==""){return false}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(e);g_xmlDoc.async=false;var g=g_xmlDoc.documentElement.getElementsByTagName("command")[0];if(g.getAttribute("name")==STR_REPLY_CONFIG_FAIL){var l=document.getElementById("id_ptz_advance");for(var c=1;c<l.rows.length;c++){for(var d=1;d<l.rows[c].cells.length;d++){var b=l.rows[c].cells[d];b.getElementsByTagName("input")[0].disabled=true}}document.getElementById("save_btn").disabled=true;document.getElementById("save_btn1").disabled=true;document.getElementById("default_btn").disabled=true;document.getElementById("default_btn1").disabled=true}else{var f=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdatePreset(f)}if(g_local_ch_num==0){var l=document.getElementById("id_ptz_advance");for(var c=1;c<l.rows.length;c++){var b=l.rows[c].cells[3];b.getElementsByTagName("input")[0].disabled=true}}if((g_local_ch_num>0)&&(g_net_ch_num>0)){var l=document.getElementById("id_ptz_advance");for(var c=g_local_ch_num+1;c<l.rows.length;c++){var b=l.rows[c].cells[3];b.getElementsByTagName("input")[0].disabled=true}}Align()}function LoadDefaultCfgPtzAdvance(){if(GetDefaultCfg(ptz_advance_array)){PresetCancel();CruiseCancel();var c=g_xmlDoc.documentElement.getElementsByTagName("command")[0];if(c.getAttribute("name")==STR_REPLY_CONFIG_FAIL){var d=document.getElementById("id_ptz_advance");for(var a=1;a<d.rows.length;a++){for(var b=1;b<d.rows[a].cells.length;b++){var f=d.rows[a].cells[b];f.getElementsByTagName("input")[0].disabled=true}}document.getElementById("save_btn").disabled=true;document.getElementById("save_btn1").disabled=true;document.getElementById("default_btn").disabled=true;document.getElementById("default_btn1").disabled=true}else{var e=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");UpdatePreset(e);g_bChange=true}Align()}}function CreateListPTZ(g,a,b,j){var d=/msie/i.test(navigator.userAgent);var h=g.outerHTML.toLowerCase();var c=h.indexOf("</tbody>");h=h.substr(0,c);h+="<tr class = 'table_head_bgcolor'>";for(var e=0;e<a;e++){h+='<td style = "text-align:center">'+b[e]+"</td>"}h+="</tr>";for(var e=1;e<j+1;e++){if(d){h+="<tr>";h+='<td style = "width:50px;text-align:center">'+e+"</td>";h+='<td><input type = "checkbox" name="ptz_enable" onchange = "g_bChange = true;"/></td>';h+='<td><input style = "width:174px" type = "text" name = "address" onkeypress = "return isNumberInput(this,event);" onchange = "g_bChange = true,InputCheck(this,255,0);" maxlength = "3"/></td>';h+='<td><select style = "width:162px" name = "baud_rate" onchange = "g_bChange = true;"></select></td>';h+='<td><select style = "width:162px" name = "protocol" onchange = "g_bChange = true;"></select></td>';h+='<td><input type = "checkbox" name="simulate_cruise" onchange = "g_bChange = true;"/></td>';h+="</tr>"}else{h+="<tr>";h+='<td style = "width:50px;text-align:center">'+e+"</td>";h+='<td style = "width:68px;text-align:center"><input type = "checkbox" name="ptz_enable" style = "width:30px;" onchange = "g_bChange = true;"/></td>';h+='<td><input style = "width:174px" type = "text" name = "address" onkeypress = "return isNumberInput(this,event);" onchange = "g_bChange = true,InputCheck(this,255,0);" maxlength = "3"/></td>';h+='<td><select style = "width:162px" name = "baud_rate" onchange = "g_bChange = true;"></select></td>';h+='<td><select style = "width:162px" name = "protocol" onchange = "g_bChange = true;"></select></td>';h+='<td><input type = "checkbox" name="simulate_cruise" onchange = "g_bChange = true;"/></td>';h+="</tr>"}}h+="</tbody></table>";var f=g.parentNode;f.innerHTML=h;for(var e=1;e<j+1;e++){GenSelectListEx(document.getElementsByName("protocol")[e-1],g_ptzProtocol);GenSelectListEx(document.getElementsByName("baud_rate")[e-1],g_ptzBaudRate)}g=f.childNodes[0]}function CreateListPtzAdv(g,a,b,j){var d=/msie/i.test(navigator.userAgent);var h=g.outerHTML.toLowerCase();var c=h.indexOf("</tbody>");h=h.substr(0,c);h+="<tr class = 'table_head_bgcolor'>";for(var e=0;e<a;e++){h+='<td style = "text-align:center">'+b[e]+"</td>"}h+="</tr>";for(var e=1;e<j+1;e++){h+="<tr>";h+='<td style = "width:50px;text-align:center">'+e+"</td>";h+='<td align = "center" style = "width:218px;"><input style = "width:145px;" type = "button" value = '+set_button+" onclick = \"var preset_cfg = document.getElementById('preset_cfg');var cruise_cfg = document.getElementById('cruise_cfg');SetPreset(preset_cfg,cruise_cfg,"+e+')"/></td>';h+='<td align = "center" style = "width:218px;"><input style = "width:145px;" type = "button" value = '+set_button+" onclick = \"var preset_cfg = document.getElementById('preset_cfg');var cruise_cfg = document.getElementById('cruise_cfg');SetCruise(cruise_cfg,preset_cfg,"+e+')"/></td>';h+='<td align = "center" style = "width:219px;"><input style = "width:145px;" type = "button" value = '+set_button+' onclick = "GotoTraceSet('+(e-1)+')"/></td>';h+="</tr>"}h+="</tbody></table>";if(d){var f=g.parentElement}else{var f=g.parentNode}f.innerHTML=h;g=f.childNodes[0]}function UpdatePtzConfig(q,h){var p=document.getElementsByName("protocol");var g=document.getElementsByName("baud_rate");var m=document.getElementsByName("address");var e=document.getElementsByName("ptz_enable");var a=document.getElementsByName("simulate_cruise");var c=document.getElementById("ptz_all_cfg");var b=document.getElementById("all_protocol");var o=document.getElementById("all_baud_rate");for(i=0;i<q.length;i++){if(STR_PTZ_CONFIG==q[i].attributes.getNamedItem("name").nodeValue){var l=q[i].attributes.getNamedItem("index").nodeValue;if(h){for(var k=0;k<g_local_ch_num+g_net_ch_num;k++){var f=q[i].childNodes[0].nodeValue.toString().split("+");p[k].value=f[1];m[k].value=f[2];g[k].value=f[0];e[k].checked=((f[3]=="0")?false:true);i++}i--}else{var f=q[i].childNodes[0].nodeValue.toString().split("+");for(var k=0;k<g_local_ch_num+g_net_ch_num;k++){if(c.checked){f[1]=b.value;f[2]=m[k].value;f[0]=o.value;f[3]=(document.getElementsByName("all_pzt_enable")[0].checked?"1":"0")}else{f[1]=p[k].value;f[2]=m[k].value;f[0]=g[k].value;f[3]=(e[k].checked?"1":"0")}q[i].childNodes[0].nodeValue=f.join("+");i++}i--}}else{if(STR_PTZ_CURISE_TYPE==q[i].attributes.getNamedItem("name").nodeValue){if(h){for(var k=0;k<g_local_ch_num+g_net_ch_num;k++){var d=q[i].childNodes[0].nodeValue.toString().split("+");a[k].checked=((d[0]=="0")?false:true);i++}i--}else{var d=q[i].childNodes[0].nodeValue.toString().split("+");for(var k=0;k<g_local_ch_num+g_net_ch_num;k++){if(c.checked){d[0]=(document.getElementsByName("simulate_cruise_all")[0].checked?"1":"0")}else{d[0]=(a[k].checked?"1":"0")}q[i].childNodes[0].nodeValue=d.join("+");i++}i--}}}}for(var k=g_local_ch_num;k<g_local_ch_num+g_net_ch_num;k++){p[k].disabled=true;m[k].disabled=true;g[k].disabled=true;e[k].disabled=true;a[k].disabled=true}}function UpdatePreset(q){for(i=0;i<q.length;i++){if(STR_PTZ_PRESET_INFO==q[i].attributes.getNamedItem("name").nodeValue){var j=q[i].attributes.getNamedItem("index").nodeValue;g_PresetArr[j]=new Array();if(q[i].childNodes[0]==null){continue}var z=q[i].childNodes[0].nodeValue;var o=0;while(z.length>0){var h=parseInt(z,10);var B=z.indexOf("+");z=z.substr(B+1);var b=parseInt(z,10);B=z.indexOf("+");z=z.substr(B+1);var A=parseInt(z,10);var w=z.indexOf(":");var l=z.SubStringOfBytes(w+1,A);z=z.substr(w+l.length+2);g_PresetArr[j][o]=new PresetData(l,h,parseInt(b,10));o++}}if(STR_PTZ_CRUISE_INFO==q[i].attributes.getNamedItem("name").nodeValue){var j=q[i].attributes.getNamedItem("index").nodeValue;g_CruiseArr[j]=new Array();if(q[i].childNodes[0]==null){continue}var e=q[i].childNodes[0].nodeValue;var o=0;while(e.length>0){var u=e.indexOf("(");var y=e.substr(u+1);var f=y.indexOf("+");var c=y.substr(f);var x=parseInt(c,10);var a=x.toString().length;var w=c.indexOf(":")+1;var g=c.SubStringOfBytes(w,x);var t=c.substr(w+g.length);var d=t.indexOf(")");if(d==0){m=""}else{var m=t.substr(1,d-1)}if(m!=""){g_CruiseArr[j][o]=new CruiseData(g);var r=m.split("*");var p=0;for(var v=0;v<r.length;v++){var s=r[v].split("+");g_CruiseArr[j][o].PresetInfo[p]=new PresetInCruise(p,s[0],s[1],s[2]);p++}}else{g_CruiseArr[j][o]=new CruiseData(g)}e=t.substr(d+1);o++}}}}function SetPreset(j,d,f){if(g_PresetArr.length<=0){return}var e=/msie/i.test(navigator.userAgent);var a=document.getElementById("ptzAdvConfig_errortips");var h=document.getElementById("page_number");var g=document.getElementById("preset_set_channel");var b=document.getElementById("div_config_index");if(e){a.innerText=""}else{a.textContent=""}CruiseArrSave();PresetArrSave();g_curPageP=0;g_presetCIndex=f-1;for(var c=0;c<g_PresetArr[g_presetCIndex].length;c++){g_tempPresetArr[c]=new PresetData(g_PresetArr[g_presetCIndex][c].name,g_PresetArr[g_presetCIndex][c].index,parseInt(g_PresetArr[g_presetCIndex][c].bEnable,10))}h.innerHTML=(g_curPageP+1)+"/"+Math.ceil(g_tempPresetArr.length/8);if(j.style.display=="none"){d.style.display="none";j.style.display=""}g.innerHTML="<b>"+channel_string+f+"</b>";g.channel=f;ClearT();ShowPresetList(0,f-1);Align();EdgeCtrl(b,72);location.href="#preset_cfg"}function CopyPresetArray(){for(var a=0;a<g_PresetArr[g_presetCIndex].length;a++){if(g_tempPresetArr[a]){g_PresetArr[g_presetCIndex][a].name=g_tempPresetArr[a].name;g_PresetArr[g_presetCIndex][a].index=g_tempPresetArr[a].index;g_PresetArr[g_presetCIndex][a].bEnable=g_tempPresetArr[a].bEnable;g_PresetArr[g_presetCIndex][a].optionName=g_tempPresetArr[a].optionName;g_PresetArr[g_presetCIndex][a].optionValue=g_tempPresetArr[a].optionValue}}}function PresetSaveOK(){var b=document.getElementById("preset_cfg");var a=document.getElementById("div_config_index");PresetArrSave();ClearT();b.style.display="none";Align();EdgeCtrl(a,72)}function PresetCancel(){var b=document.getElementById("preset_cfg");var a=document.getElementById("div_config_index");ClearT();b.style.display="none";Align();EdgeCtrl(a,72)}function ShowPresetList(c,g){var h=document.getElementById("preset_info");var e=g_tempPresetArr.length;if(e==0){return}if(e<c*8){return}var d=document.getElementsByName("Preset_name_p");var b=document.getElementsByName("preset_enable");var f=document.getElementsByName("set_preset");for(var a=c*8;a<(c+1)*8;a++){var j=h.rows[a-c*8+2].cells;if(a>=e){j[0].innerHTML="";d[a%8].style.display="none";f[a%8].style.display="none";b[a%8].style.display="none"}else{j[0].innerHTML=parseInt(g_tempPresetArr[a].index,10)+1;d[a%8].style.display="";d[a%8].value=g_tempPresetArr[a].name;b[a%8].checked=g_tempPresetArr[a].bEnable;f[a%8].style.display="";b[a%8].style.display=""}}g_curPageP=c}function GotoNextP(){var a=document.getElementById("page_number");if(g_tempPresetArr.length==0){a.innerHTML="0/0"}else{var b=Math.ceil(g_tempPresetArr.length/8);if(g_curPageP+1>=b){window.alert(last_page_tip)}else{TemPresetArrSave();g_curPageP=g_curPageP+1;a.innerHTML=(g_curPageP+1)+"/"+b;ShowPresetList(g_curPageP,g_presetCIndex)}}}function GotoPrew(){var a=document.getElementById("page_number");var b=Math.ceil(g_tempPresetArr.length/8);if(g_curPageP==0){window.alert(first_page_tip)}else{TemPresetArrSave();g_curPageP=g_curPageP-1;ShowPresetList(g_curPageP,g_presetCIndex);a.innerHTML=(g_curPageP+1)+"/"+b}}function GotoFirst(){var a=document.getElementById("page_number");TemPresetArrSave();var b=Math.ceil(g_tempPresetArr.length/8);ShowPresetList(0,g_presetCIndex);a.innerHTML="1/"+b}function GotoEnd(){var a=document.getElementById("page_number");TemPresetArrSave();var b=Math.ceil(g_tempPresetArr.length/8);ShowPresetList(b-1,g_presetCIndex);a.innerHTML=b+"/"+b}function ClearT(){var c=document.getElementsByName("Preset_name_p");var a=document.getElementById("preset_info");for(var b=0;b<a.rows.length-2;b++){a.rows[b+2].cells[0].innerHTML="";c[b].style.display="none"}}function ModifyPresetP(a){TemPresetArrSave();pIndex=a+g_curPageP*8;var b=g_tempPresetArr[pIndex].index;GotoPresetSet(g_presetCIndex,b);g_bChange=true}function PresetArrSave(){var a=document.getElementById("preset_cfg");if(a.style.display==""){TemPresetArrSave();CopyPresetArray()}}function TemPresetArrSave(){var d=document.getElementsByName("Preset_name_p");var e=document.getElementsByName("preset_enable");var c=document.getElementById("preset_info");for(var f=2;f<c.rows.length;f++){if(c.rows[f].cells[0].innerHTML!=""){var b=parseInt(c.rows[f].cells[0].innerHTML,10)-1;var a=g_curPageP*8+f-2;g_tempPresetArr[a].index=b;g_tempPresetArr[a].name=d[f-2].value;g_tempPresetArr[a].bEnable=(e[f-2].checked)?1:0;g_tempPresetArr[a].optionName=d[f-2].value;g_tempPresetArr[a].optionValue=b}}}function PresetSave(g){var f=document.getElementById("div_config_index");var h=document.getElementById("preset_cfg");PresetArrSave();for(var d=0;d<g.length;d++){htmlName=g[d].attributes.getNamedItem("name").nodeValue;if(htmlName==STR_PTZ_PRESET_INFO){var a=g[d].attributes.getNamedItem("index").nodeValue;if(g[d].childNodes[0]==null){var e=g_xmlDoc.createTextNode("");g[d].appendChild(e)}g[d].childNodes[0].nodeValue="";var c=g_PresetArr[a];for(var b=0;b<g_PresetArr[a].length;b++){g[d].childNodes[0].nodeValue+=c[b].index+"+"+c[b].bEnable+"+"+c[b].name.size()+":"+c[b].name+"*"}}}h.style.display="none";Align();EdgeCtrl(f,72)}function SetCruise(k,t,p){if(g_CruiseArr.length<=0){return}var l=/msie/i.test(navigator.userAgent);var j=document.getElementById("ptz_cruise_preview_btn");var b=document.getElementById("cruise_set_channel");var s=document.getElementById("cruiseName");var h=document.getElementById("cruise_list");var f=document.getElementById("cuise_preset_set");var c=document.getElementById("div_config_index");var a=document.getElementById("ptzAdvConfig_errortips");if(l){a.innerText=""}else{a.textContent=""}PresetArrSave();CruiseArrSave();g_curPageC=0;g_cruiseCindex=p-1;g_curCruise=-1;if((g_net_ch_num>0)&&(p>g_local_ch_num)){j.disabled=true}else{j.disabled=false}g_tempCruiseArr=new Array();for(var e=0;e<g_CruiseArr[g_cruiseCindex].length;e++){g_tempCruiseArr[e]=new CruiseData(g_CruiseArr[g_cruiseCindex][e].CruiseName);var r=g_CruiseArr[g_cruiseCindex][e].PresetInfo;g_tempCruiseArr[e].PresetInfo=new Array();for(var d=0;d<r.length;d++){g_tempCruiseArr[e].PresetInfo[d]=new PresetInCruise(r[d].index,r[d].PresetIndex,r[d].HoldTime,r[d].Speed)}}if(k.style.display=="none"){t.style.display="none";k.style.display=""}b.innerHTML="<b>"+channel_string+p+"</b>";s.value="";s.disabled="disabled";var q=document.getElementsByName("preset_name");var g=document.getElementsByName("preset_hold_time");var o=document.getElementsByName("preset_speed");for(var e=0;e<q.length;e++){q[e].innerHTML="";GenSelectListEx(q[e],g_PresetArr[g_cruiseCindex])}for(var e=0;e<g.length;e++){g[e].innerHTML="";GenSelectListEx(g[e],g_presetHoldTime)}for(var e=0;e<o.length;e++){o[e].innerHTML="";GenSelectListEx(o[e],g_presetSpeed)}FreashCruiseList(h);ClearPresetList(f);FreashPresetList(f);Align();EdgeCtrl(c,72);location.href="#cruise_cfg"}function CruisePreview(){if(-1==g_curCruise){return}TemCruiseArrSave();var g="<request>\r\n";g+='<command name = "'+STR_PTZ_CRUISE_PREVIEW+'">\r\n';g+="<"+STR_CHANNEL+">"+g_cruiseCindex+"</"+STR_CHANNEL+">\r\n";g+="<"+STR_PTZ_CRUISE+">"+g_curCruise+"</"+STR_PTZ_CRUISE+">\r\n";g+="<"+STR_COUNT+">"+g_tempCruiseArr[g_curCruise].PresetInfo.length+"</"+STR_COUNT+">\r\n";var b=g_tempCruiseArr[g_curCruise].PresetInfo;for(var d=0;d<b.length;d++){var a=new Array(b[d].PresetIndex,b[d].HoldTime,b[d].Speed);g+="<"+STR_PTZ_PRESET_INFO+">"+a.join("+")+"</"+STR_PTZ_PRESET_INFO+">\r\n"}g+="</command>\r\n";g+="</request>\r\n";var f=WebClient.ExcuteCmd(g);if(f==""){return}var e;e=FormatToXmlDOM(f);e.async=false;var c=e.documentElement.getElementsByTagName("command")[0];delete e;if(c.getAttribute("name")!=STR_PTZ_CRUISE_PREVIEW_SUCC){window.alert("Cruise preview failed!");return}else{GotoCruisePreview(g_cruiseCindex);g_bPreviewCruise=true;g_liveSelChannel=g_cruiseCindex;RunPTZCtrl(STR_PTZ_RUN_CRUISE,g_curCruise)}}function RecoverCruisePreview(){RunPTZCtrl(STR_PTZ_STOP_CRUISE);var a="<request>\r\n";a+='<command name = "'+STR_PTZ_CRUISE_PREVIEW_RECOVER+'">\r\n';a+="<"+STR_CHANNEL+">"+g_cruiseCindex+"</"+STR_CHANNEL+">\r\n";a+="</command>\r\n";a+="</request>\r\n";WebClient.ExcuteCmd(a);g_bPreviewCruise=false;ExitCruisePreview()}function GotoCruisePreview(e){var g=document.getElementById("div_main_menu");var h=document.getElementById("div_config");var b=document.getElementById("div_live");var f=document.getElementById("div_ocx");h.style.display="none";f.style.display="";WebClient.style.display="";b.style.display="";f.style.left=g.offsetLeft+5;f.style.top=g.offsetTop+g.offsetHeight;f.style.width="770px";WebClient.style.width="";WebClient.style.width="770px";var a=/msie/i.test(navigator.userAgent);if(a){ocx_alt_label.style.display=""}WebClient.SetVisible(4|(e<<8));g_xmlhttp.open("get","body_html/body_cruise_preview.html",false);SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState==4){b.innerHTML=g_xmlhttp.responseText;EdgeCtrl(f,32)}document.getElementById("div_live").style.height="608px";if(document.getElementById("div_ocx").offsetHeight>document.getElementById("div_live").offsetHeight){var j=document.getElementById("div_ocx").offsetHeight+5;document.getElementById("div_live").style.height="";document.getElementById("div_live").style.height=j+"px";WebClient.style.height=j+"px";if(a){document.getElementById("div_ocx").style.height="";document.getElementById("div_ocx").style.height=j+"px";var d=j+40;document.getElementById("work_area").style.height=d+"px"}}else{var c=document.getElementById("div_live").offsetHeight-5;document.getElementById("div_ocx").style.height="";document.getElementById("div_ocx").style.height=c+"px";WebClient.style.height=c+"px";if(!a){var d=c+40;document.getElementById("work_area").style.height=d+"px"}}}function ExitCruisePreview(){var e=document.getElementById("div_config_index");var b=document.getElementById("div_ocx");var d=document.getElementById("div_live");var c=document.getElementById("div_config");var a=document.getElementById("ocx_alt_label");WebClient.SetVisible(0);b.style.width="0px";b.style.height="0px";WebClient.style.width="0px";WebClient.style.height="0px";d.style.display="none";a.style.display="none";d.innerHTML="";c.style.display="";Align();EdgeCtrl(e,72);location.href="#cruise_cfg"}function CruiseSaveOK(){var c=document.getElementById("div_config_index");var d=document.getElementById("cruise_list");var a=document.getElementById("cruise_cfg");var b=document.getElementById("cuise_preset_set");CruiseArrSave();ClearPresetList(b);d.innerHTML="";a.style.display="none";Align();EdgeCtrl(c,72)}function CopyCruiseArray(){g_CruiseArr[g_cruiseCindex]=new Array();for(var a=0;a<g_tempCruiseArr.length;a++){g_CruiseArr[g_cruiseCindex][a]=new CruiseData(g_tempCruiseArr[a].CruiseName);var b=g_tempCruiseArr[a].PresetInfo;for(var c=0;c<g_tempCruiseArr[a].PresetInfo.length;c++){g_CruiseArr[g_cruiseCindex][a].PresetInfo[c]=new PresetInCruise(b[c].index,b[c].PresetIndex,b[c].HoldTime,b[c].Speed)}}}function CruiseCancel(){var c=document.getElementById("div_config_index");var d=document.getElementById("cruise_list");var b=document.getElementById("cuise_preset_set");var a=document.getElementById("cruise_cfg");d.innerHTML="";ClearPresetList(b);a.style.display="none";Align();EdgeCtrl(c,72)}function FreashCruiseList(c){var a=document.getElementById("cruiseName");var d=g_tempCruiseArr.length;c.innerHTML="";a.value="";if(d==0){return}for(var b=0;b<d;b++){c[b]=document.createElement("option");c[b].text=g_tempCruiseArr[b].CruiseName}}function ClearPresetList(d){for(var b=1;b<d.rows.length;b++){d.rows[b].cells[0].innerHTML="";var c=d.rows[b].getElementsByTagName("select");for(var a=0;a<c.length;a++){c[a].style.display="none"}}}function FreashPresetList(b){var c=b.rows.length;for(var a=0;a<c;a++){b.rows[a].style.background=ptz_pincruise_unsel_bg;b.rows[a].style.color=ptz_pincruise_unsel_color}}function GetCruiseValue(d,h,g){var c=document.getElementById("cuise_preset_set");var f=document.getElementById("ptz_cruise_preview_btn");var b=document.getElementById("page_inC");g_curSelectRowIndex=-1;TemCruiseArrSave();ClearPresetList(c);FreashPresetList(c);g_curPageC=0;for(var e=0;e<d.length;e++){if(d.options[e].selected){g_curCruise=e;f.disabled=false;h.value="";h.disabled=false;h.value=d.options[e].text;var a=g_tempCruiseArr[e].PresetInfo.length;var j=Math.ceil(a/5);if(a){ShowPresetInC(0,g_cruiseCindex);b.innerHTML="1/"+j}else{b.innerHTML="1/1"}break}}}function SaveCruiseName(b,d){for(var a=0;a<d.length;a++){if(d.options[a].selected){var c=/firefox/i.test(navigator.userAgent);d.options[a].text=b.value;g_tempCruiseArr[a].CruiseName=b.value;break}}}function AddCruise(b){var a=document.getElementById("cruiseName");var c=document.getElementById("cuise_preset_set");var d=b.length;if(d>=g_cruise_num){window.alert(cruise_max_num_tip+g_cruise_num+"!");return}b[d]=document.createElement("option");b[d].text="Cruise";b[d].selected=true;g_tempCruiseArr[g_tempCruiseArr.length]=new CruiseData(b[d].text);TemCruiseArrSave();GetCruiseValue(b,a,c);g_bChange=true}function DelCruise(c){var d=document.getElementById("cuise_preset_set");var a=document.getElementById("cruiseName");var e=c.length;var b=c.selectedIndex;if(e==0){window.alert(preset_empty_tip);return}if(b==-1){window.alert(cruise_select_tip);return}c.removeChild(c.options[b]);g_tempCruiseArr.splice(b,1);g_bChange=true;ClearPresetList(d);if(b<c.length){c.options[b].selected=true}else{if(b==0){ClearPresetList(d);a.value="";a.disabled="disabled";return}else{c.options[b-1].selected=true}}GetCruiseValue(c,a,d)}function DelAllCruise(b){if(b.length==0){window.alert(preset_empty_tip);return}var a=document.getElementById("cruiseName");var c=document.getElementById("cuise_preset_set");if(confirm(delete_all_confirm)){a.value="";a.disabled="disabled";b.innerHTML="";g_tempCruiseArr=new Array();ClearPresetList(c);g_bChange=true}}function ShowPresetInC(c,g){var j=document.getElementsByName("preset_name");var d=document.getElementsByName("preset_hold_time");var f=document.getElementsByName("preset_speed");var b=document.getElementById("cuise_preset_set");var k=g_tempCruiseArr[g_curCruise].PresetInfo;var m=k.length;for(var h=0;h<k.length;h++){k[h].index=h}for(var a=c*5;a<(c+1)*5;a++){if(k[a]==null){return}var e=k.length;if(e<c*5){return}var l=b.rows[a-c*5+1].cells;if(a>=e){l[0].innerHTML="";j[a%5].style.display="none";d[a%5].style.display="none";f[a%5].style.display="none"}else{if(k[a]==null){continue}l[0].innerHTML=k[a].index+1;j[a%5].style.display="";j[a%5].value=k[a].PresetIndex;d[a%5].style.display="";d[a%5].value=k[a].HoldTime;f[a%5].style.display="";f[a%5].value=k[a].Speed}}}function GotoNextC(){var b=document.getElementById("cuise_preset_set");var c=document.getElementById("page_inC");if(g_tempCruiseArr[g_curCruise]==null){return}var a=Math.ceil(g_tempCruiseArr[g_curCruise].PresetInfo.length/5);g_curPageC=g_curPageC+1;if(g_curPageC+1>a){window.alert(last_page_tip);g_curPageC=g_curPageC-1}else{TemCruiseArrSave();ClearPresetList(b);FreashPresetList(b);c.innerHTML=(g_curPageC+1)+"/"+a;ShowPresetInC(g_curPageC,g_cruiseCindex)}}function GotoPrewC(){var b=document.getElementById("cuise_preset_set");var c=document.getElementById("page_inC");if(g_tempCruiseArr[g_curCruise]==null){return}var a=Math.ceil(g_tempCruiseArr[g_curCruise].PresetInfo.length/5);if(g_curPageC==0){window.alert(first_page_tip)}else{TemCruiseArrSave();g_curPageC=g_curPageC-1;ClearPresetList(b);FreashPresetList(b);ShowPresetInC(g_curPageC,g_cruiseCindex);c.innerHTML=(g_curPageC+1)+"/"+a}}function GotoFirC(){var b=document.getElementById("cuise_preset_set");var c=document.getElementById("page_inC");if(g_tempCruiseArr[g_curCruise]==null){return}TemCruiseArrSave();ClearPresetList(b);FreashPresetList(b);var a=Math.ceil(g_tempCruiseArr[g_curCruise].PresetInfo.length/5);g_curPageC=0;ShowPresetInC(g_curPageC,g_cruiseCindex);c.innerHTML="1/"+a}function GotoEndC(){var b=document.getElementById("cuise_preset_set");var c=document.getElementById("page_inC");if(g_tempCruiseArr[g_curCruise]==null){return}TemCruiseArrSave();ClearPresetList(b);FreashPresetList(b);var a=Math.ceil(g_tempCruiseArr[g_curCruise].PresetInfo.length/5);g_curPageC=a-1;ShowPresetInC(g_curPageC,g_cruiseCindex);c.innerHTML=a+"/"+a}function Selected(c){var a=/msie/i.test(navigator.userAgent);if(a){if(c.style.background.toUpperCase()==ptz_pincruise_sel_bg){return}}else{if(g_curSelectRowIndex>0&&g_curSelectRowIndex==(c.rowIndex-1)%5){return}}g_curSelectRowIndex=-1;var b=c.parentNode;for(i=1;i<b.rows.length;i++){b.rows[i].style.background=ptz_pincruise_unsel_bg;b.rows[i].style.color=ptz_pincruise_unsel_color}if(a){var d=c.cells[0].innerText}else{var d=c.cells[0].textContent}if(d!=""){c.style.background=ptz_pincruise_sel_bg;c.style.color=ptz_pincruise_sel_color;g_curSelectRowIndex=(c.rowIndex-1)%5}}function AddPresetInC(d,e){var a=document.getElementById("cruiseName");if(g_tempCruiseArr.length==0){window.alert(cruise_select_tip);return}for(var c=0;c<d.length;c++){if(d.options[c].selected){var b=g_tempCruiseArr[c].PresetInfo.length;if(b>=g_max_preset_per_cruise){window.alert(preset_max_num_tip+g_max_preset_per_cruise+"!");return}g_tempCruiseArr[c].PresetInfo[b]=new PresetInCruise(b,0,5,1);GotoEndC()}}g_bChange=true}function DelPresetInc(d,o){TemCruiseArrSave();var q=document.getElementsByName("preset_name");var h=document.getElementsByName("preset_hold_time");var p=document.getElementsByName("preset_speed");var c=document.getElementById("cuise_preset_set");var b=/msie/i.test(navigator.userAgent);var m=false;for(var g=0;g<d.length;g++){if(d.options[g].selected){var k=g_tempCruiseArr[g].PresetInfo.length;if(k==0){window.alert(preset_empty_tip)}else{for(var f=0;f<k;f++){if(o.rows[f%5+1].style.background.toUpperCase()==ptz_pincruise_sel_bg||(g_curSelectRowIndex>=0&&g_curSelectRowIndex==f%5)){var e=parseInt(o.rows[f%5+1].cells[0].innerHTML,10);g_tempCruiseArr[g].PresetInfo.splice(e-1,1);g_bChange=true;for(var a=0;a<g_tempCruiseArr[g].PresetInfo.length;a++){g_tempCruiseArr[g].PresetInfo[a].index=a}ClearPresetList(c);ShowPresetInC(g_curPageC,g_cruiseCindex);if(o.rows[f%5+1].cells[0].innerHTML==""){if(g_tempCruiseArr[g].PresetInfo.length>0){var l=0;var s=0;if((f%5)>0){l=f%5;s=f%5-1}else{if(g_curPageC>0){var r=Math.ceil(g_tempCruiseArr[g_curCruise].PresetInfo.length/5);g_curPageC=g_curPageC-1;ShowPresetInC(g_curPageC,g_cruiseCindex);page_inC.innerHTML=(g_curPageC+1)+"/"+r;l=0;s=4}}o.rows[l+1].style.background=ptz_pincruise_unsel_bg;o.rows[l+1].style.color=ptz_pincruise_unsel_color;q[l].style.background="white";q[l].style.color="black";h[l].style.background="white";h[l].style.color="black";p[l].style.background="white";p[l].style.color="black";o.rows[s+1].style.background=ptz_pincruise_sel_bg;o.rows[s+1].style.color=ptz_pincruise_sel_color;g_curSelectRowIndex=s}else{FreashPresetList(c);g_curSelectRowIndex=-1}}break}}if(f==k){window.alert(preset_select_tip)}}}}}function ClearAllPInC(){var a=document.getElementById("cuise_preset_set");if(a.rows[1].cells[0].innerHTML==""){window.alert(preset_empty_tip);return}if(confirm(delete_all_confirm)){g_tempCruiseArr[g_curCruise].PresetInfo=new Array();ClearPresetList(a);g_bChange=true}}function CruiseArrSave(){var a=document.getElementById("cruise_cfg");if(a.style.display==""){TemCruiseArrSave();CopyCruiseArray()}}function TemCruiseArrSave(){var h=document.getElementsByName("preset_name");var e=document.getElementsByName("preset_hold_time");var g=document.getElementsByName("preset_speed");var f=document.getElementById("cruise_list");var b=document.getElementById("cuise_preset_set");var j=document.getElementById("cruiseName");if(f.length>0){for(var c=0;c<f.length;c++){g_tempCruiseArr[c].CruiseName=f.options[c].text}for(var a=1;a<b.rows.length;a++){if(b.rows[a].cells[0].innerHTML!=""){var d=parseInt(b.rows[a].cells[0].innerHTML,10)-1;g_tempCruiseArr[g_curCruise].PresetInfo[d].index=d;g_tempCruiseArr[g_curCruise].PresetInfo[d].PresetIndex=h[a-1].value;g_tempCruiseArr[g_curCruise].PresetInfo[d].HoldTime=e[a-1].value;g_tempCruiseArr[g_curCruise].PresetInfo[d].Speed=g[a-1].value}}}}function CruiseSave(j){var a=document.getElementById("div_config_index");var b=document.getElementById("cruise_cfg");CruiseArrSave();for(var d=0;d<j.length;d++){htmlName=j[d].attributes.getNamedItem("name").nodeValue;if(htmlName==STR_PTZ_CRUISE_INFO){var f=j[d].attributes.getNamedItem("index").nodeValue;if(j[d].childNodes[0]==null){var e=g_xmlDoc.createTextNode("");j[d].appendChild(e)}j[d].childNodes[0].nodeValue="";for(var c=0;c<g_CruiseArr[f].length;c++){var h=g_CruiseArr[f][c];j[d].childNodes[0].nodeValue+="("+c+"+"+h.CruiseName.size()+":"+h.CruiseName;for(n=0;n<g_CruiseArr[f][c].PresetInfo.length;n++){var g=g_CruiseArr[f][c].PresetInfo[n];j[d].childNodes[0].nodeValue+="*"+g.PresetIndex+"+"+g.HoldTime+"+"+g.Speed}j[d].childNodes[0].nodeValue+=")"}}}b.style.display="none";Align();EdgeCtrl(a,72)}function PresetSetCC(){var a=document.getElementById("preset_list");RunPTZCtrl(STR_PTZ_GO_PRESET,a.value)}function SavePresetSet(){var c=document.getElementById("preset_set_channel_list");var b=document.getElementById("preset_list");var a="<request>\r\n";a+='<command name="'+STR_PTZ_CONTROL+'">\r\n';a+="<channel>"+c.value+"</channel>\r\n";a+="<action>"+STR_PTZ_SET_PRESET+"</action>\r\n";a+="<preset>"+g_PresetArr[parseInt(c.value,10)][b.selectedIndex].index+"</preset>\r\n";a+="</command>\r\n";a+="</request>\r\n";WebClient.ExcuteCmd(a)}function RecordTrack(e){var d=document.getElementById("trace_channel_list");var a=document.getElementById("btn_record_trace");var c=document.getElementById("btn_record_trace_stop");var b="<request>\r\n";b+='<command name="'+STR_PTZ_CONTROL+'">\r\n';b+="<channel>"+d.value+"</channel>\r\n";if(e){a.style.display="none";c.style.display="";d.disabled=true;b+="<action>"+STR_PTZ_START_REC_TRACK+"</action>\r\n"}else{a.style.display="";c.style.display="none";d.disabled=false;b+="<action>"+STR_PTZ_STOP_REC_TRACK+"</action>\r\n"}b+="</command>\r\n";b+="</request>\r\n";WebClient.ExcuteCmd(b)}function ChangePresetChannel(b){var a=document.getElementById("preset_list");if(g_bDisplayAllCh){WebClient.SetVisible(5|(b<<8))}else{WebClient.SetVisible(4|(b<<8))}GenSelectListEx(a,g_PresetArr[b]);g_liveSelChannel=b;PresetSetCC()}function GotoPresetSet(g,o){var m=document.getElementById("div_main_menu");var q=document.getElementById("div_config");var l=document.getElementById("div_ocx");var c=document.getElementById("div_live");g_bDisplayAllCh=false;q.style.display="none";l.style.display="";WebClient.style.display="";c.style.display="";l.style.left=m.offsetLeft+5;l.style.top=m.offsetTop+m.offsetHeight;l.style.width="770px";WebClient.style.width="";WebClient.style.width="770px";var a=/msie/i.test(navigator.userAgent);if(a){ocx_alt_label.style.display=""}WebClient.SetVisible(4|(g<<8));g_xmlhttp.open("get","body_html/body_preset_set.html",false);SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState==4){c.innerHTML=g_xmlhttp.responseText;var h=document.getElementById("preset_set_channel_list");var d=document.getElementById("preset_list");GenSelectListEx(h,g_channelList);h.value=g;GenSelectListEx(d,g_tempPresetArr);d.value=o;g_liveSelChannel=g;g_xmlhttp.open("get","body_html/body_ptz_ctrlpane.html",false);SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState==4){var j=document.getElementById("div_ptz_pane");j.innerHTML=g_xmlhttp.responseText;var p=document.getElementById("div_speed");var b=document.getElementById("speed_bk");var s=document.getElementById("speed_thumb");var k=document.getElementById("speed_tip");CreateSlider(p,b,s,k,1,8);SetSliderPos(b,s,4);EdgeCtrl(l,32);ApplyXmlLang("cfg_preset_set.xml");PresetSetCC()}}document.getElementById("div_live").style.height="608px";if(document.getElementById("div_ocx").offsetHeight>document.getElementById("div_live").offsetHeight){var r=document.getElementById("div_ocx").offsetHeight+5;document.getElementById("div_live").style.height="";document.getElementById("div_live").style.height=r+"px";WebClient.style.height=r+"px";if(!a){var f=r+40;document.getElementById("work_area").style.height=f+"px"}}else{var e=document.getElementById("div_live").offsetHeight-5;document.getElementById("div_ocx").style.height="";document.getElementById("div_ocx").style.height=e+"px";WebClient.style.height=e+"px";if(!a){var f=e+40;document.getElementById("work_area").style.height=f+"px"}}}function ExitPresetSet(){var b=document.getElementById("div_ocx");var e=document.getElementById("div_live");var d=document.getElementById("div_config");var c=document.getElementById("div_config_index");var a=document.getElementById("ocx_alt_label");WebClient.SetVisible(0);b.style.width="0px";b.style.height="0px";WebClient.style.width="0px";WebClient.style.height="0px";e.style.display="none";a.style.display="none";e.innerHTML="";d.style.display="";ShowPresetList(g_curPageP,g_presetCIndex);EdgeCtrl(c,72);location.href="#preset_set_label";Align()}function ChangeTraceSet(a){if(g_bDisplayAllCh){WebClient.SetVisible(5|(a<<8))}else{WebClient.SetVisible(4|(a<<8))}g_liveSelChannel=a}function GotoTraceSet(u){var r=document.getElementById("div_main_menu");var b=document.getElementById("div_config");var s=document.getElementById("div_live");var e=document.getElementById("div_ocx");var p=document.getElementById("cruise_cfg");var t=document.getElementById("ptzAdvConfig_errortips");var a=document.getElementById("preset_cfg");var d=/msie/i.test(navigator.userAgent);g_bDisplayAllCh=false;if(d){t.innerText=""}else{t.textContent=""}g_liveSelChannel=u;if(a.style.display==""){PresetArrSave();a.style.display="none"}if(p.style.display==""){CopyCruiseArray();CruiseArrSave();p.style.display="none"}b.style.display="none";e.style.display="";WebClient.style.display="";s.style.display="";e.style.left=r.offsetLeft+5;e.style.top=r.offsetTop+r.offsetHeight;e.style.width="770px";WebClient.style.width="";WebClient.style.width="770px";var g=/msie/i.test(navigator.userAgent);if(g){ocx_alt_label.style.display=""}WebClient.SetVisible(4|(u<<8));g_xmlhttp.open("get","body_html/body_trace_set.html",false);SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState==4){s.innerHTML=g_xmlhttp.responseText;var m=document.getElementById("trace_channel_list");GenSelectListEx(m,g_channelList);m.value=u;g_xmlhttp.open("get","body_html/body_ptz_ctrlpane.html",false);SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState==4){var f=document.getElementById("div_ptz_pane");f.innerHTML=g_xmlhttp.responseText;var j=document.getElementById("div_speed");var o=document.getElementById("speed_bk");var c=document.getElementById("speed_thumb");var q=document.getElementById("speed_tip");CreateSlider(j,o,c,q,1,8);SetSliderPos(o,c,4);EdgeCtrl(e,32);ApplyXmlLang("cfg_track_set.xml");StopPTZCurrentAction(u)}}document.getElementById("div_live").style.height="608px";if(document.getElementById("div_ocx").offsetHeight>document.getElementById("div_live").offsetHeight){var h=document.getElementById("div_ocx").offsetHeight+5;document.getElementById("div_live").style.height="";document.getElementById("div_live").style.height=h+"px";WebClient.style.height=h+"px";if(g){document.getElementById("div_ocx").style.height="";document.getElementById("div_ocx").style.height=h+"px";var l=h+40;document.getElementById("work_area").style.height=l+"px"}}else{var k=document.getElementById("div_live").offsetHeight-5;document.getElementById("div_ocx").style.height="";document.getElementById("div_ocx").style.height=k+"px";WebClient.style.height=k+"px";if(!g){var l=k+40;document.getElementById("work_area").style.height=l+"px"}}}function ExitTraceSet(){var c=document.getElementById("div_ocx");var f=document.getElementById("div_live");var e=document.getElementById("div_config");var d=document.getElementById("div_config_index");var b=document.getElementById("btn_record_trace_stop");var a=document.getElementById("ocx_alt_label");if(b.style.display==""){RecordTrack(false)}WebClient.SetVisible(0);c.style.width="0px";c.style.height="0px";WebClient.style.width="0px";WebClient.style.height="0px";f.style.display="none";a.style.display="none";f.innerHTML="";e.style.display="";Align();EdgeCtrl(d,72)}function StopPTZCurrentAction(a){var b="<request>\r\n";b+='<command name="'+STR_PTZ_STOP_ACTION+'">\r\n';b+="<parameter>"+a+"</parameter>\r\n";b+="</command>\r\n";b+="</request>\r\n";WebClient.ExcuteCmd(b)}function CheckAllChannel(a){if(a.checked){WebClient.SetVisible(5|(g_liveSelChannel<<8));g_bDisplayAllCh=true}else{WebClient.SetVisible(4|(g_liveSelChannel<<8));g_bDisplayAllCh=false}};