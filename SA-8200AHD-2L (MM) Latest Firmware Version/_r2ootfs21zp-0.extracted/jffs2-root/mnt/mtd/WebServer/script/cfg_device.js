var g_curSearchPageIndex=0;var g_DeviceSelItem=new Array();var g_deviceInfoArray=new Array();var cfg_device_header=new Array(str_ch,str_device_ip,str_manufacturer,str_device_model,str_device_status);var g_device_manufacturer=new Array();var g_device_model=new Array();var g_supportDevice=new Array();var bHttpPort=false;var bCtrlPort=false;var g_searchDevice=new Array();var g_supportMaxDeviceNum=0;var g_ipc_support_encode=new Object;var g_device_channel=new Array();var bChecked=false;var g_deviceCopy=new Array();function SupportDeviceInfo(a,c,d,b){this.manufacturerId=a;this.manufacturerName=c;this.bHttpPort=d;this.bCtrlPort=b}function DeviceInfo(e,l,f,o,d,b,j,c,a,i,r,q,h,m,p,g){this.deviceId=e;this.channel=l;this.status=f;this.etherName=o;this.server=d;this.port=b;this.httpPort=j;this.ctrlPort=c;this.snId=a;this.loginUserName=i;this.loginUserPwd=r;this.manufacturerId=q;this.manufacturerName=h;this.productModel=m;this.useDefaultCfg=p;this.bPOEDevice=g}function SearchDeviceInfo(g,d,h,b,f,a,e,c){this.server=g;this.port=d;this.httpPort=h;this.ctrlPort=b;this.snId=f;this.manufacturerId=a;this.manufacturerName=e;this.product_model=c}function GetConfigInfo(){var j=/msie/i.test(navigator.userAgent);var q="<request>\r\n";q+='<command name="'+STR_REQUEST_SUPPORT_DEVICE+'">\r\n';q+="</command>\r\n";q+="</request>\r\n";var b=WebClient.ExcuteCmd(q);if(b==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(b);g_xmlDoc.async=false;var p=g_xmlDoc.documentElement.getElementsByTagName("command")[0];if(p.getAttribute("name")==STR_REPLY_SUPPORT_DEVICE){var a=p.getElementsByTagName(STR_MANUFACTURER_NAME);for(var g=0;g<a.length;g++){if(j){var f=a[g].getAttribute("name");var r=a[g].getElementsByTagName(STR_MANUFACTURER_ID)[0].text;var m=a[g].getElementsByTagName(STR_IF_NEED_HTTP_PORT)[0].text;var h=a[g].getElementsByTagName(STR_IF_NEED_CTRL_PORT)[0].text;g_supportDevice[g]=new SupportDeviceInfo(r,f,m,h)}else{var f=a[g].getAttribute("name");var e=a[g].getElementsByTagName(STR_MANUFACTURER_ID)[0].childNodes;var r=0;if(e.length>0){r=a[g].getElementsByTagName(STR_MANUFACTURER_ID)[0].childNodes[0].nodeValue}e=a[g].getElementsByTagName(STR_IF_NEED_HTTP_PORT)[0].childNodes;var m=0;if(e.length>0){m=a[g].getElementsByTagName(STR_IF_NEED_HTTP_PORT)[0].childNodes[0].nodeValue}e=a[g].getElementsByTagName(STR_IF_NEED_CTRL_PORT)[0].childNodes;var h=0;if(e.length>0){h=a[g].getElementsByTagName(STR_IF_NEED_CTRL_PORT)[0].childNodes[0].nodeValue}g_supportDevice[g]=new SupportDeviceInfo(r,f,m,h)}}}q="<request>\r\n";q+='<command name="'+STR_REQUEST_DEVICE_MAX_NUM+'">\r\n';q+="</command>\r\n";q+="</request>\r\n";var b=WebClient.ExcuteCmd(q);if(b==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(b);g_xmlDoc.async=false;p=g_xmlDoc.documentElement.getElementsByTagName("command")[0];if(p.getAttribute("name")==STR_REPLY_DEVICE_MAX_NUM){if(j){g_supportMaxDeviceNum=p.text}else{var e=p.childNodes;if(e.length>0){g_supportMaxDeviceNum=p.childNodes[0].nodeValue}}}var l=CreateConfigReqXml(ipc_support_encode_array);var d=WebClient.ExcuteCmd(l);if(d==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(d);g_xmlDoc.async=false;var c=g_xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");var o=c[0].childNodes[0].nodeValue.split("+");if(g_videoFormat=="NTSC"){g_ipc_support_encode.maxTotalRateOnVGA=parseInt(o[3],10)}else{g_ipc_support_encode.maxTotalRateOnVGA=o[3]}g_ipc_support_encode.maxTotalBitRate=o[4];g_ipc_support_encode.defaResolution=o[5];g_ipc_support_encode.defaChnnRate=o[6];g_ipc_support_encode.defaBitRate=o[7]}function GetDeviceInfo(){var d=/msie/i.test(navigator.userAgent);var l="<request>\r\n";l+='<command name="'+STR_REQUEST_GET_DEVICE_LOG+'">\r\n';l+="</command>\r\n";l+="</request>\r\n";var t=WebClient.ExcuteCmd(l);if(t==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(t);g_xmlDoc.async=false;var a=g_xmlDoc.documentElement.getElementsByTagName("command")[0];if(a.getAttribute("name")==STR_REPLY_GET_DEVICE_LOG_FAIL){window.alert(gain_data_error_tip)}else{if(a.getAttribute("name")==STR_REPLY_GET_DEVICE_LOG_SUCC){var y=a.getElementsByTagName("item");for(var u=0;u<y.length;u++){if(d){var m=y[u].getElementsByTagName(STR_DEVICE_ID)[0].text;var z=y[u].getElementsByTagName(STR_CHANNEL)[0].text;var q=y[u].getElementsByTagName(STR_STATUS)[0].text;var b=y[u].getElementsByTagName(STR_ETHER_NAME)[0].text;var p=y[u].getElementsByTagName(STR_SERVER)[0].text;var f=y[u].getElementsByTagName(STR_PORT)[0].text;var h=y[u].getElementsByTagName(STR_HTTP_PORT)[0].text;var v=y[u].getElementsByTagName(STR_CTRL_PORT)[0].text;var r=y[u].getElementsByTagName(STR_SN_ID)[0].text;var c=y[u].getElementsByTagName(STR_LOGIN_USER_NAME)[0].text;var g=y[u].getElementsByTagName(STR_LOGIN_USER_PWD)[0].text;var o=y[u].getElementsByTagName(STR_MANUFACTURER_ID)[0].text;var j=y[u].getElementsByTagName(STR_MANUFACTURER_NAME)[0].text;var w=y[u].getElementsByTagName(STR_PRODUCT_MODEL)[0].text;var e=y[u].getElementsByTagName(STR_USE_DEFAULT_CFG)[0].text;var s=y[u].getElementsByTagName(STR_IS_POE_DEVICE)[0].text;g_deviceInfoArray[u]=new DeviceInfo(m,z,q,b,p,f,h,v,r,c,g,o,j,w,e,s)}else{var m=0;var x=y[u].getElementsByTagName(STR_DEVICE_ID)[0].childNodes;if(x.length>0){m=y[u].getElementsByTagName(STR_DEVICE_ID)[0].childNodes[0].nodeValue}var z=0;x=y[u].getElementsByTagName(STR_CHANNEL)[0].childNodes;if(x.length>0){z=y[u].getElementsByTagName(STR_CHANNEL)[0].childNodes[0].nodeValue}var q=1;x=y[u].getElementsByTagName(STR_STATUS)[0].childNodes;if(x.length>0){q=y[u].getElementsByTagName(STR_STATUS)[0].childNodes[0].nodeValue}var b="";x=y[u].getElementsByTagName(STR_ETHER_NAME)[0].childNodes;if(x.length>0){b=y[u].getElementsByTagName(STR_ETHER_NAME)[0].childNodes[0].nodeValue}var p="";x=y[u].getElementsByTagName(STR_SERVER)[0].childNodes;if(x.length>0){p=y[u].getElementsByTagName(STR_SERVER)[0].childNodes[0].nodeValue}var f=0;x=y[u].getElementsByTagName(STR_PORT)[0].childNodes;if(x.length>0){f=y[u].getElementsByTagName(STR_PORT)[0].childNodes[0].nodeValue}var h=0;x=y[u].getElementsByTagName(STR_HTTP_PORT)[0].childNodes;if(x.length>0){h=y[u].getElementsByTagName(STR_HTTP_PORT)[0].childNodes[0].nodeValue}var v=0;x=y[u].getElementsByTagName(STR_CTRL_PORT)[0].childNodes;if(x.length>0){v=y[u].getElementsByTagName(STR_CTRL_PORT)[0].childNodes[0].nodeValue}var r="";x=y[u].getElementsByTagName(STR_SN_ID)[0].childNodes;if(x.length>0){r=y[u].getElementsByTagName(STR_SN_ID)[0].childNodes[0].nodeValue}var c="";x=y[u].getElementsByTagName(STR_LOGIN_USER_NAME)[0].childNodes;if(x.length>0){c=y[u].getElementsByTagName(STR_LOGIN_USER_NAME)[0].childNodes[0].nodeValue}var g="";x=y[u].getElementsByTagName(STR_LOGIN_USER_PWD)[0].childNodes;if(x.length>0){g=y[u].getElementsByTagName(STR_LOGIN_USER_PWD)[0].childNodes[0].nodeValue}var o="";x=y[u].getElementsByTagName(STR_MANUFACTURER_ID)[0].childNodes;if(x.length>0){o=y[u].getElementsByTagName(STR_MANUFACTURER_ID)[0].childNodes[0].nodeValue}var j="";x=y[u].getElementsByTagName(STR_MANUFACTURER_NAME)[0].childNodes;if(x.length>0){j=y[u].getElementsByTagName(STR_MANUFACTURER_NAME)[0].childNodes[0].nodeValue}var w="";x=y[u].getElementsByTagName(STR_PRODUCT_MODEL)[0].childNodes;if(x.length>0){w=y[u].getElementsByTagName(STR_PRODUCT_MODEL)[0].childNodes[0].nodeValue}var e="";x=y[u].getElementsByTagName(STR_USE_DEFAULT_CFG)[0].childNodes;if(x.length>0){e=y[u].getElementsByTagName(STR_USE_DEFAULT_CFG)[0].childNodes[0].nodeValue}var s=0;x=y[u].getElementsByTagName(STR_IS_POE_DEVICE)[0].childNodes;if(x.length>0){s=y[u].getElementsByTagName(STR_IS_POE_DEVICE)[0].childNodes[0].nodeValue}g_deviceInfoArray[u]=new DeviceInfo(m,z,q,b,p,f,h,v,r,c,g,o,j,w,e,s)}}DisplayDevice()}else{return}}}function DelDeviceArray(){if(g_SelectRowIndex.length>0){g_SelectRowIndex.splice(0,g_SelectRowIndex.length)}if(g_deviceCopy.length>0){g_deviceCopy.splice(0,g_deviceCopy.length)}}function OnLoadCfgDevice(){DelDeviceArray();ApplyXmlLang("cfg_device.xml");var b=document.getElementById("div_config_body");if(!(g_authority.authority&32768)){g_curConfigIndex=-1;b.style.display="none";window.alert(str_no_auth);return false}var f=document.getElementById("table_device_manage");g_deviceListCtrl=CreateListCtrl(f,5,cfg_device_header,16);var a=document.getElementsByName("device_manufacturer")[0];g_deviceInfoArray=[];var g="<request>\r\n";g+='<command name="'+STR_REQUEST_CFG_ENTER_IPCAM+'">\r\n';g+="</command>\r\n";g+="</request>\r\n";var c=WebClient.ExcuteCmd(g);if(c==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(c);g_xmlDoc.async=false;var e=g_xmlDoc.documentElement.getElementsByTagName("command")[0];if(e.getAttribute("name")==STR_REPLY_CONFIG_FAIL){g_curConfigIndex=-1;b.style.display="none";window.alert(str_config_by_other);return false}else{GetConfigInfo();GetDeviceInfo()}for(var d=0;d<g_supportDevice.length;d++){var h=g_supportDevice[d].manufacturerName;if(g_bCBNUseLogo&&h=="TVT"){h="CNB-M"}g_device_manufacturer[d]=new CSelectOptionInfo(h,g_supportDevice[d].manufacturerId)}GenSelectListEx(a,g_device_manufacturer);OnChangeManufacturer();Align()}function DisplayDevice(){var e=document.getElementById("device_list_page");var f=/msie/i.test(navigator.userAgent);var d=g_deviceListCtrl.htmlObj.rows;g_deviceListCtrl.Clear();var c=DeviceList.Instance().curPage;if(f){if(g_deviceInfoArray.length==0){e.innerText="0 / 0"}else{e.innerText=(c+1)+" / "+Math.ceil(g_deviceInfoArray.length/16)}}else{if(g_deviceInfoArray.length==0){e.textContent="0 / 0"}else{e.textContent=(c+1)+" / "+Math.ceil(g_deviceInfoArray.length/16)}}for(var b=c*16;b<(c+1)*16;b++){var a=d[b-c*16+1].cells;if(b>=g_deviceInfoArray.length){break}if(f){if(g_deviceInfoArray[b].channel=="255"){a[0].innerText="None";a[4].innerText=str_disabled}else{a[0].innerText=parseInt(g_deviceInfoArray[b].channel,10)+1;if(g_deviceInfoArray[b].status=="0"){a[4].innerText=str_connect}else{a[4].innerText=str_disconnected}}a[1].innerText=g_deviceInfoArray[b].server;a[2].innerText=g_deviceInfoArray[b].manufacturerName;a[3].innerText=g_deviceInfoArray[b].productModel}else{if(g_deviceInfoArray[b].channel=="255"){a[0].textContent="None";a[4].textContent=str_disabled}else{a[0].textContent=parseInt(g_deviceInfoArray[b].channel)+1;if(g_deviceInfoArray[b].status=="0"){a[4].textContent=str_connect}else{a[4].textContent=str_disconnected}}a[1].textContent=g_deviceInfoArray[b].server;a[2].textContent=g_deviceInfoArray[b].manufacturerName;a[3].textContent=g_deviceInfoArray[b].productModel}}if(g_deviceInfoArray.length>=g_net_ch_num){device_add_button.disabled="disabled";device_add_button.style.color=btn_text_disabled_color;device_search_button.disabled="disabled";device_search_button.style.color=btn_text_disabled_color}else{device_add_button.disabled="";device_add_button.style.color=btn_text_normal_color;device_search_button.disabled="";device_search_button.style.color=btn_text_normal_color}}function SetDeviceInfo(){var o=/msie/i.test(navigator.userAgent);var g=0;var d=0;var q=0;var r=CreateConfigReqXml(rec_stream_config_array);var m=WebClient.ExcuteCmd(r);if(m==""){return}if(t!=null){delete t;t=null}t=FormatToXmlDOM(m);t.async=false;var f=t.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");var e=new Array(f.length);for(var l=0;l<f.length;l++){if(f[l].getAttribute("name")==STR_ENCODE_MAJOR_EX){if(o){e[l]=f[l].text}else{if(f[l].childNodes.length>0){e[l]=f[l].childNodes[0].nodeValue}else{e[l]=0}}}}for(var h=0;h<g_deviceInfoArray.length;h++){if(g_deviceInfoArray[h].channel!="255"){if(g_deviceInfoArray[h].useDefaultCfg==1){g+=q;d+=parseInt(g_ipc_support_encode.defaBitRate,10)}else{var s=e[g_deviceInfoArray[h].channel].split("+");if((s[0]==8)||(s[0]==128)){g+=s[1]}if(s[0]==32){g+=s[1]*3}if(s[0]==16){g+=s[1]*6}d+=parseInt(s[5],10)}}}if(!(g_ipc_support_encode.maxTotalRateOnVGA>=g)&&(g_ipc_support_encode.maxTotalBitRate>=d)){window.alert(save_error_tip);g_bChange=false;return}else{var o=/msie/i.test(navigator.userAgent);var p="<request>\r\n";p+='<command name="'+STR_REQUEST_SET_DEVICE_LOG+'">\r\n';for(var l=0;l<g_deviceInfoArray.length;l++){p+="<item>\r\n";p+="<"+STR_DEVICE_ID+">"+g_deviceInfoArray[l].deviceId+"</"+STR_DEVICE_ID+">\r\n";p+="<"+STR_CHANNEL+">"+g_deviceInfoArray[l].channel+"</"+STR_CHANNEL+">\r\n";p+="<"+STR_STATUS+">"+g_deviceInfoArray[l].status+"</"+STR_STATUS+">\r\n";p+="<"+STR_ETHER_NAME+">"+g_deviceInfoArray[l].etherName+"</"+STR_ETHER_NAME+">\r\n";p+="<"+STR_SERVER+">"+g_deviceInfoArray[l].server+"</"+STR_SERVER+">\r\n";p+="<"+STR_PORT+">"+g_deviceInfoArray[l].port+"</"+STR_PORT+">\r\n";p+="<"+STR_HTTP_PORT+">"+g_deviceInfoArray[l].httpPort+"</"+STR_HTTP_PORT+">\r\n";p+="<"+STR_CTRL_PORT+">"+g_deviceInfoArray[l].ctrlPort+"</"+STR_CTRL_PORT+">\r\n";p+="<"+STR_SN_ID+">"+g_deviceInfoArray[l].snId+"</"+STR_SN_ID+">\r\n";p+="<"+STR_LOGIN_USER_NAME+">"+g_deviceInfoArray[l].loginUserName+"</"+STR_LOGIN_USER_NAME+">\r\n";p+="<"+STR_LOGIN_USER_PWD+">"+g_deviceInfoArray[l].loginUserPwd+"</"+STR_LOGIN_USER_PWD+">\r\n";p+="<"+STR_MANUFACTURER_ID+">"+g_deviceInfoArray[l].manufacturerId+"</"+STR_MANUFACTURER_ID+">\r\n";p+="<"+STR_MANUFACTURER_NAME+">"+g_deviceInfoArray[l].manufacturerName+"</"+STR_MANUFACTURER_NAME+">\r\n";p+="<"+STR_PRODUCT_MODEL+">"+g_deviceInfoArray[l].productModel+"</"+STR_PRODUCT_MODEL+">\r\n";p+="<"+STR_USE_DEFAULT_CFG+">"+g_deviceInfoArray[l].useDefaultCfg+"</"+STR_USE_DEFAULT_CFG+">\r\n";p+="<"+STR_IS_POE_DEVICE+">"+g_deviceInfoArray[l].bPOEDevice+"</"+STR_IS_POE_DEVICE+">\r\n";p+="</item>\r\n"}p+="</command>\r\n";p+="</request>\r\n";var b=WebClient.ExcuteCmd(p);if(b==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(b);g_xmlDoc.async=false;if(b==""){SaveError(device_config_errortips,str_net_disconnected)}else{var t;t=FormatToXmlDOM(b);t.async=false;var a=t.documentElement.getElementsByTagName("command")[0];var c=a.getAttribute("name");if(STR_REPLY_SET_DEVICE_LOG_SUCC==c){SaveOk(device_config_errortips)}else{SaveError(device_config_errortips,save_error_tip)}delete t;for(var l=0;l<g_deviceInfoArray.length;l++){g_deviceInfoArray[l].useDefaultCfg=0}}}g_bChange=false;bDChanged=false}function OnChangeManufacturer(){IfHidePort(false)}function IfHidePort(f){var c=0;if(f){c=g_supportDevice[f].manufacturerId}else{var e=0;var b=document.getElementsByName("device_manufacturer")[0];for(var d=0;d<b.length;d++){if(b.options[d].selected){e=d;break}}c=b.options[e].value}for(var a=0;a<g_supportDevice.length;a++){if(g_supportDevice[a].manufacturerId==c){document.getElementById("ctrl_port_tr").style.display=parseInt((g_supportDevice[a].bCtrlPort),10)?"":"none";document.getElementById("http_port_tr").style.display=parseInt((g_supportDevice[a].bHttpPort),10)?"":"none"}}}function OnAddDevice(){var b=document.getElementById("div_config_index");var q=document.getElementById("device_info_pane");var f=document.getElementById("btn_group_device_add");var m=document.getElementById("btn_group_device_modify");var l=document.getElementById("device_config_errortips");var h=document.getElementById("search_pane");var e=document.getElementsByName("device_manufacturer")[0];if((q.style.display=="")&&(f.style.display=="")){return}l.innerHTML="";h.style.display="none";m.style.display="none";f.style.display="";q.style.display="";g_curSelectRowIndex=-1;CreateChannelList();for(var g=0;g<g_supportDevice.length;g++){var i=g_supportDevice[g].manufacturerName;if(g_bCBNUseLogo&&i=="TVT"){i="CNB-M"}g_device_manufacturer[g]=new CSelectOptionInfo(i,g_supportDevice[g].manufacturerId)}GenSelectListEx(e,g_device_manufacturer);document.getElementsByName("device_manufacturer")[0].disabled=false;document.getElementsByName("device_manufacturer")[0].style.backgroundColor="";document.getElementsByName("enable_device")[0].checked="false";if(document.getElementsByName("device_channel")[0].options[0]!=null){document.getElementsByName("device_channel")[0].value=document.getElementsByName("device_channel")[0].options[0].value}var e=document.getElementsByName("device_manufacturer")[0];if(e.options.length>0){document.getElementsByName("device_manufacturer")[0].value=document.getElementsByName("device_manufacturer")[0].options[0].value}var p=document.getElementsByName("device_ip")[0];var c=document.getElementById("device_server_port");var a=document.getElementById("device_http_port");var r=document.getElementsByName("device_username")[0];var d=document.getElementsByName("device_user_password")[0];var o=document.getElementById("device_ctrl_port");IfHidePort(false);c.disabled=false;c.value="9008";if(a.style.display==""){a.disabled=false;a.value="1"}if(o.style.display==""){o.disabled=false;o.value="1"}p.disabled=false;p.value="";r.disabled=false;r.value="admin";d.disabled=false;d.value="123456";Align();EdgeCtrl(b,72);location.href="#device_add_label"}function OnAddDevicerOK(){var a=document.getElementById("device_config_errortips");var e=document.getElementById("device_info_pane");if(document.getElementsByName("device_ip")[0].value.replace(/(^\s*)|(\s*$)/g,"")==""){SaveError(a,net_ip_empty_tip);location.href="#device_config_errortips";return}if(document.getElementsByName("device_username")[0].value.replace(/(^\s*)|(\s*$)/g,"")==""){SaveError(a,user_name_empty_tip);location.href="#device_config_errortips";return}if(document.getElementsByName("device_username")[0].value.sizeUTF8()>const_username_max_len){var i=user_name_constraint_tip+const_username_max_len+"!";SaveError(a,i);location.href="#device_config_errortips";return}var l=g_deviceInfoArray.length;if(l==g_supportMaxDeviceNum){window.alert(device_num_max_tip);return}if(!CalcResource()){window.alert(add_faild_tip);return}if(document.getElementsByName("enable_device")[0].checked){var j=document.getElementsByName("device_channel")[0].value}else{var j="255"}if(!CheckNetChannelEmpty(j)){return}var b=document.getElementsByName("device_manufacturer")[0].selectedIndex;var d=g_supportDevice[b].manufacturerName;var o=g_supportDevice[b].manufacturerId;var t=document.getElementsByName("device_ip")[0].value;var v=document.getElementById("device_server_port").value;var u=document.getElementsByName("device_username")[0].value;var h=document.getElementsByName("device_user_password")[0].value;var m="-1";var c="";var g="";var s="";var q="";var f=1;var r=0;var p="1";if(document.getElementById("device_http_port").style.display==""){g=document.getElementById("device_http_port").value}if(document.getElementById("device_ctrl_port").style.display==""){s=document.getElementById("device_ctrl_port").value}var l=g_deviceInfoArray.length;g_deviceInfoArray[l]=new DeviceInfo(m,j,p,c,t,v,g,s,q,u,h,o,d,"",f,r);bDChanged=true;a.innerHTML="";e.style.display="none";DisplayDevice();Align();EdgeCtrl(div_config_index,72)}function OnModifyDevice(){var h=document.getElementById("div_config_index");var d=document.getElementById("device_config_errortips");var j=document.getElementById("device_info_pane");var p=document.getElementById("search_pane");var g=document.getElementById("btn_group_device_add");var l=document.getElementById("btn_group_device_modify");var b=document.getElementById("device_cfg_label");var f=document.getElementsByName("device_manufacturer")[0];var r=document.getElementsByName("enable_device")[0];var o=document.getElementsByName("device_channel")[0];var t=document.getElementsByName("device_ip")[0];var v=document.getElementById("device_server_port");var u=document.getElementsByName("device_username")[0];var m=document.getElementsByName("device_user_password")[0];d.innerHTML="";if(g_SelectRowIndex.length==0){window.alert(device_select_tip);j.style.display="none";Align();EdgeCtrl(h,72);return}var q=g_SelectRowIndex[0];for(var s=0;s<g_SelectRowIndex.length;s++){if(q>g_SelectRowIndex[s]){q=g_SelectRowIndex[s]}}var e=q-1;g_curSelectRowIndex=q;e=e+DeviceList.Instance().curPage*16;j.style.display="";g.style.display="none";p.style.display="none";l.style.display="";r.disabled=false;t.disabled=false;v.disabled=false;f.disabled=true;f.style.backgroundColor="#D4E8FE";Align();EdgeCtrl(h,72);location.href="#device_add_label";CreateChannelList();var w=g_deviceInfoArray[e].channel;if(w=="255"){bChecked=false;r.checked=false;o.disabled=true;o.style.backgroundColor="#D4E8FE";w=o.options[0].value}else{bChecked=true;r.checked=true;BindingCh(r)}var c=new Array();c[0]=new CSelectOptionInfo(g_deviceInfoArray[e].manufacturerName,g_deviceInfoArray[e].manufacturerName);GenSelectListEx(f,c);o.value=w;f.value=g_deviceInfoArray[e].manufacturerName;t.value=g_deviceInfoArray[e].server;v.value=g_deviceInfoArray[e].port;u.value=g_deviceInfoArray[e].loginUserName;m.value=g_deviceInfoArray[e].loginUserPwd;var a=g_deviceInfoArray[e].manufacturerId;IfHidePort(a);if(document.getElementById("http_port_tr").style.display==""){document.getElementById("device_http_port").value=g_deviceInfoArray[e].httpPort}if(g_deviceInfoArray[e].bPOEDevice!=0){if(g_deviceInfoArray[e].manufacturerId==1){r.disabled=false;t.disabled=true;v.disabled=true;o.disabled=false;u.disabled=true;m.disabled=true}else{if(g_deviceInfoArray[e].manufacturerId==2){r.disabled=false;t.disabled=true;v.disabled=true;o.disabled=false;u.disabled=false;m.disabled=false}}}else{r.disabled=false;t.disabled=false;v.disabled=false;o.disabled=false;u.disabled=false;m.disabled=false}}function OnModifyDeviceOK(){var a=document.getElementById("div_config_index");var f=document.getElementById("device_config_errortips");var l=document.getElementById("device_info_pane");var e=document.getElementById("search_pane");var d=document.getElementById("btn_group_device_add");var h=document.getElementById("btn_group_device_modify");var g=g_deviceListCtrl.GetCurSel();g=DeviceList.Instance().curPage*16+g;if(document.getElementsByName("device_ip")[0].value.replace(/(^\s*)|(\s*$)/g,"")==""){SaveError(f,net_ip_empty_tip);location.href="#device_config_errortips";return}if(document.getElementsByName("device_username")[0].value.replace(/(^\s*)|(\s*$)/g,"")==""){SaveError(f,user_name_empty_tip);location.href="#device_config_errortips";return}if(document.getElementsByName("device_username")[0].value.sizeUTF8()>const_username_max_len){var m=user_name_constraint_tip+const_username_max_len+"!";SaveError(f,m);location.href="#device_config_errortips";return}if(document.getElementsByName("enable_device")[0].checked){if(!bChecked){if(!CalcResource()){window.alert(modify_faild_tip);return}}var i=document.getElementsByName("device_channel")[0].value}else{var i="255"}var j=document.getElementsByName("device_ip")[0].value;var b=document.getElementById("device_server_port").value;var o=document.getElementsByName("device_username")[0].value;var c=document.getElementsByName("device_user_password")[0].value;g_deviceInfoArray[g].channel=i;g_deviceInfoArray[g].server=j;g_deviceInfoArray[g].port=b;g_deviceInfoArray[g].loginUserName=o;g_deviceInfoArray[g].loginUserPwd=c;g_deviceInfoArray[g].useDefaultCfg=1;if(document.getElementById("device_http_port").style.display==""){g_deviceInfoArray[g].httpPort=document.getElementById("device_http_port").value}if(document.getElementById("device_ctrl_port").style.display==""){g_deviceInfoArray[g].ctrlPort=document.getElementById("device_ctrl_port").value}bDChanged=true;DisplayDevice();l.style.display="none";f.innerHTML="";Align();EdgeCtrl(a,72);DelDeviceArray()}function OnDeviceCancel(){var d=/msie/i.test(navigator.userAgent);var c=document.getElementById("device_config_errortips");var a=document.getElementById("device_info_pane");var b=document.getElementById("div_config_index");if(d){c.innerText=""}else{c.textContent=""}a.style.display="none";Align();EdgeCtrl(b,72)}function OnDelDevice(){var f=document.getElementById("div_config_index");var h=document.getElementById("device_config_errortips");var a=document.getElementById("table_user");var e=document.getElementById("modify_password");h.innerHTML="";var b=g_SelectRowIndex.length;if(b==0){window.alert(device_select_tip);search_pane.style.display="none";OnDeviceCancel();return}if(confirm(delete_user_confirm)){for(var c=0;c<g_SelectRowIndex.length;c++){var g=g_SelectRowIndex[c]-1+DeviceList.Instance().curPage*16;g_deviceCopy[c]=g_deviceInfoArray[g].server}while(b>0){for(var d=0;d<g_deviceInfoArray.length;d++){if((g_deviceInfoArray[d].server==g_deviceCopy[b-1])&&(g_deviceInfoArray[d].bPOEDevice==0)){g_deviceInfoArray.splice(d,1);break}}if((g_deviceInfoArray.length<=DeviceList.Instance().curPage*16)&&(g_deviceInfoArray.length!=0)){DeviceList.Instance().curPage--}b--}bDChanged=true;DisplayDevice();Align();DelDeviceArray();if((device_info_pane.style.display!="none")&&(btn_group_device_modify.style.display!="none")){OnDeviceCancel();return}}}function OnDelAllDevice(){var c=document.getElementById("div_config_index");var d=document.getElementById("device_config_errortips");var a=document.getElementById("table_user");var b=document.getElementById("modify_password");var e=document.getElementById("device_list_page");d.innerHTML="";curSel=g_deviceInfoArray.length-1;if(curSel==-1){search_pane.style.display="none";OnDeviceCancel();return}if(g_deviceInfoArray.length==0){return}if(confirm(delete_user_confirm)){while(curSel>-1){if(g_deviceInfoArray[curSel].bPOEDevice!=0){curSel--;continue}g_deviceInfoArray.splice(curSel,1);if((g_deviceInfoArray.length<=DeviceList.Instance().curPage*16)&&(g_deviceInfoArray.length!=0)){DeviceList.Instance().curPage--}curSel--}DelDeviceArray();if((device_info_pane.style.display!="none")&&(btn_group_device_modify.style.display!="none")){OnDeviceCancel()}bDChanged=true;DisplayDevice();Align()}}function OnSearchDevice(){var l=/msie/i.test(navigator.userAgent);var g=document.getElementById("div_config_index");var r=document.getElementById("search_pane");var b=document.getElementById("device_config_errortips");var h=document.getElementById("device_info_pane");var d=document.getElementById("search_device_list");var B=document.getElementById("search_device_list_page");var v=document.getElementsByName("device_item");var A=document.getElementById("device_checkall");var e=false;g_searchDevice.length=0;g_curSearchPageIndex=0;A.checked=false;h.style.display="none";b.innerHTML="";r.style.display="";var q="<request>\r\n";q+='<command name="'+STR_REQUEST_DEVICE_SEARCH+'">\r\n';q+="</command>\r\n";q+="</request>\r\n";StartWait();var x=WebClient.ExcuteCmd(q);if(x==""){StopWait();return}if(xmlDoc!=null){delete xmlDoc;xmlDoc=null}xmlDoc=FormatToXmlDOM(x);xmlDoc.async=false;g_DeviceSelItem=new Array();var a=xmlDoc.documentElement.getElementsByTagName("command")[0];if(a.getAttribute("name")==STR_REPLY_DEVICE_SEARCH){var C=a.getElementsByTagName("item");var f=0;for(var z=0;z<C.length;z++){var t;if(!l){t=C[z].getElementsByTagName(STR_SERVER)[0].childNodes[0].nodeValue}else{t=C[z].getElementsByTagName(STR_SERVER)[0].text}for(var w=0;w<g_deviceInfoArray.length;w++){if(t==g_deviceInfoArray[w].server){e=true;break}}if(e){e=false;continue}if(l){var m=C[z].getElementsByTagName(STR_PORT)[0].text;var o=C[z].getElementsByTagName(STR_HTTP_PORT)[0].text;var y=C[z].getElementsByTagName(STR_CTRL_PORT)[0].text;var u=C[z].getElementsByTagName(STR_SN_ID)[0].text;var s=C[z].getElementsByTagName(STR_MANUFACTURER_ID)[0].text;var p=C[z].getElementsByTagName(STR_MANUFACTURER_NAME)[0].text;if(g_bCBNUseLogo&&p=="TVT"){p="CNB-M"}var c=C[z].getElementsByTagName(STR_PRODUCT_MODEL)[0].text;g_searchDevice[f]=new SearchDeviceInfo(t,m,o,y,u,s,p,c);g_DeviceSelItem[f]=false}else{var m=C[z].getElementsByTagName(STR_PORT)[0].childNodes[0].nodeValue;var o=C[z].getElementsByTagName(STR_HTTP_PORT)[0].childNodes[0].nodeValue;var y=C[z].getElementsByTagName(STR_CTRL_PORT)[0].childNodes[0].nodeValue;var u=C[z].getElementsByTagName(STR_SN_ID)[0].childNodes[0].nodeValue;var s=C[z].getElementsByTagName(STR_MANUFACTURER_ID)[0].childNodes[0].nodeValue;var p="";if(C[z].getElementsByTagName(STR_MANUFACTURER_NAME)[0].childNodes.length>0){p=C[z].getElementsByTagName(STR_MANUFACTURER_NAME)[0].childNodes[0].nodeValue}if(g_bCBNUseLogo&&p=="TVT"){p="CNB-M"}var c="";if(C[z].getElementsByTagName(STR_PRODUCT_MODEL)[0].childNodes.length>0){c=C[z].getElementsByTagName(STR_PRODUCT_MODEL)[0].childNodes[0].nodeValue}g_searchDevice[f]=new SearchDeviceInfo(t,m,o,y,u,s,p,c);g_DeviceSelItem[f]=false}f++}}StopWait();ShowSearchDeviceList(0);Align();EdgeCtrl(g,72);location.href="#device_add_label"}function DeviceM_SelectAll(){var b=document.getElementById("device_checkall");if(g_DeviceSelItem==null){return}if(b.checked){for(var a=0;a<g_DeviceSelItem.length;a++){g_DeviceSelItem[a]=true}}else{for(var a=0;a<g_DeviceSelItem.length;a++){g_DeviceSelItem[a]=false}}ShowSearchDeviceList(g_curSearchPageIndex)}function ShowSearchDeviceList(a){var f=/msie/i.test(navigator.userAgent);var c=document.getElementById("search_device_list");var e=document.getElementById("search_device_list_page");var d=document.getElementsByName("device_item");if(g_searchDevice.length<=0){for(itemIdx=1;itemIdx<c.rows.length;itemIdx++){var b=c.rows[itemIdx].cells;d[itemIdx-1].style.display="none";if(f){b[1].innerText=" ";b[2].innerText=" ";b[3].innerText=" ";b[4].innerText=" "}else{b[1].textContent=" ";b[2].textContent=" ";b[3].textContent=" ";b[4].textContent=" "}}return false}if(g_searchDevice.length<=a*6){return false}for(itemIdx=a*6;itemIdx<(a+1)*6;itemIdx++){var b=c.rows[itemIdx-a*6+1].cells;if(itemIdx>=g_searchDevice.length){d[itemIdx%6].style.display="none";if(f){b[1].innerText=" ";b[2].innerText=" ";b[3].innerText=" ";b[4].innerText=" "}else{b[1].textContent=" ";b[2].textContent=" ";b[3].textContent=" ";b[4].textContent=" "}}else{d[itemIdx%6].style.display="";if(f){b[1].innerText=g_searchDevice[itemIdx].manufacturerName;b[2].innerText=g_searchDevice[itemIdx].product_model;b[3].innerText=g_searchDevice[itemIdx].server;b[4].innerText=g_searchDevice[itemIdx].port}else{b[1].textContent=g_searchDevice[itemIdx].manufacturerName;b[2].textContent=g_searchDevice[itemIdx].product_model;b[3].textContent=g_searchDevice[itemIdx].server;b[4].textContent=g_searchDevice[itemIdx].port}d[itemIdx%6].checked=g_DeviceSelItem[itemIdx];e.innerHTML=a+1+"/"+Math.ceil(g_searchDevice.length/6)}}return true}function UpdateSelDevice(){var b=document.getElementsByName("device_item");for(var a=0;a<6;a++){if(a+g_curSearchPageIndex*6<g_DeviceSelItem.length){g_DeviceSelItem[a+g_curSearchPageIndex*6]=b[a].checked}}}function CheckNetChannelEmpty(b){var c=false;for(var a=0;a<g_deviceInfoArray.length;a++){if(g_deviceInfoArray[a].channel==b){c=true;break}}return !c}function FindEmptyNetChannelIndex(){var b=255;var d=0;for(var c=0;c<g_deviceInfoArray.length;c++){if(255==g_deviceInfoArray[c].channel){d++}}for(var e=g_local_ch_num;e<g_local_ch_num+g_net_ch_num-d;e++){var a=false;for(var c=0;c<g_deviceInfoArray.length;c++){if(e==g_deviceInfoArray[c].channel){a=true;break}}if(a==false){b=e;return b}}return b}function OnSearchDeviceOK(){var c=document.getElementById("div_config_index");var j=document.getElementById("search_pane");var r=0;UpdateSelDevice();for(var t=0;t<g_DeviceSelItem.length;t++){if(g_DeviceSelItem[t]){var l="-1";var w=FindEmptyNetChannelIndex();if(w==255){continue}if(!CalcResource()){window.alert(add_faild_tip);if(r==0){return}else{break}}var p="1";var a="";var o=g_searchDevice[t].server;var e=g_searchDevice[t].port;var g=g_searchDevice[t].httpPort;var u=g_searchDevice[t].ctrlPort;var q=g_searchDevice[t].snId;var b="admin";var f="123456";var m=g_searchDevice[t].manufacturerId;var h=g_searchDevice[t].manufacturerName;var v=g_searchDevice[t].product_model;var d=1;var s=0;g_deviceInfoArray[g_deviceInfoArray.length]=new DeviceInfo(l,w,p,a,o,e,g,u,q,b,f,m,h,v,d,s);r++}}if(r==0){window.alert(device_select_tip);return}bDChanged=true;DisplayDevice();j.style.display="none";Align();EdgeCtrl(c,72);DelDeviceArray()}function OnDeviceSearchCancel(){var a=document.getElementById("search_pane");a.style.display="none";Align();EdgeCtrl(div_config_index,72)}function DeviceGotoLastPage(){UpdateSelDevice();g_curSearchPageIndex=Math.ceil(g_searchDevice.length/6)-1;ShowSearchDeviceList(g_curSearchPageIndex)}function DeviceGotoNextPage(){if((g_curSearchPageIndex+1)*6<g_searchDevice.length){UpdateSelDevice();g_curSearchPageIndex+=1;ShowSearchDeviceList(g_curSearchPageIndex)}}function DeviceGotoPrevPage(){if(g_curSearchPageIndex==0){return}UpdateSelDevice();g_curSearchPageIndex-=1;ShowSearchDeviceList(g_curSearchPageIndex)}function DeviceGotoFirstPage(){UpdateSelDevice();g_curSearchPageIndex=0;ShowSearchDeviceList(0)}function DeviceList(){this.curPage=0;this.userCount=0}DeviceList.prototype={FirstPage:function(){if(this.curPage==0){return}DelDeviceArray();this.curPage=0;DisplayDevice()},NextPage:function(){if((this.curPage+1)*16>=g_deviceInfoArray.length){return}DelDeviceArray();this.curPage++;DisplayDevice()},PrevPage:function(){DelDeviceArray();if(this.curPage>0){this.curPage--;DisplayDevice()}},LastPage:function(){var a=Math.ceil(g_deviceInfoArray.length/16)-1;if(a==this.curPage){return}DelDeviceArray();this.curPage=a;DisplayDevice()}};DeviceList.instance=null;DeviceList.Instance=function(){if(DeviceList.instance==null){DeviceList.instance=new DeviceList}return DeviceList.instance};function CalcResource(){var l=/msie/i.test(navigator.userAgent);var e=0;var b=0;var m=0;if((g_ipc_support_encode.defaResolution=="128")||(g_ipc_support_encode.defaResolution=="8")){m=g_ipc_support_encode.defaChnnRate*1}if(g_ipc_support_encode.defaResolution=="32"){m=g_ipc_support_encode.defaChnnRate*3}if(g_ipc_support_encode.defaResolution=="16"){m=g_ipc_support_encode.defaChnnRate*6}var o=CreateConfigReqXml(rec_stream_config_array);var h=WebClient.ExcuteCmd(o);if(h==""){return}if(xmlDoc!=null){delete xmlDoc;xmlDoc=null}xmlDoc=FormatToXmlDOM(h);xmlDoc.async=false;var d=xmlDoc.documentElement.getElementsByTagName("command")[0].getElementsByTagName("parameter");var c=new Array(d.length);for(var g=0;g<d.length;g++){if(d[g].getAttribute("name")==STR_ENCODE_MAJOR_EX){if(l){c[g]=d[g].text}else{var a=d[g].childNodes;if(a.length>0){c[g]=d[g].childNodes[0].nodeValue}else{c[g]=0}}}}for(var f=0;f<g_deviceInfoArray.length;f++){if(g_deviceInfoArray[f].channel!="255"){if(g_deviceInfoArray[f].useDefaultCfg==1){e+=m;b+=parseInt(g_ipc_support_encode.defaBitRate,10)}else{var p=c[g_deviceInfoArray[f].channel].split("+");if((p[0]==8)||(p[0]==128)){e+=p[1]*1}if(p[0]==32){e+=p[1]*3}if(p[0]==16){e+=p[1]*6}if(p[0]==2048){e+=p[1]*8}b+=parseInt(p[5],10)}}}if(((g_ipc_support_encode.maxTotalRateOnVGA-e)>=m)&&((g_ipc_support_encode.maxTotalBitRate-b)>=g_ipc_support_encode.defaBitRate)){return true}else{return false}}function BindingCh(a){var b=document.getElementsByName("device_channel");if(a.checked){b[0].disabled=false;b[0].style.backgroundColor=""}else{b[0].disabled=true;b[0].style.backgroundColor="#D4E8FE"}}function CreateChannelList(){var e=0;var g=-1;if(g_curSelectRowIndex!=-1){g=g_deviceListCtrl.GetCurSel()+DeviceList.Instance().curPage*16}var a=new Array(g_net_ch_num);var h=document.getElementsByName("device_channel");for(k=0;k<g_net_ch_num;k++){a[k]=0}for(var b=0;b<g_deviceInfoArray.length;b++){if((g=="-1")||(btn_group_device_add.style.display=="")){if(g_deviceInfoArray[b].channel!="255"){a[parseInt(g_deviceInfoArray[b].channel,10)-g_local_ch_num]=1}}else{if((g_deviceInfoArray[b].channel!="255")&&(g_deviceInfoArray[g].channel!=g_deviceInfoArray[b].channel)){a[parseInt(g_deviceInfoArray[b].channel,10)-g_local_ch_num]=1}}}g_device_channel=new Array();for(n=g_local_ch_num;n<g_local_ch_num+g_net_ch_num;n++){var f=false;for(var c=0;c<g_deviceInfoArray.length;c++){if(g_deviceInfoArray[c].channel==n){f=true;break}}if(a[n-g_local_ch_num]==0||!f){g_device_channel[e]=new CSelectOptionInfo(n+1,n);e++}}if((g>-1)&&(g_deviceInfoArray[g]&&g_deviceInfoArray[g].bPOEDevice!=0)){if(const_poe_num>0){if(const_poe_num==g_net_ch_num){GenSelectListEx(h[0],g_device_channel)}else{var l=new Array();l=g_device_channel.slice(0);for(var d=0;d<l.length;d++){if((l[d].optionValue+1)>const_poe_num*1){l.splice(d,l.length-d);GenSelectListEx(h[0],l);break}}if(d==l.length){GenSelectListEx(h[0],l)}}}}else{GenSelectListEx(h[0],g_device_channel)}}function OnClick_table_device_manage_Item(d){g_curSelectRowIndex=-1;var b=document.getElementById("device_info_pane");var e=document.getElementById("btn_group_device_modify");var f=document.getElementById("device_del_button");var c=document.getElementById("device_modify_button");OnClickItem(d);var a=g_deviceListCtrl.GetCurSel();if(a!=-1){a=a+DeviceList.Instance().curPage*16;if((g_deviceInfoArray[a].bPOEDevice!=0)){if(g_deviceInfoArray[a].manufacturerId==1){}else{}}else{f.disabled="";c.disabled="";f.style.color=btn_text_normal_color;c.style.color=btn_text_normal_color}}if((b.style.display!="none")&&(e.style.display!="none")){if(g_deviceListCtrl.GetCurSel()==-1){OnDeviceCancel();return}if(e.style.display==""){OnModifyDevice()}}};