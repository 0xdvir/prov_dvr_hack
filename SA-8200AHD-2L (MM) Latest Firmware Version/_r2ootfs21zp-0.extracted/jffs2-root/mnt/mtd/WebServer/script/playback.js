var g_curListPageIndex=0;var g_recEventTypes=new Array(str_manual,str_schedule,str_motion,str_sensor);var g_getPbTimeHandle=0;var g_recDataMonthInfo=0;var g_recDataTimeSec=new Array(0);var g_recEventInfo=new Array(0);var g_recFileInfo=new Array(0);var g_recDataManPage=0;var g_curDivisionMode=0;var g_curDivisionIndex=-1;var g_curSelChannel=new Array();var g_fileSelItem=new Array();function FileIsLocked(a){return !!(2147483648&a)}function FileIsReadonly(a){return !!(1073741824&a)}function FileIsWriting(a){return !!(536870912&a)}function FileIsReading(a){return !!(268435456&a)}function FileIsUnofficial(a){return !!(134217728&a)}function GotoSearchPage(){if(g_mainMenuItem==3){HintSave(-1)}g_mainMenuItem=1;g_lastNav=null;selected(g_mainMenuItem);HideDIVs();document.getElementById("div_main_menu").style.display="";document.getElementById("div_search_body").style.display="";g_lastNav="";g_lastNavSec="";g_xmlhttp.open("get","body_html/body_search.html",false);StartWait();SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState==4){OnReceiveSearch()}g_recDataManPage=0}function OnReceiveSearch(){if(g_xmlhttp.readyState!=4){return}document.getElementById("div_search_body").innerHTML=g_xmlhttp.responseText;ApplyXmlLang("search_nav.xml");ApplyXmlLang("time_search.xml");var a=new Array("ctrl_calendar.js","ctrl_rec_time.js","ctrl_time.js","ctrl_list.js","ctrl_generator.js");var b=document.getElementById("timesearch_nav");LoadMultiJS(a,OnLoadSearchPage);searchNavS(b)}function OnLoadSearchPage(){var o=document.getElementById("file_manager_channel");var y=document.getElementById("timesearch_sdate_span");var l=document.getElementById("timesearch_stime_span");var e=document.getElementById("play_channel_table3");var f=document.getElementById("play_channel_table2");var g=document.getElementById("play_channel_table1");var p=document.getElementById("play_channel_table");var u=document.getElementById("time_search_hour");var a=document.getElementById("div_file_list");var r=document.getElementById("div_event_condition");var f=document.getElementById("play_channel_table2");var g=document.getElementById("play_channel_table1");var p=document.getElementById("play_channel_table");var u=document.getElementById("time_search_hour");var D=document.getElementById("div_Division");var k=document.getElementById("div_search_start");var v=document.getElementById("search_event_list_page");var B=document.getElementById("time_search_list_page");var m=document.getElementById("search_calendar");var d=document.getElementById("search_middle_div");var x=document.getElementById("div_search_nav");if(g_TotalChannelList.length>16){var A=document.getElementById("time_search_page_set");g_CurPage=0;A.style.display="";D.style.height="";D.style.height="240px";B.innerHTML=g_CurPage+1+"/"+Math.ceil(g_TotalChannelList.length/8)}GenCheckGroup(o,false,g_TotalChannelList,"channel_index");var b=new DateTicker("timesearch_start_dateticker");y.innerHTML=b;y.dateName="timesearch_start_dateticker";var n=new DateBox("timesearch_time",false,true);l.innerHTML=n;l.dateName="timesearch_time";e.style.width="44px";if(g_output_channel_num<16){e.style.display="none";f.style.width="44px"}if(g_output_channel_num<8){f.style.display="none";g.style.width="44px"}if(g_output_channel_num<4){g.style.display="none"}GenPlayChannelChart(p,"play_group","play_channel");var z=new Date();z=z.getFullYear()+"-"+AlignTime(z.getMonth()+1)+"-"+AlignTime(z.getDate());DateTicker.all[y.dateName].setValue(z);if(g_TotalChannelList.length>16){RecDataTimeShow_Channel(u,str_ch,1,8)}else{RecDataTimeShow(u,str_ch)}RequestMonthCalInfo();g_calendarRecData.OnChangeMonth=function(E,F){g_calendarRecData.dayStates=0;for(day=0;day<g_recDataMonthInfo.length;day++){if((g_recDataMonthInfo[day].year==E)&&(g_recDataMonthInfo[day].month==F)){g_calendarRecData.dayStates|=(1<<(g_recDataMonthInfo[day].day-1))}}};g_calendarRecData.OnSelDate=function(E){var F=this.GetDate(true);DateTicker.all[y.dateName].setValue(F);if(g_recDataManPage==0){ShowRecTimeInfo()}};g_calendarRecData.Create(m);g_calendarRecData.SetDate(z,true);a.display="none";r.display="none";var c=document.getElementsByName("play_channel");var h=document.getElementsByName("channel_index");for(var t=0;t<h.length;t++){if((g_authority.authority&8)&&((1<<t)&g_authority.authPlayback)){h[t].disabled=false;c[t].disabled=false}else{h[t].disabled=true;c[t].disabled=true}}for(var t=0;t<h.length;t++){if(!h[t].disabled){h[t].checked=true}}UpdateCheckItems(o);OnSelDivision(p,0,1);document.getElementById("search_middle_div").style.height="560px";var C=(d.offsetHeight-2>560)?d.offsetHeight-2:560;document.getElementById("div_search_nav").style.height=C+"px";C=x.offsetHeight-12;document.getElementById("search_right_div").style.height=C+"px";var s=C+40;document.getElementById("div_search_body").style.height=s+"px";var q=/msie/i.test(navigator.userAgent);if(!q){var w=s+60;document.getElementById("work_area").style.height=w+"px"}EdgeCtrl(x,72);StopWait()}function GotoPBPage(){var c=document.getElementById("div_search_body");var g=document.getElementById("div_ocx");var m=document.getElementById("div_playback");c.style.display="none";WebClient.SetVisible(2);g.style.display="";WebClient.style.display="";m.style.display="";var h=document.getElementById("div_main_menu").offsetLeft+5;document.getElementById("div_ocx").style.left=h+"px";var r=document.getElementById("div_main_menu").offsetTop+document.getElementById("div_main_menu").offsetHeight;document.getElementById("div_ocx").style.top=r+"px";document.getElementById("div_ocx").style.width="";document.getElementById("div_ocx").style.width="720px";WebClient.style.width="";WebClient.style.width="720px";g_xmlhttp.open("get","body_html/body_playback.html",false);g_xmlhttp.onreadystatechange=function(){};SafeHttpSend(g_xmlhttp,null);if(g_xmlhttp.readyState!=4){return}m.innerHTML=g_xmlhttp.responseText;var o=document.getElementById("play_channel_table_23");var p=document.getElementById("play_channel_table_22");var s=document.getElementById("play_channel_table_21");var a=document.getElementById("play_channel_table_2");GenPlayChannelChart(a,"play_group_2","play_channel_2");o.style.width="44px";if(g_output_channel_num<16){o.style.display="none";p.style.width="44px"}if(g_output_channel_num<8){p.style.display="none";s.style.width="44px"}if(g_output_channel_num<4){s.style.display="none"}var e=document.getElementsByName("play_channel_2");var k=document.getElementsByName("channel_index");for(var v=0;v<k.length;v++){if((g_authority.authority&8)&&((1<<v)&g_authority.authPlayback)){e[v].disabled=false}else{e[v].disabled=true}}OnSelDivision(a,g_curDivisionIndex,g_curDivisionMode);var b=new DateTicker("play_start_dateticker");var t=document.getElementById("play_start_date_span");t.innerHTML=b;t.dateName="play_start_dateticker";var y=document.getElementById("timesearch_sdate_span");var z=DateTicker.all[y.dateName].getValue();b.setValue(z);var n=new DateBox("play_start_time",false,true);var d=document.getElementById("play_start_time_span");d.innerHTML=n;d.dateName="play_start_time";var l=document.getElementById("timesearch_stime_span");var f=DateBox.all[l.dateName].getValue();n.setValue(f.split(":"));ApplyXmlLang("playback.xml");EdgeCtrl(g,32);if(document.getElementById("div_ocx").offsetHeight>document.getElementById("div_playback").offsetHeight){var u=document.getElementById("div_ocx").offsetHeight+5;document.getElementById("div_playback").style.height="";document.getElementById("div_playback").style.height=u+"px";WebClient.style.height=u+"px";var q=/msie/i.test(navigator.userAgent);if(!q){var x=u+50;document.getElementById("work_area").style.height=x+"px"}}else{var w=document.getElementById("div_playback").offsetHeight-5;document.getElementById("div_ocx").style.height="";document.getElementById("div_ocx").style.height=w+"px";WebClient.style.height=w+"px";var q=/msie/i.test(navigator.userAgent);if(!q){var x=w+50;document.getElementById("work_area").style.height=x+"px"}}}function LeavePBPage(){var f=document.getElementById("div_search_body");var a=document.getElementById("div_ocx");var d=document.getElementById("div_playback");var e=document.getElementById("play_channel_table");var g=document.getElementById("div_search_nav");ExitPlayback();WebClient.SetVisible(0);a.style.width="0px";a.style.height="0px";WebClient.style.width="0px";WebClient.style.height="0px";d.style.display="none";f.style.display="";var c=/msie/i.test(navigator.userAgent);if(!c){var b=f.offsetHeight+40;document.getElementById("work_area").style.height=b+"px"}OnSelDivision(e,g_curDivisionIndex,g_curDivisionMode);EdgeCtrl(g,72)}function RecDataTimeSec(c,b,a){this.channel=c;this.startTime=b;this.endTime=a}function RecLogInfo(e,d,b,c,a,f){this.channel=e;this.startTime=d;this.endTime=b;this.type=c;this.diskIndex=a;this.fileIndex=f}function GenReqDataInfoXML(g,h,b,e,k,c){var d=1;var f=h;var a="<request>\r\n";a+='<command name="'+STR_REQUEST_DATA_SEARCH+'">\r\n';a+='<parameter name="'+STR_SEARCH_TYPE+'">'+g+"</parameter>\r\n";a+='<parameter name="'+STR_STREAM_ID+'">'+d+"</parameter>\r\n";a+='<parameter name="'+STR_VIDEO_CHANNELS+'">'+h+"</parameter>\r\n";a+='<parameter name="'+STR_AUDIO_CHANNELS+'">'+f+"</parameter>\r\n";a+='<parameter name="'+STR_START_TIME+'">'+b+"</parameter>\r\n";a+='<parameter name="'+STR_END_TIME+'">'+e+"</parameter>\r\n";a+='<parameter name="'+STR_DATA_TYPE+'">'+k+"</parameter>\r\n";a+='<parameter name="'+STR_RECORD_TYPE_MASK+'">'+c+"</parameter>\r\n";return a}function RequestMonthCalInfo(){var c=new Array(64);for(i=0;i<64;i++){c[i]="1"}var b=GenReqDataInfoXML(0,c.join(""),"2009-07-29 00:00:00","2009-07-29 23:59:59",0,15);var f=WebClient.ExcuteCmd(b);if(f==""){return false}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(f);g_xmlDoc.async=false;var e=g_xmlDoc.documentElement.getElementsByTagName("command");if(e.length==0){return false}if(e[0].attributes.getNamedItem("name").nodeValue!=STR_REPLY_SEARCH_YEAR){return false}var a=e[0].getElementsByTagName("item");g_recDataMonthInfo=new Array(a.length);for(var d=0;d<a.length;d++){year=a[d].getElementsByTagName(STR_YEAR)[0].childNodes[0].nodeValue;month=a[d].getElementsByTagName(STR_MONTH)[0].childNodes[0].nodeValue;day=a[d].getElementsByTagName(STR_DAY)[0].childNodes[0].nodeValue;g_recDataMonthInfo[d]=new DateStruct(year,month,day)}}function RequestRecTimeInfo(){var f=document.getElementsByName("channel_index");var n=false;var o=new Array(64);for(g=0;g<64;g++){o[g]="0"}for(g=0;g<f.length;g++){if(f[g].checked){o[g]="1";n=true}}if(!n){window.alert(select_channel_tip);return}var d=g_calendarRecData.GetDate(true);var a=GenReqDataInfoXML(1,o.join(""),d+" 00:00:00",d+" 23:59:59",0,15);var m=WebClient.ExcuteCmd(a);if(m==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(m);g_xmlDoc.async=false;g_recDataTimeSec=new Array();d=g_calendarRecData.GetDate(false);var p=new Date(d.year,d.month,d.day,0,0,0);p=p.getTime()/1000;var e=new Date(d.year,d.month,d.day,23,59,59);e=e.getTime()/1000;var c=g_xmlDoc.documentElement.getElementsByTagName("command");if(c.length==0){return false}if(c[0].attributes.getNamedItem("name").nodeValue!=STR_REPLY_SEARCH_TIME){return false}var h=c[0].getElementsByTagName("time_section");for(var g=0;g<h.length;g++){var l=h[g].getElementsByTagName(STR_CHANNEL)[0].childNodes[0].nodeValue;var b=h[g].getElementsByTagName(STR_START_TIME)[0].childNodes[0].nodeValue;var k=h[g].getElementsByTagName(STR_END_TIME)[0].childNodes[0].nodeValue;b=Math.max(parseInt(b,10),p);k=Math.min(parseInt(k,10),e);g_recDataTimeSec[g_recDataTimeSec.length]=new RecDataTimeSec(l,b,k)}ShowRecTimeInfo()}function RequestRecEventInfo(q){var e=document.getElementsByName("channel_index");var g=document.getElementById("event_type_motion");var m=document.getElementById("event_type_sensor");var b=document.getElementById("event_all");g_curListPageIndex=0;g_recEventInfo=new Array();var l;var t=new Array(64);for(n=0;n<64;n++){t[n]="0"}for(n=0;n<e.length;n++){if(e[n].checked){t[n]="1";l=true}}if(!l){window.alert(select_channel_tip);ShowEventList(g_curListPageIndex);return}var f=0;if(g.checked){f|=parseInt(g.value,10)}if(!g_supportFunctions.IsNotSupportAlarm()||(g_net_ch_num!=0)){if(m.checked){f|=parseInt(m.value,10)}}if(b.checked){f|=parseInt(b.value,10)}if(f==0){ShowEventList(g_curListPageIndex);window.alert(str_no_data_tip);return}var o=g_calendarRecData.GetDate(true);var s=o+" 00:00:00";var h=o+" 23:59:59";var r=GenReqDataInfoXML(2,t.join(""),s,h,0,f);var c=WebClient.ExcuteCmd(r);if(c==""){ShowEventList(g_curListPageIndex);return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(c);g_xmlDoc.async=false;var p=g_xmlDoc.documentElement.getElementsByTagName("command");if(p.length==0){ShowEventList(g_curListPageIndex);window.alert(str_no_data_tip);return false}if(p[0].attributes.getNamedItem("name").nodeValue!=STR_REPLY_SEARCH_EVENT){ShowEventList(g_curListPageIndex);window.alert(str_no_data_tip);return false}var v=p[0].getElementsByTagName("item");if(v.length<=0){ShowEventList(g_curListPageIndex);window.alert(str_no_data_tip);return false}for(var n=0;n<v.length;n++){var u=v[n].getElementsByTagName(STR_CHANNEL)[0].childNodes[0].nodeValue;var k=v[n].getElementsByTagName(STR_START_TIME)[0].childNodes[0].nodeValue;k=(k>s)?k:s;var a=v[n].getElementsByTagName(STR_END_TIME)[0].childNodes[0].nodeValue;a=(a<h)?a:h;var d=v[n].getElementsByTagName(STR_EVENT_TYPE)[0].childNodes[0].nodeValue;g_recEventInfo[n]=new RecLogInfo(u,k,a,d)}ShowEventList(g_curListPageIndex)}function RequestRecFileInfo(n){var d=document.getElementsByName("channel_index");g_curListPageIndex=0;g_recFileInfo=new Array();g_fileSelItem=new Array();var g=false;var r=new Array(64);for(h=0;h<64;h++){r[h]="0"}for(h=0;h<d.length;h++){if(d[h].checked){r[h]="1";g=true}}if(!g){window.alert(select_channel_tip);ShowFileList(g_curListPageIndex);return}var k=g_calendarRecData.GetDate(true);var q=k+" 00:00:00";var e=k+" 23:59:59";var p=GenReqDataInfoXML(3,r.join(""),q,e,0,15);var b=WebClient.ExcuteCmd(p);if(b==""){ShowFileList(g_curListPageIndex);return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(b);g_xmlDoc.async=false;g_curListPageIndex=0;var m=g_xmlDoc.documentElement.getElementsByTagName("command");if(m.length==0){ShowFileList(g_curListPageIndex);window.alert(str_no_data_tip);return}if(m[0].attributes.getNamedItem("name").nodeValue!=STR_REPLY_SEARCH_FILE){ShowFileList(g_curListPageIndex);window.alert(str_no_data_tip);return}var t=m[0].getElementsByTagName("item");if(t.length<=0){ShowFileList(g_curListPageIndex);window.alert(str_no_data_tip);return}for(var h=0;h<t.length;h++){var s=t[h].getElementsByTagName(STR_CHANNEL)[0].childNodes[0].nodeValue;var f=t[h].getElementsByTagName(STR_START_TIME)[0].childNodes[0].nodeValue;f=(f>q)?f:q;var a=t[h].getElementsByTagName(STR_END_TIME)[0].childNodes[0].nodeValue;a=(a<e)?a:e;var c=parseInt(t[h].getElementsByTagName(STR_EVENT_TYPE)[0].childNodes[0].nodeValue,10);var l=t[h].getElementsByTagName(STR_DISK_INDEX)[0].childNodes[0].nodeValue;var o=t[h].getElementsByTagName(STR_FILE_INDEX)[0].childNodes[0].nodeValue;g_recFileInfo[h]=new RecLogInfo(s,f,a,c,l,o);g_fileSelItem[h]=false}ShowFileList(g_curListPageIndex)}function RequestDataInfo(){if(g_recDataManPage==0){RequestRecTimeInfo()}else{if(g_recDataManPage==1){RequestRecEventInfo()}else{RequestRecFileInfo()}}}function ShowFileList(a){var f=/msie/i.test(navigator.userAgent);var e=document.getElementById("pb_file_list");var d=document.getElementById("search_file_list_page");var b=document.getElementsByName("file_item");if(g_recFileInfo.length<=0){for(itemIdx=1;itemIdx<e.rows.length;itemIdx++){var c=e.rows[itemIdx].cells;b[itemIdx-1].style.display="none";if(f){c[1].innerText=" ";c[2].innerText=" ";c[3].innerText=" ";c[4].innerText=" "}else{c[1].textContent=" ";c[2].textContent=" ";c[3].textContent=" ";c[4].textContent=" "}}return false}if(g_recFileInfo.length<=a*20){return false}for(itemIdx=a*20;itemIdx<(a+1)*20;itemIdx++){var c=e.rows[itemIdx-a*20+1].cells;if(itemIdx>=g_recFileInfo.length){b[itemIdx%20].style.display="none";if(f){c[1].innerText=" ";c[2].innerText=" ";c[3].innerText=" ";c[4].innerText=" "}else{c[1].textContent=" ";c[2].textContent=" ";c[3].textContent=" ";c[4].textContent=" "}}else{b[itemIdx%20].style.display="";if(f){c[1].innerText=parseInt(g_recFileInfo[itemIdx].channel,10)+1;c[2].innerText=g_recFileInfo[itemIdx].startTime;c[3].innerText=g_recFileInfo[itemIdx].endTime}else{c[1].textContent=parseInt(g_recFileInfo[itemIdx].channel,10)+1;c[2].textContent=g_recFileInfo[itemIdx].startTime;c[3].textContent=g_recFileInfo[itemIdx].endTime}b[itemIdx%20].checked=g_fileSelItem[itemIdx];if(FileIsLocked(g_recFileInfo[itemIdx].type)){if(f){c[4].innerText=str_locked}else{c[4].textContent=str_locked}}else{if(FileIsReadonly(g_recFileInfo[itemIdx].type)){if(f){c[4].innerText=str_readonly}else{c[4].textContent=str_readonly}}else{if(FileIsWriting(g_recFileInfo[itemIdx].type)){if(f){c[4].innerText=str_writing}else{c[4].textContent=str_writing}}else{if(FileIsReading(g_recFileInfo[itemIdx].type)){if(f){c[4].innerText=str_reading}else{c[4].textContent=str_reading}}else{if(f){c[4].innerText=""}else{c[4].textContent=""}}}}}if(FileIsUnofficial(g_recFileInfo[itemIdx].type)){if(f){c[1].innerText+="+"}else{c[1].textContent+="+"}}d.innerHTML=a+1+"/"+Math.ceil(g_recFileInfo.length/20)}}return true}function ShowEventList(b){var f=/msie/i.test(navigator.userAgent);var c=document.getElementById("event_list");var a=document.getElementById("search_event_list_page");if(g_recEventInfo.length<=0){for(itemIdx=1;itemIdx<c.rows.length;itemIdx++){var d=c.rows[itemIdx].cells;if(f){d[0].innerText=" ";d[1].innerText=" ";d[2].innerText=" ";d[3].innerText=" "}else{d[0].textContent=" ";d[1].textContent=" ";d[2].textContent=" ";d[3].textContent=" "}}return false}if(g_recEventInfo.length<=b*20){return false}for(itemIdx=b*20;itemIdx<(b+1)*20;itemIdx++){var d=c.rows[itemIdx-b*20+1].cells;if(itemIdx>=g_recEventInfo.length){if(f){d[0].innerText=" ";d[1].innerText=" ";d[2].innerText=" ";d[3].innerText=" "}else{d[0].textContent=" ";d[1].textContent=" ";d[2].textContent=" ";d[3].textContent=" "}}else{if(f){d[0].innerText=parseInt(g_recEventInfo[itemIdx].channel,10)+1;d[1].innerText=g_recEventInfo[itemIdx].startTime;d[2].innerText=g_recEventInfo[itemIdx].endTime}else{d[0].textContent=parseInt(g_recEventInfo[itemIdx].channel,10)+1;d[1].textContent=g_recEventInfo[itemIdx].startTime;d[2].textContent=g_recEventInfo[itemIdx].endTime}var e=parseInt(g_recEventInfo[itemIdx].type,10);for(bit=3;bit>=0;bit--){if(e&(1<<bit)){if(f){d[3].innerText=g_recEventTypes[bit]}else{d[3].textContent=g_recEventTypes[bit]}break}}if(FileIsUnofficial(e)){if(f){d[0].innerText+="+"}else{d[0].textContent+="+"}}}a.innerHTML=b+1+"/"+Math.ceil(g_recEventInfo.length/20)}return true}function GotoFirstPage(){if(g_recDataManPage==1){g_curListPageIndex=0;ShowEventList(0)}else{UpdateSelFile();g_curListPageIndex=0;ShowFileList(0)}}function GotoNextPage(){if(g_recDataManPage==1){if((g_curListPageIndex+1)*20<g_recEventInfo.length){g_curListPageIndex+=1;ShowEventList(g_curListPageIndex)}}else{if((g_curListPageIndex+1)*20<g_recFileInfo.length){UpdateSelFile();g_curListPageIndex+=1;ShowFileList(g_curListPageIndex)}}}function GotoPrevPage(){if(g_curListPageIndex==0){return}if(g_recDataManPage==1){g_curListPageIndex-=1;ShowEventList(g_curListPageIndex)}else{UpdateSelFile();g_curListPageIndex-=1;ShowFileList(g_curListPageIndex)}}function GotoLastPage(){if(g_recDataManPage==1){g_curListPageIndex=Math.ceil(g_recEventInfo.length/20)-1;ShowEventList(g_curListPageIndex)}else{UpdateSelFile();g_curListPageIndex=Math.ceil(g_recFileInfo.length/20)-1;ShowFileList(g_curListPageIndex)}}function ShowRecTimeInfo(){var d=document.getElementById("time_search_hour");ClearTimeInfo(d);var b=g_calendarRecData.GetDate(false);var f=new Date(b.year,b.month,b.day,0,0,0);f=f.getTime()/1000;var c=new Date(b.year,b.month,b.day,23,59,59);c=c.getTime()/1000;var h=new Array(g_ch_num);for(var e=0;e<g_ch_num;e++){h[e]=new Array()}var a=0;for(var e=0;e<g_recDataTimeSec.length;e++){if((f<g_recDataTimeSec[e].endTime)&&(c>g_recDataTimeSec[e].startTime)){var g=g_recDataTimeSec[e].channel;a=h[g].length;h[g][a]=new Object();h[g][a].startTime=Math.max(g_recDataTimeSec[e].startTime,f);h[g][a].endTime=Math.min(g_recDataTimeSec[e].endTime,c)}}for(var e=0;e<g_ch_num;e++){SetTimeInfo(d,h[e],e+1)}}function StartPlayback(g,b,e,d,h){var k="";k="<request>\r\n";k+='<command name="'+STR_LM_PLAYBACK_START+'">\r\n';k+="<"+STR_DIVISION_MODE+">"+g_curDivisionMode+"</"+STR_DIVISION_MODE+">\r\n";k+="<"+STR_PB_CHANNELS+">"+g+"</"+STR_PB_CHANNELS+">\r\n";k+="<"+STR_PB_START_TIME+">"+b+"</"+STR_PB_START_TIME+">\r\n";k+="<"+STR_PB_END_TIME+">"+e+"</"+STR_PB_END_TIME+">\r\n";k+="<"+STR_PB_CUR_TIME+">"+d+"</"+STR_PB_CUR_TIME+">\r\n";k+="</command>\r\n";k+="</request>";WebClient.ExcuteLocalCmd(k);k="<request>\r\n";k+='<command name="'+STR_GET_LAST_STREAM_ERROR+'">\r\n';k+="</command>\r\n";k+="</request>";var c=WebClient.ExcuteCmd(k);if(h&&(c!="")){var m;m=FormatToXmlDOM(c);m.async=false;var a=m.documentElement.getElementsByTagName("command")[0];var f=a.getElementsByTagName("parameter")[0];var l=f.childNodes[0].nodeValue;if(STR_STREAM_NO_CAPABILITY==l){window.alert(str_stream_no_capability)}delete m}}function ExitPlayback(){var a="";a="<request>\r\n";a+='<command name="'+STR_LM_PLAYBACK_STOP+'">\r\n';a+="</command>\r\n";a+="</request>";WebClient.ExcuteLocalCmd(a)}function PlaybackByTime(){var e=document.getElementById("timesearch_sdate_span");var c=document.getElementById("timesearch_stime_span");var m=0;var g=DateTicker.all[e.dateName].getValue().split("-");var b=new Date(parseInt(g[0],10),parseInt(g[1],10)-1,parseInt(g[2],10),0,0,0);b=b.getTime()/1000;var l=b+86399;var f=DateBox.all[c.dateName].getValue().split(":");var k=parseInt(f[0]);var d=parseInt(f[1]);var h=new Date(parseInt(g[0],10),parseInt(g[1],10)-1,parseInt(g[2],10),parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10));h=h.getTime()/1000;var n=document.getElementsByName("play_channel");for(var a=0;a<n.length;a++){if(n[a].checked){m|=(1<<a)}}if(m==0){alert(select_channel_tip);return}GotoPBPage();StartPlayback(m,b,l,h,true)}function PlaybackByEvent(g,a){var f=/msie/i.test(navigator.userAgent);if(f){var h=parseInt(g.innerText,10)-1}else{var h=parseInt(g.textContent,10)-1}var k=1<<h;if(f){var d=a.innerText.split(" ")[1]}else{var d=a.textContent.split(" ")[1]}var c=g_calendarRecData.GetDate(false);var b=new Date(c.year,c.month,c.day,0,0,0);b=b.getTime()/1000;var e=b+86399;d=d.split(":");d=new Date(c.year,c.month,c.day,parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10));d=d.getTime()/1000;g_curDivisionMode=1;g_curDivisionIndex=0;g_curSelChannel=new Array(1);g_curSelChannel[0]=h;GotoPBPage();StartPlayback(k,b,e,d,true)}function SetPBChannel(){var a=document.getElementById("play_start_date_span");var d=document.getElementById("play_start_time_span");var f=0;for(i=0;i<g_curSelChannel.length;i++){if(g_curSelChannel[i]!=-1){f|=1<<g_curSelChannel[i]}}if(f==0){alert(select_channel_tip);return}var c=DateTicker.all[a.dateName].getValue().split("-");var e=new Date(parseInt(c[0],10),parseInt(c[1],10)-1,parseInt(c[2],10),0,0,0);e=e.getTime()/1000;var b=e+24*3600;var g=DateBox.all[d.dateName].getValue().split(":");g=new Date(parseInt(c[0],10),parseInt(c[1],10)-1,parseInt(c[2],10),parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10));g=g.getTime()/1000;var h=document.getElementById("playback_play_btn");h.disabled=true;StartPlayback(f,e,b,g,false);h.disabled=false}function FileM_SelectAll(){if(g_fileSelItem==null){return}for(var a=0;a<g_fileSelItem.length;a++){g_fileSelItem[a]=true}ShowFileList(g_curListPageIndex)}function FileM_InvertSelection(){if(g_fileSelItem==null){return}UpdateSelFile();for(var a=0;a<g_fileSelItem.length;a++){g_fileSelItem[a]=!g_fileSelItem[a]}ShowFileList(g_curListPageIndex)}function FileManage(c){var f=/msie/i.test(navigator.userAgent);if(f){UpdateSelFile();var o=0;var p="<request>\r\n";p+='<command name="'+c+'">\r\n';var e=false;var q=false;for(var m=0;m<g_fileSelItem.length;m++){if(g_fileSelItem[m]){e=true;if(FileIsReadonly(g_recFileInfo[m].type)||FileIsWriting(g_recFileInfo[m].type)){q=true;continue}if(FileIsLocked(g_recFileInfo[m].type)){if((c==STR_FILE_LOCK)||(c==STR_FILE_DELETE)){if(STR_FILE_DELETE==c){q=true}continue}}else{if(c==STR_FILE_UNLOCK){q=true;continue}}p+="<item index = "+o+">\r\n";p+="<"+STR_EVENT_TYPE+">"+g_recFileInfo[m].type+"</"+STR_EVENT_TYPE+">\r\n";p+="<"+STR_CHANNEL+">"+g_recFileInfo[m].channel+"</"+STR_CHANNEL+">\r\n";p+="<"+STR_START_TIME+">"+g_recFileInfo[m].startTime+"</"+STR_START_TIME+">\r\n";p+="<"+STR_END_TIME+">"+g_recFileInfo[m].endTime+"</"+STR_END_TIME+">\r\n";p+="<"+STR_DISK_INDEX+">"+g_recFileInfo[m].diskIndex+"</"+STR_DISK_INDEX+">\r\n";p+="<"+STR_FILE_INDEX+">"+g_recFileInfo[m].fileIndex+"</"+STR_FILE_INDEX+">\r\n";p+="</item>\r\n";o++}}if(o==0){if(!e){window.alert(data_select_tip)}else{if(q){window.alert(data_select_forbiden_tip)}}return}if(c==STR_FILE_LOCK){if(!confirm(file_lock_confirm)){return}}if(c==STR_FILE_UNLOCK){if(!confirm(file_unlock_confirm)){return}}if(c==STR_FILE_DELETE){if(!confirm(file_delete_confirm)){return}}p+="</command>\r\n";p+="</request>\r\n";var d=WebClient.ExcuteCmd(p);if(d==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(d);g_xmlDoc.async=false;var b=g_xmlDoc.documentElement.getElementsByTagName("command");if(b[0].attributes.getNamedItem("name").nodeValue==STR_REPLY_NO_AUTH){window.alert(str_no_auth);return}RequestRecFileInfo()}else{UpdateSelFile();var n=300;var a=g_fileSelItem.length/n;if(g_fileSelItem.length%n!=0){a++}var e=false;for(var m=0;m<g_fileSelItem.length;m++){if(g_fileSelItem[m]){e=true;break}}if(!e){window.alert(data_select_tip);return}var l=0;var m=0;for(var g=0;g<a;g++){var o=0;var p="<request>\r\n";p+='<command name="'+c+'">\r\n';var q=false;for(var h=0;h<n;h++){m=g*n+h;if(m>=g_fileSelItem.length){break}if(g_fileSelItem[m]){if(FileIsReadonly(g_recFileInfo[m].type)||FileIsWriting(g_recFileInfo[m].type)){q=true;continue}if(FileIsLocked(g_recFileInfo[m].type)){if((c==STR_FILE_LOCK)||(c==STR_FILE_DELETE)){if(STR_FILE_DELETE==c){q=true}continue}}else{if(c==STR_FILE_UNLOCK){q=true;continue}}p+="<item index = "+o+">\r\n";p+="<"+STR_EVENT_TYPE+">"+g_recFileInfo[m].type+"</"+STR_EVENT_TYPE+">\r\n";p+="<"+STR_CHANNEL+">"+g_recFileInfo[m].channel+"</"+STR_CHANNEL+">\r\n";p+="<"+STR_START_TIME+">"+g_recFileInfo[m].startTime+"</"+STR_START_TIME+">\r\n";p+="<"+STR_END_TIME+">"+g_recFileInfo[m].endTime+"</"+STR_END_TIME+">\r\n";p+="<"+STR_DISK_INDEX+">"+g_recFileInfo[m].diskIndex+"</"+STR_DISK_INDEX+">\r\n";p+="<"+STR_FILE_INDEX+">"+g_recFileInfo[m].fileIndex+"</"+STR_FILE_INDEX+">\r\n";p+="</item>\r\n";o++}}l+=o;if(g==0){if(c==STR_FILE_LOCK){if(!confirm(file_lock_confirm)){return}}if(c==STR_FILE_UNLOCK){if(!confirm(file_unlock_confirm)){return}}if(c==STR_FILE_DELETE){if(!confirm(file_delete_confirm)){return}}}if(o!=0){p+="</command>\r\n";p+="</request>\r\n";var d=WebClient.ExcuteCmd(p);if(d==""){return}if(g_xmlDoc!=null){delete g_xmlDoc;g_xmlDoc=null}g_xmlDoc=FormatToXmlDOM(d);g_xmlDoc.async=false;var b=g_xmlDoc.documentElement.getElementsByTagName("command");if(b[0].attributes.getNamedItem("name").nodeValue==STR_REPLY_NO_AUTH){window.alert(str_no_auth);return}}}if(l==0){window.alert(data_select_forbiden_tip);return}RequestRecFileInfo()}}function UpdateSelFile(){var a=document.getElementsByName("file_item");for(var b=0;b<20;b++){if(b+g_curListPageIndex*20<g_fileSelItem.length){g_fileSelItem[b+g_curListPageIndex*20]=a[b].checked}}}function FileDelete(){FileManage(STR_FILE_DELETE)}function FileLock(){FileManage(STR_FILE_LOCK)}function FileUnlock(){FileManage(STR_FILE_UNLOCK)}function GotoTimeSearch(){var c=document.getElementById("div_search_nav");var f=document.getElementById("div_event_list");var m=document.getElementById("div_event_condition");var q=document.getElementById("div_search_start");var e=document.getElementById("div_timeSearch_play");var n=document.getElementById("div_label_rec_time");var k=document.getElementById("time_search_hour");var h=document.getElementById("div_file_list");var b=document.getElementById("search_event_list_page");var a=document.getElementById("event_list");var o=document.getElementById("search_middle_div");e.style.display="";n.style.display="";k.style.display="";h.style.display="none";f.style.display="none";m.style.display="none";RequestMonthCalInfo();g_recDataManPage=0;g_recEventInfo=new Array(0);g_recFileInfo=new Array(0);document.getElementById("search_middle_div").style.height="560px";var g=(o.offsetHeight-2>560)?o.offsetHeight-2:560;document.getElementById("div_search_nav").style.height=g+"px";g=c.offsetHeight-12;document.getElementById("search_right_div").style.height=g+"px";var p=g+40;document.getElementById("div_search_body").style.height=p+"px";var d=/msie/i.test(navigator.userAgent);if(!d){var l=p+60;document.getElementById("work_area").style.height=l+"px"}EdgeCtrl(c,72);ApplyXmlLang("time_search.xml")}function GotoEventSearch(){var g=/msie/i.test(navigator.userAgent);var u=document.getElementById("div_search_nav");var m=document.getElementById("div_event_list");var o=document.getElementById("div_event_condition");var l=document.getElementById("div_search_start");var a=document.getElementById("div_timeSearch_play");var e=document.getElementById("div_label_rec_time");var r=document.getElementById("time_search_hour");var b=document.getElementById("div_file_list");var s=document.getElementById("search_event_list_page");var c=document.getElementById("event_list");var f=document.getElementById("search_middle_div");u.style.display="";m.style.display="";o.style.display="";l.style.display="";a.style.display="none";e.style.display="none";r.style.display="none";b.style.display="none";s.innerHTML="0/0";RequestMonthCalInfo();g_recDataManPage=1;if(g_supportFunctions.IsNotSupportAlarm()&&(g_net_ch_num==0)){var n=document.getElementById("event_type_sensor");if(n){n.style.display="none";var h=n.parentNode;var q=h.parentNode;q.removeChild(h)}}for(var k=0;k<20;k++){var d=c.rows[k+1].cells;if(g){d[0].innerText=" ";d[1].innerText=" ";d[2].innerText=" ";d[3].innerText=" "}else{d[0].textContent=" ";d[1].textContent=" ";d[2].textContent=" ";d[3].textContent=" "}c.rows[k+1].onmouseout=function(){this.style.cssText=""};c.rows[k+1].onmouseover=function(){if(g){var w=this.cells[0].innerText}else{var w=this.cells[0].textContent}if(w!=" "){this.style.cssText=tr_select_css}};c.rows[k+1].onclick=function(){if(g){var w=this.cells[0].innerText}else{var w=this.cells[0].textContent}if(w!=" "){PlaybackByEvent(this.cells[0],this.cells[1])}}}g_recFileInfo=new Array(0);var v=f.offsetHeight-2;document.getElementById("div_search_nav").style.height=v+"px";v=f.offsetHeight-12;document.getElementById("search_right_div").style.height=v+"px";var p=v+40;document.getElementById("div_search_body").style.height=p+"px";if(!isIE){var t=p+60;document.getElementById("work_area").style.height=t+"px"}EdgeCtrl(u,72);ApplyXmlLang("event_search.xml")}function GotoFileManager(){var v=document.getElementById("div_search_nav");var b=document.getElementById("div_file_list");var q=document.getElementById("div_event_condition");var n=document.getElementById("div_search_start");var a=document.getElementById("div_timeSearch_play");var f=document.getElementById("div_label_rec_time");var s=document.getElementById("time_search_hour");var c=document.getElementById("search_file_list_page");var g=document.getElementById("pb_file_list");var m=document.getElementById("file_lock_button");var e=document.getElementById("file_unlock_button");var w=document.getElementById("file_del_button");var p=document.getElementById("div_event_list");var t=document.getElementsByName("file_item");var h=document.getElementById("search_middle_div");var o=parseInt(const_hardware_ver.split(".")[1],10);if(g_bBR27||o==6){w.style.display="none"}var k=/msie/i.test(navigator.userAgent);v.style.display="";b.style.display="";n.style.display="";q.style.display="none";a.style.display="none";f.style.display="none";s.style.display="none";p.style.display="none";c.innerHTML="0/0";RequestMonthCalInfo();g_recDataManPage=2;if(!(g_authority.authority&2048)){m.disabled=true;e.disabled=true;w.disabled=true}for(var l=0;l<20;l++){var d=g.rows[l+1].cells;t[l%20].style.display="none";if(k){d[1].innerText=" ";d[2].innerText=" ";d[3].innerText=" ";d[4].innerText=" "}else{d[1].textContent=" ";d[2].textContent=" ";d[3].textContent=" ";d[4].textContent=" "}g.rows[l+1].cells[1].onmouseout=function(){this.parentNode.style.cssText=""};g.rows[l+1].cells[2].onmouseout=g.rows[l+1].cells[1].onmouseout;g.rows[l+1].cells[3].onmouseout=g.rows[l+1].cells[1].onmouseout;g.rows[l+1].cells[4].onmouseout=g.rows[l+1].cells[1].onmouseout;g.rows[l+1].cells[1].onmouseover=function(){if(k){var y=this.parentNode.cells[1].innerText}else{var y=this.parentNode.cells[1].textContent}if(y!=" "){this.parentNode.style.cssText=tr_select_css}};g.rows[l+1].cells[2].onmouseover=g.rows[l+1].cells[1].onmouseover;g.rows[l+1].cells[3].onmouseover=g.rows[l+1].cells[1].onmouseover;g.rows[l+1].cells[4].onmouseover=g.rows[l+1].cells[1].onmouseover;g.rows[l+1].cells[1].onclick=function(){if(k){var y=this.parentNode.cells[1].innerText}else{var y=this.parentNode.cells[1].textContent}if(y!=" "){PlaybackByEvent(this.parentNode.cells[1],this.parentNode.cells[2])}};g.rows[l+1].cells[2].onclick=g.rows[l+1].cells[1].onclick;g.rows[l+1].cells[3].onclick=g.rows[l+1].cells[1].onclick;g.rows[l+1].cells[4].onclick=g.rows[l+1].cells[1].onclick}g_recEventInfo=new Array(0);var x=h.offsetHeight-2;document.getElementById("div_search_nav").style.height=x+"px";x=h.offsetHeight-12;document.getElementById("search_right_div").style.height=x+"px";var r=x+40;document.getElementById("div_search_body").style.height=r+"px";if(!k){var u=r+60;document.getElementById("work_area").style.height=u+"px"}EdgeCtrl(v,72);ApplyXmlLang("file_manage.xml")}function OnClickDataTime(c){var e=0;var d=c.parentNode.childNodes;for(i=0;i<d.length;i++){if(d[i]==c){e=i;break}}var b=showtime.value.split(" ");var a=b[1].split(":");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10);if(c.parentNode.parentNode.id=="time_search_hour"){a[0]=e}else{a[1]=e}showtime.value=b[0]+" "+((a[0]>9)?"":"0")+a[0]+":"+((a[1]>9)?"":"0")+a[1]+":00";ShowRecTimeInfo()}function GenPlayChannelChart(b,h,g){while(b.rows.length>0){b.deleteRow(b.rows[0])}while(b.rows.length>0){b.deleteRow(0)}var c=(b.rows.length==1);var d="";var l="";if(c){d=b.rows[0].cells[1].className;l=b.rows[0].cells[1].cssText}var a=g_TotalChannelList.length;if(a%4!=0){a=parseInt(a/4)*4+4}var k=Math.ceil(g_TotalChannelList.length/4);for(i=0;i<k;i++){var f=b.insertRow(i);f.style.cssText="text-align:left;";var e=f.insertCell(0);e.style.cssText="border-right:solid 1px Black;";if(g_curDivisionMode==1){e.style.display="none"}e.innerHTML="<input type='checkbox' style='width:20px;' name='"+h+"' id='"+h+"' onclick=\"var "+h+" = document.getElementsByName('"+h+"');var "+g+" = document.getElementsByName('"+g+"');SelPlayChannelGroup("+h+","+g+","+i+')"/>';for(j=1;(j<=4)&&((j+i*4)<=a);j++){if((j+i*4)>g_TotalChannelList.length){e=f.insertCell(j);e.cssText=l;e.disabled=true;continue}e=f.insertCell(j);e.innerHTML="<input type='checkbox' name='"+g+"' id='"+g+"' style='width:20px;' onclick=\"var "+h+" = document.getElementsByName('"+h+"');var "+g+" = document.getElementsByName('"+g+"');SelPlayChannel("+h+","+g+","+(i*4+(j-1))+')"/>'+(j+i*4)}}}function CheckPlayChannel(e,a){for(var d=0;d<a.length;d++){a[d].checked=false}for(d=0;d<g_curSelChannel.length;d++){if(g_curSelChannel[d]!=-1){a[g_curSelChannel[d]].checked=true}}for(d=0;d<e.length;d++){e[d].checked=true;var f=0;var c=0;for(var b=0;b<4;b++){c=d*4+b;if(c>=0&&c<a.length){if(a[c].disabled){f++}else{if(!a[c].checked){e[d].checked=false;break}}}}if(4==f){e[d].checked=false}}}function OnSelDivision(d,h,b){var g=document.getElementById("play_channel_table");objId=d.id;for(i=0;i<4;i++){if(document.getElementById(objId+i).className=="on"){document.getElementById(objId+i).className="";document.getElementById(objId+i).style.background="url(res/div"+i+".jpg)"}}document.getElementById(objId+h).className="on";document.getElementById(objId+h).style.background="url(res/divh_"+h+".jpg)";if(g_curDivisionMode!=b){g_curSelChannel=new Array();g_curDivisionMode=b;g_curDivisionIndex=h;if(g_authority.authority&8){var c=0;for(var e=0;e<g_TotalChannelList.length;e++){if(c>=b){break}if(g_authority.authPlayback&(1<<e)){g_curSelChannel[c]=e;c++}}}}for(i=0;i<d.rows.length;i++){if(b>1){d.rows[i].cells[0].style.display=""}else{d.rows[i].cells[0].style.display="none"}}if(g==d){var f=document.getElementsByName("play_group");var a=document.getElementsByName("play_channel");CheckPlayChannel(f,a)}else{var f=document.getElementsByName("play_group_2");var a=document.getElementsByName("play_channel_2");CheckPlayChannel(f,a)}}function SelPlayChannel(c,a,b){if(a[b].checked){for(i=0;i<g_curSelChannel.length;i++){if(g_curSelChannel[i]==-1){g_curSelChannel[i]=b;break}}if(i==g_curSelChannel.length){g_curSelChannel.shift();g_curSelChannel[g_curSelChannel.length]=b}}else{for(i=0;i<g_curSelChannel.length;i++){if(g_curSelChannel[i]==b){g_curSelChannel.splice(i,1);g_curSelChannel[g_curSelChannel.length]=-1;break}}}CheckPlayChannel(c,a)}function SelPlayChannelGroup(d,a,c){if(!(g_authority.authority&8)){return}var b=c*4+3;if((c*4+3)>a.length){b=a.length-1}for(i=0;i<g_curSelChannel.length;i++){if((g_curSelChannel[i]>=c*4)&&(g_curSelChannel[i]<=b)){g_curSelChannel.splice(i,1);g_curSelChannel[g_curSelChannel.length]=-1;i-=1}}if((typeof d.length)=="undefined"){d=document.getElementsByName(d.id)}if(d[c].checked){for(i=c*4;i<=b;i++){if(g_authority.authPlayback&(1<<i)){for(j=0;j<g_curSelChannel.length;j++){if(g_curSelChannel[j]==-1){g_curSelChannel[j]=i;break}}if(j==g_curSelChannel.length){g_curSelChannel.shift();g_curSelChannel[g_curSelChannel.length]=i}}}}CheckPlayChannel(d,a)}function Pb_SnapPicture(){var c="<request>\r\n";c+='<command name="'+STR_LM_PB_SNAP+'">\r\n';c+="</command>\r\n";c+="</request>\r\n";var e=navigator.userAgent.toLowerCase();var b=navigator.platform.toLowerCase();var h=false;if(e.indexOf("macintosh")!=-1||e.indexOf("mac os x 10")!=-1||b.indexOf("macintel")!=-1){h=true}if(h){var a=WebClient.ExcuteLocalCmd(c);var f;f=FormatToXmlDOM(a);f.async=false;var g=f.documentElement.getElementsByTagName("command");var d=g[0].childNodes[0];if(d.childNodes[0].nodeValue=="0"){window.alert(str_local_snap_failed)}}else{WebClient.ExcuteLocalCmd(c)}}function EventCheck(b){if(b.checked){var a=document.getElementById("event_all");a.checked=false}}function EventAllCheck(c){if(c.checked){var a=document.getElementById("event_type_motion");var b=document.getElementById("event_type_sensor");a.checked=false;b.checked=false}};